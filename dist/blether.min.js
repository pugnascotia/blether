/*! blether 19-06-2015 */
function Module(){}function Process(){}function Smalltalk(){}function stReturn(a){throw new STReturnValue(a)}function BletherArray(a){this.values=a}function BletherDynamicArray(a){this.values=a}function BletherDynamicDictionary(a){this.values=a}function BletherNode(a,b,c){this.line=a,this.column=b,this.source=c}function BletherNumber(a){this.value=a}function BletherString(a){this.value=a}function BletherSymbol(a){this.value=a}function convertSelector(a){var b={"\\":"backslash","+":"plus","*":"multiply","/":"divide","=":"equals",">":"greater_than","<":"less_than","@":"at","%":"modulo","~":"tilde","|":"or","&":"and","-":"minus"},c={"do:":"forEach","doWithIndex:":"forEach","select:":"filter",",":"concat"};if(c.hasOwnProperty(a))return c[a];if(a.match(/[\\+*/=><,@%~|&-]/))return"__"+a.split("").map(function(a){return b[a]}).join("_")+"$";if(a.match(/:/)){var d=a.split(":").filter(function(a){return a.length>0});a=d.length>1?d.join("_")+"$":d[0]}return a}Module.export_as$=function(a,b){exports[a]=b},Process.argv=function(){return process.argv},Smalltalk.document=function(){return document},Array.prototype.reduceRight_startingWith$=function(a,b){return this.reduceRight.call(a,b)},String.prototype.__equals$=function(a){return this===a},String.prototype.__concat$=function(){return Array.reduce(arguments,function(a,b){},this)},String.prototype.__value$=function(){return this},Number.prototype.__equals$=function(a){return this===a},Number.prototype.__plus$=function(a){return this+a},Number.prototype.__multiply$=function(a){return this*a},Number.prototype.__divide$=function(a){return this/a},Number.prototype.__minus$=function(a){return this-a},Number.prototype.__modulo$=function(a){return this%a},Number.prototype.__or$=function(a){return this|a},Number.prototype.__and$=function(a){return this&a},Number.prototype.__value$=function(){return this},Number.prototype.__greater_than$=function(a){return this>a},Number.prototype.__less_than$=function(a){return a>this},Number.prototype.to_do$=function(a,b){for(var c=this;a>this;c++)b(c)},Number.prototype.timesRepeat=function(a){for(var b=0;this>b;b++)a()},Function.prototype.__value$=function(){return this.apply(this,arguments)};var Transcript=function(){var a="",b={};return b.show=function(b){return a+=b,this},b.nl=b.cr=function(){return console.log(a),a="",this},b.tab=function(){return a+="	",this},b}(),STReturnValue=function(a){var b=a;Object.defineProperty(this,"value",{value:b,writable:!1,enumerable:!0,configurable:!0})};BletherArray.prototype=Object.create(BletherNode.prototype),BletherArray.prototype.constructor=BletherNode,BletherArray.prototype.toString=function(){var a=this;return"[".concat(a.values.map(function(a){return'"'.concat(a).concat('"')}).join(", ")).concat("]")},BletherArray.prototype.visit=function(a){var b=this;return a.visitArray(b)},BletherDynamicArray.prototype=Object.create(BletherArray.prototype),BletherDynamicArray.prototype.constructor=BletherArray,BletherDynamicArray.prototype.visit=function(a){var b=this;return a.visitDynamicArray(b)},BletherDynamicDictionary.prototype=Object.create(BletherNode.prototype),BletherDynamicDictionary.prototype.constructor=BletherNode,BletherDynamicDictionary.prototype.visit=function(a){var b=this;return a.visitDynamicDictionary(b)},BletherNode.prototype.setLine_column_source$=function(a,b,c){var d=this;return d.line=a,d.column=b,d.source=c,d},BletherNode.prototype.invoke=function(){return this.visit.apply(this,arguments)},BletherNode.prototype.find=function(a){var b=this;return a.__value$(b)?[b]:[]},BletherNode.prototype.isMethod=function(){return!1},BletherNumber.prototype=Object.create(BletherNode.prototype),BletherNumber.prototype.constructor=BletherNode,BletherNumber.prototype.toString=function(){var a=this;return a.value},BletherNumber.prototype.visit=function(a){var b=this;return a.visitNumber(b)},BletherString.prototype=Object.create(BletherNode.prototype),BletherString.prototype.constructor=BletherNode,BletherString.prototype.toString=function(){var a=this;return a.value},BletherString.prototype.visit=function(a){var b=this;return a.visitString(b)},BletherSymbol.prototype=Object.create(BletherNode.prototype),BletherSymbol.prototype.constructor=BletherNode,BletherSymbol.prototype.toString=function(){var a=this;return a.value},BletherSymbol.prototype.visit=function(a){var b=this;return a.visitSymbol(b)};var Blether={classes:{Object:{classMethods:{},methods:{}}}};Blether.ParseError=function(a){return{name:"Blether Parse Error",message:a.msg,line:a.line,column:a.column}},Blether.ParseError.prototype=new Error,Blether.ParseError.prototype.toString=function(){return this.message+":"+this.line+":"+this.column},Blether.Context=function(){this.currentClass=null,this.instanceVars=[],this.temps=[],this.returnContext=null},Blether.ContextMgr=function(){var a=[new Blether.Context];a[0].returnContext="root",this.pushClass=function(a,b){var c=new Blether.Context;c.className=a,c.instanceVars=b,this.push(c)},this.pushMethod=function(a){var b=new Blether.Context;b.returnContext="method",b.temps=a,this.push(b)},this.pushTemps=function(a){var b=new Blether.Context;b.temps=a,this.push(b)},this.pushBlock=function(a){var b=new Blether.Context;b.returnContext="block",b.temps=a,this.push(b)},this.push=function(b){a.push(b)},this.pop=function(){if(1===a.length)throw"Cannot pop the context beyond the initial state!";a.pop()};var b=0;this.pushReceiver=function(){return b++,"_receiver"+b+"$"},this.popReceiver=function(){if(0===b)throw"receiverDepth is already zero and cannot be popped further";b--},this.getTemps=function(){return a.reduceRight(function(a,b){return a.concat(b.temps)},[])},this.getInstanceVars=function(){return a.reduceRight(function(a,b){return a.concat(b.instanceVars)},[])},this.currentClass=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].className)return a[b].className;return null},this.returnContext=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].returnContext)return a[b].returnContext;return null}},Blether.Node=function(){this.line=null,this.column=null,this.source=null},Blether.Node.prototype.at=function(a,b,c){return this.line=a,this.column=b,this.source=c,this},Blether.Node.prototype.invoke=function(){return this.visit.apply(this,arguments)},Blether.Node.prototype.find=function(a){return a(this)?[this]:[]},Blether.Node.prototype.isMethod=function(){return!1},Blether.String=function(a){this._type="String",this.value=a},Blether.String.prototype=new Blether.Node,Blether.String.prototype.toString=function(){return this.value},Blether.String.prototype.visit=function(a){return a.visitString(this)},Blether.Symbol=function(a){this._type="Symbol",this.value=a},Blether.Symbol.prototype=new Blether.Node,Blether.Symbol.prototype.toString=function(){return this.value},Blether.Symbol.prototype.visit=function(a){return a.visitSymbol(this)},Blether.ClassName=function(a){this._type="ClassName",this.value=a},Blether.ClassName.prototype=new Blether.Node,Blether.ClassName.prototype.toString=function(){return this.value},Blether.ClassName.prototype.visit=function(a){return a.visitClassName(this)},Blether.Number=function(a){this._type="Number",this.value=a},Blether.Number.prototype=new Blether.Node,Blether.Number.prototype.toString=function(){return this.value},Blether.Number.prototype.visit=function(a){return a.visitNumber(this)},Blether.Array=function(a){this._type="Array",this.value=a},Blether.Array.prototype=new Blether.Node,Blether.Array.prototype.toString=function(){return"["+this.value.map(function(a){return'"'+a+'"'}).join(", ")+"]"},Blether.Array.prototype.visit=function(a){return a.visitArray(this)},Blether.DynamicArray=function(a){this._type="DynamicArray",this.values=a||[]},Blether.DynamicArray.prototype=new Blether.Array,Blether.DynamicArray.prototype.visit=function(a){return a.visitDynamicArray(this)},Blether.DynamicDictionary=function(a){this._type="DynamicDictionary",this.values=a||[]},Blether.DynamicDictionary.prototype=new Blether.Node,Blether.DynamicDictionary.prototype.visit=function(a){return a.visitDynamicDictionary(this)},Blether.UndefinedObject=function(){this._type="UndefinedObject"},Blether.UndefinedObject.prototype=new Blether.Node,Blether.UndefinedObject.prototype.toString=function(){return"nil"},Blether.UndefinedObject.prototype.visit=function(a){return a.visitUndefinedObject(this)},Blether.Boolean=function(a){this._type="Boolean",this.value=a},Blether.Boolean.prototype=new Blether.Node,Blether.Boolean.prototype.toString=function(){return this.value.toString()},Blether.Boolean.prototype.visit=function(a){return a.visitBoolean(this)},Blether.Variable=function(a){this._type="Variable",this.value=a},Blether.Variable.prototype=new Blether.Node,Blether.Variable.prototype.toString=function(){return this.value},Blether.Variable.prototype.visit=function(a){return a.visitVariable(this)},Blether.UnaryPattern=function(a){this._type="UnaryPattern",this.selector=a},Blether.UnaryPattern.prototype=new Blether.Node,Blether.UnaryPattern.prototype.toString=function(){return this.selector},Blether.UnaryPattern.prototype.visit=function(a){return a.visitUnaryPattern(this)},Blether.BinaryPattern=function(a,b){this._type="BinaryPattern",this.selector=a,this.arg=b},Blether.BinaryPattern.prototype=new Blether.Node,Blether.BinaryPattern.prototype.toString=function(){return this.selector+" - "+this.arg},Blether.BinaryPattern.prototype.visit=function(a){return a.visitBinaryPattern(this)},Blether.KeywordPattern=function(a){this._type="KeywordPattern",this.pairs=a,this.selector="#";for(var b=0;b<this.pairs.length;b++)this.selector+=this.pairs[b].key},Blether.KeywordPattern.prototype=new Blether.Node,Blether.KeywordPattern.prototype.toString=function(){return this.selector},Blether.KeywordPattern.prototype.visit=function(a){return a.visitKeywordPattern(this)},Blether.Assignment=function(a,b){this._type="Assignment",this.variable=a,this.expression=b},Blether.Assignment.prototype=new Blether.Node,Blether.Assignment.prototype.visit=function(a){return a.visitAssignment(this)},Blether.Return=function(a){this._type="Return",this.value=a},Blether.Return.prototype=new Blether.Node,Blether.Return.prototype.visit=function(a){return a.visitReturn(this)},Blether.Sequence=function(a,b){this._type="Sequence",this.temps=a||[],this.statements=b||[]},Blether.Sequence.prototype=new Blether.Node,Blether.Sequence.prototype.visit=function(a){return a.visitSequence(this)},Blether.Sequence.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.statements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.Statement=function(a){this._type="Statement",this.expression=a},Blether.Statement.prototype=new Blether.Node,Blether.Statement.prototype.visit=function(a){return a.visitStatement(this)},Blether.Statement.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.expression.find(a))},Blether.Block=function(a,b){this._type="Block",this.params=a||[],this.sequence=b},Blether.Block.prototype=new Blether.Node,Blether.Block.prototype.visit=function(a){return a.visitBlock(this)},Blether.Block.prototype.invoke=function(a){for(var b=[this],c=1;c<arguments.length;c++)b.push(arguments[c]);return a.invokeBlock.apply(a,b)},Blether.Block.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Send=function(a,b){this._type="Send",this.receiver=null,this.args=b||[],this.selector=a},Blether.Send.prototype=new Blether.Node,Blether.Send.prototype.visit=function(a){return a.visitSend(this)},Blether.Send.prototype.toString=function(){var a="["+this.args.map(function(a){return'"'+a+'"'}).join(", ")+"]";return"Send(#"+this.selector+(this.received?" to "+this.receiver:"")+(this.args.length>0?" with args "+a:"")+")"},Blether.Send.prototype.setReceiver=function(a){return null===this.receiver?this.receiver=a:this.receiver.setReceiver(a),this},Blether.Send.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b=this.args.reduce(function(b,c){return b.concat(c.find(a))},b),b.concat(this.receiver.find(a))},Blether.Cascade=function(a,b){this._type="Cascade",this.receiver=a,this.messages=b||[]},Blether.Cascade.prototype=new Blether.Node,Blether.Cascade.prototype.visit=function(a){return a.visitCascade(this)},Blether.JsStatement=function(a){this._type="JsStatement",this.javascript=a},Blether.JsStatement.prototype=new Blether.Node,Blether.JsStatement.prototype.visit=function(a){return a.visitJsStatement(this)},Blether.Method=function(a,b){this._type="Method",this.selector=a,this.sequence=b},Blether.Method.prototype=new Blether.Node,Blether.Method.prototype.visit=function(a){return a.visitMethod(this)},Blether.Method.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Comment=function(a){this._type="Comment",this.comment=a},Blether.Comment.prototype=new Blether.Node,Blether.Comment.prototype.visit=function(a){return a.visitComment(this)},Blether.MethodDeclaration=function(a,b){this._type="MethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].methods[b.selector]=this},Blether.MethodDeclaration.prototype=new Blether.Node,Blether.MethodDeclaration.prototype.visit=function(a){return a.visitMethodDeclaration(this)},Blether.MethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.MethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.MethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassMethodDeclaration=function(a,b){this._type="ClassMethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].classMethods[b.selector]=this},Blether.ClassMethodDeclaration.prototype=new Blether.Node,Blether.ClassMethodDeclaration.prototype.visit=function(a){return a.visitClassMethodDeclaration(this)},Blether.ClassMethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.ClassMethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.ClassMethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassDeclaration=function(a,b,c){this._type="ClassDeclaration",this.className=a,this.superClass=b,this.varNames=c,this.classMethods={},this.methods={},this.context=Blether},Blether.ClassDeclaration.prototype=new Blether.Node,Blether.ClassDeclaration.prototype.visit=function(a){return a.visitClassDeclaration(this)},Blether.ClassDeclaration.prototype.getMethods=function(){return this.context.classes[this.className].methods},Blether.ClassDeclaration.prototype.getClassMethods=function(){return this.context.classes[this.className].classMethods},Blether.ClassDeclaration.prototype.isNamespaced=function(){return-1!==this.className.value.indexOf(".")},Blether.Program=function(a){this._type="Program",this.elements=a},Blether.Program.prototype=new Blether.Node,Blether.Program.prototype.visit=function(a){return a.visitProgram(this)},Blether.Program.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.elements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.VariableDeclaration=function(a){this._type="VariableDeclaration",this.variables=a},Blether.VariableDeclaration.prototype=new Blether.Node,Blether.VariableDeclaration.prototype.visit=function(a){return a.visitVariableDeclaration(this)};var BletherParser=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Oe,Ne)}function d(){return f(Oe).line}function e(){return f(Oe).column}function f(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Pe!==b&&(Pe>b&&(Pe=0,Qe={line:1,column:1,seenCR:!1}),c(Qe,Pe,b),Pe=b),Qe}function g(a){Re>Ne||(Ne>Re&&(Re=Ne,Se=[]),Se.push(a))}function h(c,d,e){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=f(e),j=e<a.length?a.charAt(e):null;return null!==d&&g(d),new b(null!==c?c:h(d,j),d,j,e,i.line,i.column)}function i(){var a;return a=zb()}function j(){var b,c;if(b=[],Gb.test(a.charAt(Ne))?(c=a.charAt(Ne),Ne++):(c=Cb,0===Te&&g(Hb)),c!==Cb)for(;c!==Cb;)b.push(c),Gb.test(a.charAt(Ne))?(c=a.charAt(Ne),Ne++):(c=Cb,0===Te&&g(Hb));else b=Fb;return b}function k(){var b,c,d,e,f;if(b=Ne,34===a.charCodeAt(Ne)?(c=Ib,Ne++):(c=Cb,0===Te&&g(Jb)),c!==Cb){for(d=[],e=Ne,a.substr(Ne,2)===Kb?(f=Kb,Ne+=2):(f=Cb,0===Te&&g(Lb)),f!==Cb&&(Oe=e,f=Mb()),e=f,e===Cb&&(Nb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ob)));e!==Cb;)d.push(e),e=Ne,a.substr(Ne,2)===Kb?(f=Kb,Ne+=2):(f=Cb,0===Te&&g(Lb)),f!==Cb&&(Oe=e,f=Mb()),e=f,e===Cb&&(Nb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ob)));d!==Cb?(34===a.charCodeAt(Ne)?(e=Ib,Ne++):(e=Cb,0===Te&&g(Jb)),e!==Cb?(c=[c,d,e],b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function l(){var a,b;for(a=[],b=j(),b===Cb&&(b=k());b!==Cb;)a.push(b),b=j(),b===Cb&&(b=k());return a}function m(){var b,c,d,e;if(b=Ne,Pb.test(a.charAt(Ne))?(c=a.charAt(Ne),Ne++):(c=Cb,0===Te&&g(Qb)),c!==Cb){for(d=[],Rb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Sb));e!==Cb;)d.push(e),Rb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Sb));d!==Cb?(Oe=b,c=Tb(c,d),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function n(){var b,c,d;return b=Ne,c=m(),c!==Cb?(58===a.charCodeAt(Ne)?(d=Ub,Ne++):(d=Cb,0===Te&&g(Vb)),d!==Cb?(Oe=b,c=Wb(c,d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function o(){var b,c,d,e;if(b=Ne,Pb.test(a.charAt(Ne))?(c=a.charAt(Ne),Ne++):(c=Cb,0===Te&&g(Qb)),c!==Cb){for(d=[],Xb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Yb));e!==Cb;)d.push(e),Xb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Yb));d!==Cb?(Oe=b,c=Zb(c,d),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function p(){var b,c,d,e;if(b=Ne,$b.test(a.charAt(Ne))?(c=a.charAt(Ne),Ne++):(c=Cb,0===Te&&g(_b)),c!==Cb){for(d=[],Rb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Sb));e!==Cb;)d.push(e),Rb.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Sb));d!==Cb?(Oe=b,c=Zb(c,d),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function q(){var b,c,d;return b=Ne,46===a.charCodeAt(Ne)?(c=ac,Ne++):(c=Cb,0===Te&&g(bc)),c!==Cb?(d=p(),d!==Cb?(Oe=b,c=cc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function r(){var a,b,c,d;if(a=Ne,b=p(),b!==Cb){for(c=[],d=q();d!==Cb;)c.push(d),d=q();c!==Cb?(Oe=a,b=dc(b,c),a=b):(Ne=a,a=Fb)}else Ne=a,a=Fb;return a}function s(){var b,c,d,e,f;if(b=Ne,39===a.charCodeAt(Ne)?(c=ec,Ne++):(c=Cb,0===Te&&g(fc)),c!==Cb){for(d=[],e=Ne,a.substr(Ne,2)===gc?(f=gc,Ne+=2):(f=Cb,0===Te&&g(hc)),f!==Cb&&(Oe=e,f=ic()),e=f,e===Cb&&(jc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(kc)));e!==Cb;)d.push(e),e=Ne,a.substr(Ne,2)===gc?(f=gc,Ne+=2):(f=Cb,0===Te&&g(hc)),f!==Cb&&(Oe=e,f=ic()),e=f,e===Cb&&(jc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(kc)));d!==Cb?(39===a.charCodeAt(Ne)?(e=ec,Ne++):(e=Cb,0===Te&&g(fc)),e!==Cb?(Oe=b,c=lc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function t(){var b,c,d;return b=Ne,36===a.charCodeAt(Ne)?(c=mc,Ne++):(c=Cb,0===Te&&g(nc)),c!==Cb?(a.length>Ne?(d=a.charAt(Ne),Ne++):(d=Cb,0===Te&&g(oc)),d!==Cb?(Oe=b,c=pc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function u(){var b,c,d;return b=Ne,35===a.charCodeAt(Ne)?(c=qc,Ne++):(c=Cb,0===Te&&g(rc)),c!==Cb?(d=v(),d!==Cb?(Oe=b,c=sc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function v(){var a,b,c;return a=Ne,b=o(),b===Cb&&(b=P(),b===Cb&&(b=Ne,c=s(),c!==Cb&&(Oe=b,c=tc(c)),b=c)),b!==Cb&&(Oe=a,b=uc(b)),a=b}function w(){var a,b;return a=Ne,b=x(),b===Cb&&(b=y(),b===Cb&&(b=z(),b===Cb&&(b=A()))),b!==Cb&&(Oe=a,b=vc(b)),a=b}function x(){var b,c,d,e,f;return b=Ne,c=Ne,d=z(),d===Cb&&(d=A()),d!==Cb?(101===a.charCodeAt(Ne)?(e=wc,Ne++):(e=Cb,0===Te&&g(xc)),e!==Cb?(f=A(),f!==Cb?(d=[d,e,f],c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb)):(Ne=c,c=Fb),c!==Cb&&(Oe=b,c=yc(c)),b=c}function y(){var b,c,d,e,f;if(b=Ne,45===a.charCodeAt(Ne)?(c=Ac,Ne++):(c=Cb,0===Te&&g(Bc)),c===Cb&&(c=zc),c!==Cb)if(a.substr(Ne,3)===Cc?(d=Cc,Ne+=3):(d=Cb,0===Te&&g(Dc)),d!==Cb){if(e=[],Ec.test(a.charAt(Ne))?(f=a.charAt(Ne),Ne++):(f=Cb,0===Te&&g(Fc)),f!==Cb)for(;f!==Cb;)e.push(f),Ec.test(a.charAt(Ne))?(f=a.charAt(Ne),Ne++):(f=Cb,0===Te&&g(Fc));else e=Fb;e!==Cb?(Oe=b,c=Gc(c,e),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;else Ne=b,b=Fb;return b}function z(){var b,c,d,e,f,h;if(b=Ne,45===a.charCodeAt(Ne)?(c=Ac,Ne++):(c=Cb,0===Te&&g(Bc)),c===Cb&&(c=zc),c!==Cb){if(d=[],Hc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ic)),e!==Cb)for(;e!==Cb;)d.push(e),Hc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ic));else d=Fb;if(d!==Cb)if(46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc)),e!==Cb){if(f=[],Hc.test(a.charAt(Ne))?(h=a.charAt(Ne),Ne++):(h=Cb,0===Te&&g(Ic)),h!==Cb)for(;h!==Cb;)f.push(h),Hc.test(a.charAt(Ne))?(h=a.charAt(Ne),Ne++):(h=Cb,0===Te&&g(Ic));else f=Fb;f!==Cb?(Oe=b,c=Jc(c,d,f),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;else Ne=b,b=Fb}else Ne=b,b=Fb;return b}function A(){var b,c,d,e;if(b=Ne,45===a.charCodeAt(Ne)?(c=Ac,Ne++):(c=Cb,0===Te&&g(Bc)),c===Cb&&(c=zc),c!==Cb){if(d=[],Hc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ic)),e!==Cb)for(;e!==Cb;)d.push(e),Hc.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(Ic));else d=Fb;d!==Cb?(Oe=b,c=Kc(c,d),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function B(){var b,c,d;return b=Ne,a.substr(Ne,2)===Lc?(c=Lc,Ne+=2):(c=Cb,0===Te&&g(Mc)),c!==Cb?(d=D(),d!==Cb?(Oe=b,c=sc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function C(){var b,c,d;return b=Ne,40===a.charCodeAt(Ne)?(c=Nc,Ne++):(c=Cb,0===Te&&g(Oc)),c!==Cb?(d=D(),d!==Cb?(Oe=b,c=sc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function D(){var b,c,d,e,f;for(b=Ne,c=[],d=Ne,e=l(),e!==Cb?(f=K(),f===Cb&&(f=C(),f===Cb&&(f=v())),f!==Cb?(Oe=d,e=Pc(f),d=e):(Ne=d,d=Fb)):(Ne=d,d=Fb);d!==Cb;)c.push(d),d=Ne,e=l(),e!==Cb?(f=K(),f===Cb&&(f=C(),f===Cb&&(f=v())),f!==Cb?(Oe=d,e=Pc(f),d=e):(Ne=d,d=Fb)):(Ne=d,d=Fb);return c!==Cb?(d=l(),d!==Cb?(41===a.charCodeAt(Ne)?(e=Qc,Ne++):(e=Cb,0===Te&&g(Rc)),e!==Cb?(Oe=b,c=Sc(c),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function E(){var b,c,d,e,f,h;if(b=Ne,a.substr(Ne,2)===Lc?(c=Lc,Ne+=2):(c=Cb,0===Te&&g(Mc)),c!==Cb){for(d=[],e=Ne,f=l(),f!==Cb?(h=u(),h===Cb&&(h=v()),h!==Cb?(Oe=e,f=Tc(h),e=f):(Ne=e,e=Fb)):(Ne=e,e=Fb);e!==Cb;)d.push(e),e=Ne,f=l(),f!==Cb?(h=u(),h===Cb&&(h=v()),h!==Cb?(Oe=e,f=Tc(h),e=f):(Ne=e,e=Fb)):(Ne=e,e=Fb);d!==Cb?(e=l(),e!==Cb?(41===a.charCodeAt(Ne)?(f=Qc,Ne++):(f=Cb,0===Te&&g(Rc)),f!==Cb?(Oe=b,c=Uc(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function F(){var b,c,d,e,f,h,i;return b=Ne,123===a.charCodeAt(Ne)?(c=Vc,Ne++):(c=Cb,0===Te&&g(Wc)),c!==Cb?(d=l(),d!==Cb?(e=X(),e===Cb&&(e=zc),e!==Cb?(f=l(),f!==Cb?(46===a.charCodeAt(Ne)?(h=ac,Ne++):(h=Cb,0===Te&&g(bc)),h===Cb&&(h=zc),h!==Cb?(125===a.charCodeAt(Ne)?(i=Xc,Ne++):(i=Cb,0===Te&&g(Yc)),i!==Cb?(Oe=b,c=Zc(e),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function G(){var b,c,d,e,f,h;return b=Ne,a.substr(Ne,2)===$c?(c=$c,Ne+=2):(c=Cb,0===Te&&g(_c)),c!==Cb?(d=l(),d!==Cb?(e=vb(),e===Cb&&(e=zc),e!==Cb?(f=l(),f!==Cb?(125===a.charCodeAt(Ne)?(h=Xc,Ne++):(h=Cb,0===Te&&g(Yc)),h!==Cb?(Oe=b,c=ad(e),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function H(){var b,c,d;return b=Ne,c=Ne,a.substr(Ne,4)===bd?(d=bd,Ne+=4):(d=Cb,0===Te&&g(cd)),d!==Cb&&(Oe=c,d=dd()),c=d,c===Cb&&(c=Ne,a.substr(Ne,5)===ed?(d=ed,Ne+=5):(d=Cb,0===Te&&g(fd)),d!==Cb&&(Oe=c,d=gd()),c=d),c!==Cb&&(Oe=b,c=hd(c)),b=c}function I(){var b,c;return b=Ne,a.substr(Ne,3)===id?(c=id,Ne+=3):(c=Cb,0===Te&&g(jd)),c!==Cb&&(Oe=b,c=kd(c)),b=c}function J(){var a;return a=H(),a===Cb&&(a=I()),a}function K(){var a;return a=J(),a===Cb&&(a=w(),a===Cb&&(a=B(),a===Cb&&(a=s(),a===Cb&&(a=u(),a===Cb&&(a=t()))))),a}function L(){var a;return a=G(),a===Cb&&(a=F(),a===Cb&&(a=fb())),a}function M(){var a;return a=L(),a===Cb&&(a=K()),a}function N(){var a,b;return a=Ne,b=m(),b!==Cb&&(Oe=a,b=ld(b)),a=b}function O(){var a,b,c,d,e;return a=Ne,b=l(),b!==Cb?(c=n(),c!==Cb?(d=l(),d!==Cb?(e=mb(),e!==Cb?(Oe=a,b=md(c,e),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function P(){var b,c,d;if(b=Ne,c=[],nd.test(a.charAt(Ne))?(d=a.charAt(Ne),Ne++):(d=Cb,0===Te&&g(od)),d!==Cb)for(;d!==Cb;)c.push(d),nd.test(a.charAt(Ne))?(d=a.charAt(Ne),Ne++):(d=Cb,0===Te&&g(od));else c=Fb;return c!==Cb&&(Oe=b,c=pd(c)),b=c}function Q(){var a,b,c,d,e,f,g;if(a=Ne,b=[],c=Ne,d=l(),d!==Cb?(e=n(),e!==Cb?(f=l(),f!==Cb?(g=m(),g!==Cb?(Oe=c,d=md(e,g),c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb)):(Ne=c,c=Fb)):(Ne=c,c=Fb),c!==Cb)for(;c!==Cb;)b.push(c),c=Ne,d=l(),d!==Cb?(e=n(),e!==Cb?(f=l(),f!==Cb?(g=m(),g!==Cb?(Oe=c,d=md(e,g),c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb)):(Ne=c,c=Fb)):(Ne=c,c=Fb);else b=Fb;return b!==Cb&&(Oe=a,b=qd(b)),a=b}function R(){var a,b,c,d,e;return a=Ne,b=l(),b!==Cb?(c=P(),c!==Cb?(d=l(),d!==Cb?(e=m(),e!==Cb?(Oe=a,b=rd(c,e),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function S(){var a,b,c;return a=Ne,b=l(),b!==Cb?(c=m(),c!==Cb?(Oe=a,b=sd(c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function T(){var a,b,c,d,e;return a=Ne,b=pb(),b!==Cb?(c=Ne,d=l(),d!==Cb?(e=T(),e!==Cb?(Oe=c,d=td(e),c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb),c===Cb&&(c=zc),c!==Cb?(Oe=a,b=ud(b),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function U(){var a,b,c,d,e;return a=Ne,b=ob(),b===Cb&&(b=mb()),b!==Cb?(c=Ne,d=l(),d!==Cb?(e=T(),e!==Cb?(Oe=c,d=vd(e),c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb),c===Cb&&(c=zc),c!==Cb?(Oe=a,b=wd(b,c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function V(){var a;return a=Y(),a===Cb&&(a=qb(),a===Cb&&(a=U())),a}function W(){var b,c,d,e,f;return b=Ne,c=l(),c!==Cb?(46===a.charCodeAt(Ne)?(d=ac,Ne++):(d=Cb,0===Te&&g(bc)),d!==Cb?(e=l(),e!==Cb?(f=V(),f!==Cb?(Oe=b,c=xd(f),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function X(){var a,b,c,d;if(a=Ne,b=V(),b!==Cb){for(c=[],d=W();d!==Cb;)c.push(d),d=W();c!==Cb?(Oe=a,b=yd(b,c),a=b):(Ne=a,a=Fb)}else Ne=a,a=Fb;return a}function Y(){var b,c,d,e,f,h;return b=Ne,c=N(),c!==Cb?(d=l(),d!==Cb?(a.substr(Ne,2)===zd?(e=zd,Ne+=2):(e=Cb,0===Te&&g(Ad)),e!==Cb?(f=l(),f!==Cb?(h=V(),h!==Cb?(Oe=b,c=Bd(c,h),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function Z(){var b,c,d,e,f,h;return b=Ne,94===a.charCodeAt(Ne)?(c=Cd,Ne++):(c=Cb,0===Te&&g(Dd)),c!==Cb?(d=l(),d!==Cb?(e=V(),e!==Cb?(f=l(),f!==Cb?(46===a.charCodeAt(Ne)?(h=ac,Ne++):(h=Cb,0===Te&&g(bc)),h===Cb&&(h=zc),h!==Cb?(Oe=b,c=Ed(e),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function $(){var b,c,d,e,f,h;if(b=Ne,124===a.charCodeAt(Ne)?(c=Fd,Ne++):(c=Cb,0===Te&&g(Gd)),c!==Cb){for(d=[],e=Ne,f=l(),f!==Cb?(h=m(),h!==Cb?(Oe=e,f=Hd(h),e=f):(Ne=e,e=Fb)):(Ne=e,e=Fb);e!==Cb;)d.push(e),e=Ne,f=l(),f!==Cb?(h=m(),h!==Cb?(Oe=e,f=Hd(h),e=f):(Ne=e,e=Fb)):(Ne=e,e=Fb);d!==Cb?(e=l(),e!==Cb?(124===a.charCodeAt(Ne)?(f=Fd,Ne++):(f=Cb,0===Te&&g(Gd)),f!==Cb?(Oe=b,c=Id(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function _(){var b,c,d,e,f,h,i;if(b=Ne,c=[],d=Ne,e=l(),e!==Cb?(58===a.charCodeAt(Ne)?(f=Ub,Ne++):(f=Cb,0===Te&&g(Vb)),f!==Cb?(h=l(),h!==Cb?(i=m(),i!==Cb?(Oe=d,e=Jd(i),d=e):(Ne=d,d=Fb)):(Ne=d,d=Fb)):(Ne=d,d=Fb)):(Ne=d,d=Fb),d!==Cb)for(;d!==Cb;)c.push(d),d=Ne,e=l(),e!==Cb?(58===a.charCodeAt(Ne)?(f=Ub,Ne++):(f=Cb,0===Te&&g(Vb)),f!==Cb?(h=l(),h!==Cb?(i=m(),i!==Cb?(Oe=d,e=Jd(i),d=e):(Ne=d,d=Fb)):(Ne=d,d=Fb)):(Ne=d,d=Fb)):(Ne=d,d=Fb);else c=Fb;return c!==Cb?(d=l(),d!==Cb?(124===a.charCodeAt(Ne)?(e=Fd,Ne++):(e=Cb,0===Te&&g(Gd)),e!==Cb?(Oe=b,c=Kd(c),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function ab(){var b,c,d,e,f,h;return b=Ne,40===a.charCodeAt(Ne)?(c=Nc,Ne++):(c=Cb,0===Te&&g(Oc)),c!==Cb?(d=l(),d!==Cb?(e=V(),e!==Cb?(f=l(),f!==Cb?(41===a.charCodeAt(Ne)?(h=Qc,Ne++):(h=Cb,0===Te&&g(Rc)),h!==Cb?(Oe=b,c=xd(e),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function bb(){var b,c,d,e,f,h,i,j;if(b=Ne,c=Z(),c!==Cb){for(d=[],46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc));e!==Cb;)d.push(e),46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc));d!==Cb?(Oe=b,c=Ld(c),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;if(b===Cb){if(b=Ne,c=X(),c!==Cb)if(d=l(),d!==Cb){if(e=[],46===a.charCodeAt(Ne)?(f=ac,Ne++):(f=Cb,0===Te&&g(bc)),f!==Cb)for(;f!==Cb;)e.push(f),46===a.charCodeAt(Ne)?(f=ac,Ne++):(f=Cb,0===Te&&g(bc));else e=Fb;if(e!==Cb)if(f=l(),f!==Cb)if(h=Z(),h!==Cb){for(i=[],46===a.charCodeAt(Ne)?(j=ac,Ne++):(j=Cb,0===Te&&g(bc));j!==Cb;)i.push(j),46===a.charCodeAt(Ne)?(j=ac,Ne++):(j=Cb,0===Te&&g(bc));i!==Cb?(Oe=b,c=Md(c,h),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;else Ne=b,b=Fb;else Ne=b,b=Fb}else Ne=b,b=Fb;else Ne=b,b=Fb;if(b===Cb)if(b=Ne,c=X(),c===Cb&&(c=zc),c!==Cb){for(d=[],46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc));e!==Cb;)d.push(e),46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc));d!==Cb?(Oe=b,c=Nd(c),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb}return b}function cb(){var b,c,d,e;return b=Ne,c=Ne,d=V(),d!==Cb?(46===a.charCodeAt(Ne)?(e=ac,Ne++):(e=Cb,0===Te&&g(bc)),e!==Cb?(Oe=c,d=Od(d),c=d):(Ne=c,c=Fb)):(Ne=c,c=Fb),c===Cb&&(c=rb()),c!==Cb&&(Oe=b,c=Pd(c)),b=c}function db(){var a;return a=rb(),a===Cb&&(a=eb()),a}function eb(){var a,b,c,d,e;return a=Ne,b=$(),b===Cb&&(b=zc),b!==Cb?(c=l(),c!==Cb?(d=bb(),d===Cb&&(d=zc),d!==Cb?(e=l(),e!==Cb?(Oe=a,b=Qd(b,d),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function fb(){var b,c,d,e,f,h,i;return b=Ne,91===a.charCodeAt(Ne)?(c=Rd,Ne++):(c=Cb,0===Te&&g(Sd)),c!==Cb?(d=_(),d===Cb&&(d=zc),d!==Cb?(e=l(),e!==Cb?(f=db(),f===Cb&&(f=zc),f!==Cb?(h=l(),h!==Cb?(93===a.charCodeAt(Ne)?(i=Td,Ne++):(i=Cb,0===Te&&g(Ud)),i!==Cb?(Oe=b,c=Vd(d,f),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function gb(){var a,b;return a=M(),a===Cb&&(a=Ne,b=r(),b!==Cb&&(Oe=a,b=Wd(b)),a=b,a===Cb&&(a=N(),a===Cb&&(a=ab()))),a}function hb(){var b,c,d,e,f;return b=Ne,c=l(),c!==Cb?(d=m(),d!==Cb?(e=Ne,Te++,58===a.charCodeAt(Ne)?(f=Ub,Ne++):(f=Cb,0===Te&&g(Vb)),Te--,f===Cb?e=Xd:(Ne=e,e=Fb),e!==Cb?(Oe=b,c=Yd(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function ib(){var a,b,c,d,e;return a=Ne,b=hb(),b!==Cb?(c=l(),c!==Cb?(d=ib(),d===Cb&&(d=zc),d!==Cb?(e=l(),e!==Cb?(Oe=a,b=Zd(b,d),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function jb(){var a,b,c,d;return a=Ne,b=gb(),b!==Cb?(c=l(),c!==Cb?(d=ib(),d===Cb&&(d=zc),d!==Cb?(Oe=a,b=$d(b,d),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function kb(){var a,b,c,d,e;return a=Ne,b=l(),b!==Cb?(c=P(),c!==Cb?(d=l(),d!==Cb?(e=jb(),e===Cb&&(e=gb()),e!==Cb?(Oe=a,b=_d(c,e),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function lb(){var a,b,c;return a=Ne,b=kb(),b!==Cb?(c=lb(),c===Cb&&(c=zc),c!==Cb?(Oe=a,b=Zd(b,c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function mb(){var a,b,c;return a=Ne,b=jb(),b!==Cb?(c=lb(),c===Cb&&(c=zc),c!==Cb?(Oe=a,b=$d(b,c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function nb(){var a,b,c;if(a=Ne,b=[],c=O(),c!==Cb)for(;c!==Cb;)b.push(c),c=O();else b=Fb;return b!==Cb&&(Oe=a,b=ae(b)),a=b}function ob(){var a,b,c;return a=Ne,b=mb(),b!==Cb?(c=nb(),c!==Cb?(Oe=a,b=be(b,c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a
}function pb(){var a;return a=kb(),a===Cb&&(a=hb(),a===Cb&&(a=nb())),a}function qb(){var b,c,d,e,f,h,i,j,k;if(b=Ne,c=l(),c!==Cb)if(d=ob(),d===Cb&&(d=mb()),d!==Cb){if(e=[],f=Ne,h=l(),h!==Cb?(59===a.charCodeAt(Ne)?(i=ce,Ne++):(i=Cb,0===Te&&g(de)),i!==Cb?(j=l(),j!==Cb?(k=pb(),k!==Cb?(Oe=f,h=ee(k),f=h):(Ne=f,f=Fb)):(Ne=f,f=Fb)):(Ne=f,f=Fb)):(Ne=f,f=Fb),f!==Cb)for(;f!==Cb;)e.push(f),f=Ne,h=l(),h!==Cb?(59===a.charCodeAt(Ne)?(i=ce,Ne++):(i=Cb,0===Te&&g(de)),i!==Cb?(j=l(),j!==Cb?(k=pb(),k!==Cb?(Oe=f,h=ee(k),f=h):(Ne=f,f=Fb)):(Ne=f,f=Fb)):(Ne=f,f=Fb)):(Ne=f,f=Fb);else e=Fb;e!==Cb?(Oe=b,c=fe(d,e),b=c):(Ne=b,b=Fb)}else Ne=b,b=Fb;else Ne=b,b=Fb;return b}function rb(){var b,c,d,e,f;if(b=Ne,60===a.charCodeAt(Ne)?(c=ge,Ne++):(c=Cb,0===Te&&g(he)),c!==Cb){for(d=[],e=Ne,a.substr(Ne,2)===ie?(f=ie,Ne+=2):(f=Cb,0===Te&&g(je)),f!==Cb&&(Oe=e,f=ke()),e=f,e===Cb&&(le.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(me)));e!==Cb;)d.push(e),e=Ne,a.substr(Ne,2)===ie?(f=ie,Ne+=2):(f=Cb,0===Te&&g(je)),f!==Cb&&(Oe=e,f=ke()),e=f,e===Cb&&(le.test(a.charAt(Ne))?(e=a.charAt(Ne),Ne++):(e=Cb,0===Te&&g(me)));d!==Cb?(62===a.charCodeAt(Ne)?(e=ne,Ne++):(e=Cb,0===Te&&g(oe)),e!==Cb?(Oe=b,c=pe(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;return b}function sb(){var a,b,c,d,e;return a=Ne,b=Q(),b===Cb&&(b=R(),b===Cb&&(b=S())),b!==Cb?(c=l(),c!==Cb?(d=db(),d===Cb&&(d=zc),d!==Cb?(e=l(),e!==Cb?(Oe=a,b=qe(b,d),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function tb(){var a,b,c;return a=Ne,b=mb(),b!==Cb?(Oe=Ne,c=re(b),c=c?Xd:Fb,c!==Cb?(Oe=a,b=se(b),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function ub(){var b,c,d,e,f;return b=Ne,c=l(),c!==Cb?(46===a.charCodeAt(Ne)?(d=ac,Ne++):(d=Cb,0===Te&&g(bc)),d!==Cb?(e=l(),e!==Cb?(f=tb(),f!==Cb?(Oe=b,c=xd(f),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function vb(){var a,b,c,d;if(a=Ne,b=tb(),b!==Cb){for(c=[],d=ub();d!==Cb;)c.push(d),d=ub();c!==Cb?(Oe=a,b=te(b,c),a=b):(Ne=a,a=Fb)}else Ne=a,a=Fb;return a}function wb(){var b,c,d,e,f,h,i,j,k,m,n,p,q,r,s,t,v,w,x;return b=Ne,c=o(),c!==Cb?(d=l(),d!==Cb?(a.substr(Ne,9)===ue?(e=ue,Ne+=9):(e=Cb,0===Te&&g(ve)),e!==Cb?(f=l(),f!==Cb?(h=u(),h!==Cb?(i=l(),i!==Cb?(a.substr(Ne,10)===we?(j=we,Ne+=10):(j=Cb,0===Te&&g(xe)),j===Cb&&(a.substr(Ne,22)===ye?(j=ye,Ne+=22):(j=Cb,0===Te&&g(ze))),j!==Cb?(k=l(),k!==Cb?(m=E(),m!==Cb?(n=Ne,p=l(),p!==Cb?(a.substr(Ne,19)===Ae?(q=Ae,Ne+=19):(q=Cb,0===Te&&g(Be)),q!==Cb?(r=l(),r!==Cb?(s=E(),s!==Cb?(t=l(),t!==Cb?(a.substr(Ne,17)===Ce?(v=Ce,Ne+=17):(v=Cb,0===Te&&g(De)),v!==Cb?(w=l(),w!==Cb?(x=E(),x!==Cb?(p=[p,q,r,s,t,v,w,x],n=p):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb)):(Ne=n,n=Fb),n===Cb&&(n=zc),n!==Cb?(p=l(),p!==Cb?(46===a.charCodeAt(Ne)?(q=ac,Ne++):(q=Cb,0===Te&&g(bc)),q!==Cb?(Oe=b,c=Ee(c,h,m),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b}function xb(){var b,c,d,e,f,h,i,k,m;if(b=Ne,33===a.charCodeAt(Ne)?(c=Fe,Ne++):(c=Cb,0===Te&&g(Ge)),c!==Cb)if(d=r(),d!==Cb)if(e=l(),e!==Cb){if(f=Ne,a.substr(Ne,5)===He?(h=He,Ne+=5):(h=Cb,0===Te&&g(Ie)),h!==Cb){if(i=[],k=j(),k!==Cb)for(;k!==Cb;)i.push(k),k=j();else i=Fb;i!==Cb?(h=[h,i],f=h):(Ne=f,f=Fb)}else Ne=f,f=Fb;f===Cb&&(f=zc),f!==Cb?(h=sb(),h!==Cb?(33===a.charCodeAt(Ne)?(i=Fe,Ne++):(i=Cb,0===Te&&g(Ge)),i!==Cb?(k=l(),k===Cb&&(k=zc),k!==Cb?(46===a.charCodeAt(Ne)?(m=ac,Ne++):(m=Cb,0===Te&&g(bc)),m!==Cb?(Oe=b,c=Je(d,f,h),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb)}else Ne=b,b=Fb;else Ne=b,b=Fb;else Ne=b,b=Fb;return b}function yb(){var a,b,c,d;return a=Ne,b=l(),b===Cb&&(b=zc),b!==Cb?(c=xb(),c===Cb&&(c=wb(),c===Cb&&(c=cb())),c!==Cb?(d=l(),d===Cb&&(d=zc),d!==Cb?(Oe=a,b=Ke(c),a=b):(Ne=a,a=Fb)):(Ne=a,a=Fb)):(Ne=a,a=Fb),a}function zb(){var a,b,c,d,e;if(a=Ne,b=Ne,c=l(),c===Cb&&(c=zc),c!==Cb?(d=$(),d!==Cb?(e=l(),e===Cb&&(e=zc),e!==Cb?(Oe=b,c=Le(d),b=c):(Ne=b,b=Fb)):(Ne=b,b=Fb)):(Ne=b,b=Fb),b===Cb&&(b=yb()),b!==Cb){for(c=[],d=yb();d!==Cb;)c.push(d),d=yb();c!==Cb?(Oe=a,b=Me(b,c),a=b):(Ne=a,a=Fb)}else Ne=a,a=Fb;return a}var Ab,Bb=arguments.length>1?arguments[1]:{},Cb={},Db={start:i},Eb=i,Fb=Cb,Gb=/^[ \t\x0B\f\xA0\uFEFF\n\r\u2028\u2029]/,Hb={type:"class",value:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]",description:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]"},Ib='"',Jb={type:"literal",value:'"',description:'"\\""'},Kb='""',Lb={type:"literal",value:'""',description:'"\\"\\""'},Mb=function(){return'"'},Nb=/^[^"]/,Ob={type:"class",value:'[^"]',description:'[^"]'},Pb=/^[a-zA-Z]/,Qb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Rb=/^[a-zA-Z0-9]/,Sb={type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},Tb=function(a,b){return a+b.join("")},Ub=":",Vb={type:"literal",value:":",description:'":"'},Wb=function(a,b){return a+b},Xb=/^[a-zA-Z0-9:]/,Yb={type:"class",value:"[a-zA-Z0-9:]",description:"[a-zA-Z0-9:]"},Zb=function(a,b){return a+b.join("")},$b=/^[A-Z]/,_b={type:"class",value:"[A-Z]",description:"[A-Z]"},ac=".",bc={type:"literal",value:".",description:'"."'},cc=function(a){return a},dc=function(a,b){return[a].concat(b).join(".")},ec="'",fc={type:"literal",value:"'",description:'"\'"'},gc="''",hc={type:"literal",value:"''",description:"\"''\""},ic=function(){return"'"},jc=/^[^']/,kc={type:"class",value:"[^']",description:"[^']"},lc=function(a){return new Blether.String(a.join("")).at(d(),e(),c())},mc="$",nc={type:"literal",value:"$",description:'"$"'},oc={type:"any",description:"any character"},pc=function(a){return new Blether.String(a).at(d(),e(),c())},qc="#",rc={type:"literal",value:"#",description:'"#"'},sc=function(a){return a},tc=function(a){return a.value},uc=function(a){return new Blether.Symbol(a).at(d(),e(),c())},vc=function(a){return new Blether.Number(a).at(d(),e(),c())},wc="e",xc={type:"literal",value:"e",description:'"e"'},yc=function(a){return parseFloat(a.join(""))},zc=null,Ac="-",Bc={type:"literal",value:"-",description:'"-"'},Cc="16r",Dc={type:"literal",value:"16r",description:'"16r"'},Ec=/^[0-9a-fA-F]/,Fc={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Gc=function(a,b){return parseInt((a||"")+b.join(""),16)},Hc=/^[0-9]/,Ic={type:"class",value:"[0-9]",description:"[0-9]"},Jc=function(a,b,c){return parseFloat((a||"")+b.join("")+"."+c.join(""),10)},Kc=function(a,b){return parseInt((a||"")+b.join(""),10)},Lc="#(",Mc={type:"literal",value:"#(",description:'"#("'},Nc="(",Oc={type:"literal",value:"(",description:'"("'},Pc=function(a){return a},Qc=")",Rc={type:"literal",value:")",description:'")"'},Sc=function(a){return new Blether.Array(a).at(d(),e(),c())},Tc=function(a){return a},Uc=function(a){return new Blether.Array(a).at(d(),e(),c())},Vc="{",Wc={type:"literal",value:"{",description:'"{"'},Xc="}",Yc={type:"literal",value:"}",description:'"}"'},Zc=function(a){return new Blether.DynamicArray(a).at(d(),e(),c())},$c="#{",_c={type:"literal",value:"#{",description:'"#{"'},ad=function(a){return new Blether.DynamicDictionary(a).at(d(),e(),c())},bd="true",cd={type:"literal",value:"true",description:'"true"'},dd=function(){return!0},ed="false",fd={type:"literal",value:"false",description:'"false"'},gd=function(){return!1},hd=function(a){return new Blether.Boolean(a).at(d(),e(),c())},id="nil",jd={type:"literal",value:"nil",description:'"nil"'},kd=function(){return(new Blether.UndefinedObject).at(d(),e(),c())},ld=function(a){if("this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Use [self] instead of [this]"});return new Blether.Variable(a).at(d(),e(),c())},md=function(a,b){return{key:a,arg:b}},nd=/^[\\+*\/=><,@%~|&\-]/,od={type:"class",value:"[\\\\+*\\/=><,@%~|&\\-]",description:"[\\\\+*\\/=><,@%~|&\\-]"},pd=function(a){return a.join("")},qd=function(a){return new Blether.KeywordPattern(a).at(d(),e(),c())},rd=function(a,b){return new Blether.BinaryPattern(a,b).at(d(),e(),c())},sd=function(a){return new Blether.UnaryPattern(a).at(d(),e(),c())},td=function(a){return a},ud=function(a){return chain?chain.setReceiver(a):new Blether.send(a).at(d(),e(),c())},vd=function(a){return a},wd=function(a,b){return b?b.setReceiver(a):a},xd=function(a){return a},yd=function(a,b){return[a].concat(b)},zd=":=",Ad={type:"literal",value:":=",description:'":="'},Bd=function(a,b){return new Blether.Assignment(a,b).at(d(),e(),c())},Cd="^",Dd={type:"literal",value:"^",description:'"^"'},Ed=function(a){return new Blether.Return(a).at(d(),e(),c())},Fd="|",Gd={type:"literal",value:"|",description:'"|"'},Hd=function(a){return a},Id=function(a){return a.forEach(function(a){if("self"===a||"this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Cannot name a variable ["+a+"]"})}),a},Jd=function(a){return a},Kd=function(a){return a},Ld=function(a){return[a]},Md=function(a,b){var c=a;return c.push(b),c},Nd=function(a){return a||[]},Od=function(a){return a},Pd=function(a){return new Blether.Statement(a).at(d(),e(),c())},Qd=function(a,b){return new Blether.Sequence(a,b).at(d(),e(),c())},Rd="[",Sd={type:"literal",value:"[",description:'"["'},Td="]",Ud={type:"literal",value:"]",description:'"]"'},Vd=function(a,b){return new Blether.Block(a,b).at(d(),e(),c())},Wd=function(a){return new Blether.ClassName(a).at(d(),e(),c())},Xd=void 0,Yd=function(a){return new Blether.Send(a).at(d(),e(),c())},Zd=function(a,b){return b?b.setReceiver(a):a},$d=function(a,b){return b?b.setReceiver(a):a},_d=function(a,b){return new Blether.Send(a,[b]).at(d(),e(),c())},ae=function(a){for(var b=[],f=[],g=0;g<a.length;g++)b.push(a[g].key),f.push(a[g].arg);return new Blether.Send(b.join(""),f).at(d(),e(),c())},be=function(a,b){return b.setReceiver(a)},ce=";",de={type:"literal",value:";",description:'";"'},ee=function(a){return a},fe=function(a,b){return new Blether.Cascade(a.receiver,[a].concat(b)).at(d(),e(),c())},ge="<",he={type:"literal",value:"<",description:'"<"'},ie=">>",je={type:"literal",value:">>",description:'">>"'},ke=function(){return">"},le=/^[^>]/,me={type:"class",value:"[^>]",description:"[^>]"},ne=">",oe={type:"literal",value:">",description:'">"'},pe=function(a){return new Blether.JsStatement(a.join("")).at(d(),e(),c())},qe=function(a,b){return new Blether.Method(a,b).at(d(),e(),c())},re=function(a){return"->"===a.selector},se=function(a){return[a.receiver,a.args[0]]},te=function(a,b){return a.concat.apply(a,b)},ue="subclass:",ve={type:"literal",value:"subclass:",description:'"subclass:"'},we="variables:",xe={type:"literal",value:"variables:",description:'"variables:"'},ye="instanceVariableNames:",ze={type:"literal",value:"instanceVariableNames:",description:'"instanceVariableNames:"'},Ae="classVariableNames:",Be={type:"literal",value:"classVariableNames:",description:'"classVariableNames:"'},Ce="poolDictionaries:",De={type:"literal",value:"poolDictionaries:",description:'"poolDictionaries:"'},Ee=function(a,b,f){if(!b.value.match(/^[A-Z]/))throw Blether.ParseError({line:d(),column:e(),msg:"Class name "+b+" must start with a capital"});if(Blether.classes[b])throw Blether.ParseError({line:d(),column:e(),msg:"Class "+b+" already defined"});return Blether.classes[b]=new Blether.ClassDeclaration(b,a,f).at(d(),e(),c())},Fe="!",Ge={type:"literal",value:"!",description:'"!"'},He="class",Ie={type:"literal",value:"class",description:'"class"'},Je=function(a,b,f){if("Object"!==a&&!Blether.classes[a])throw Blether.ParseError({line:d(),column:e(),msg:"Unknown class "+a});if(b){if(Blether.classes[a].classMethods.hasOwnProperty(f.selector))throw Blether.ParseError({line:d(),column:e(),msg:"Class method "+f.selector+" already defined on class "+a});return Blether.classes[a].classMethods[f.selector]=new Blether.ClassMethodDeclaration(a,f).at(d(),e(),c())}if(Blether.classes[a].methods.hasOwnProperty(f.selector))throw Blether.ParseError({line:d(),column:e(),msg:"Method "+f.selector+" already defined on class "+a});return Blether.classes[a].methods[f.selector]=new Blether.MethodDeclaration(a,f).at(d(),e(),c())},Ke=function(a){return a},Le=function(a){return new Blether.VariableDeclaration(a)},Me=function(a,b){return new Blether.Program([a].concat(b)).at(d(),e(),c())},Ne=0,Oe=0,Pe=0,Qe={line:1,column:1,seenCR:!1},Re=0,Se=[],Te=0;if("startRule"in Bb){if(!(Bb.startRule in Db))throw new Error("Can't start parsing from rule \""+Bb.startRule+'".');Eb=Db[Bb.startRule]}if(Blether.classes={Object:{classMethods:{},methods:{}}},Ab=Eb(),Ab!==Cb&&Ne===a.length)return Ab;throw Ab!==Cb&&Ne<a.length&&g({type:"end",description:"end of input"}),h(null,Se,Re)}return a(b,Error),{SyntaxError:b,parse:c}}(),BletherReturnOperatorVisitor=function(){function a(){return!1}function b(){return!0}this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){for(var b=0;b<a.elements.length;b++)if(a.elements[b].visit(this))return!0;return!1},this.visitClassDeclaration=function(a){for(var b in a.methods)if(a.methods.hasOwnProperty(b)&&a.methods[b].visit(this))return!0;return!1},this.visitMethodDeclaration=function(a){return a.body.visit(this)},this.visitMethod=function(a){for(var b=0;b<a.sequences.length;b++)if(a.sequences[b].visit(this))return!0;return!1},this.visitStatement=function(a){return a.expression.visit(this)},this.visitSequence=function(a){for(var b=0;b<a.statements.length;b++)if(a.statements[b].visit(this))return!0;return!1},this.visitSend=function(a){if(null!==a.receiver&&a.receiver.visit(this))return!0;for(var b=0;b<a.args.length;b++)if(a.args[b].visit(this))return!0;return!1},this.visitAssignment=function(a){return a.expression.visit(this)},this.visitBlock=function(a){return a.sequence.visit(this)},this.visitCascade=function(a){if(a.receiver.visit(this))return!0;for(var b=0;b<a.messages.length;b++)if(a.messages[b].visit(this))return!0;return!1},this.visitDynamicArray=function(a){for(var b=0;b<a.values.length;b++)if(a.values[b].visit(this))return!0;return!1},this.visitDynamicDictionary=function(a){for(var b in a.values)if(a.values.hasOwnProperty(b)&&a.values[b].visit(this))return!0;return!1},this.visitReturn=b,this.visitBinaryPattern=a,this.visitKeywordPattern=a,this.visitString=a,this.visitSymbol=a,this.visitUnaryPattern=a,this.visitNumber=a,this.visitUndefinedObject=a,this.visitBoolean=a,this.visitArray=a,this.visitJsStatement=a,this.visitVariableDeclaration=a,this.visitVariable=a,this.visitClassName=a},BletherTranslator=function(){"use strict";function a(a,b,c){if(a.params.length>b)throw Blether.ParseError({line:a.line,column:a.column,msg:"Too many parameters specified in block argument to "+c})}var b={};this.ensureNamespace=function(a){var c=a.value.split(".");if(1===c.length)return"";if(b.hasOwnProperty(a))return"";var d=c[0],e="var "+d+" = "+d+" || {};\n";b[d]=!0;for(var f=c.length-1,g=1;f>g;g++)d=d+"."+c[g],e+=d+" = "+d+" || {};\n",b[d]=!0;return e},this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){var b=this;this.context=new Blether.ContextMgr;var c="";return a.elements.forEach(function(a){("ClassMethodDeclaration"!==a._type&&"MethodDeclaration"!==a._type||"undefined"==typeof a.getClass().superClass)&&(c+=a.visit(b))}),c},this.visitClassDeclaration=function(a){var b=this,c="",d="Object"!==a.superClass,e=a.varNames.value;a.isNamespaced()?(c+=this.ensureNamespace(a.className),c+=a.className+" = function("):c+="function "+a.className+"(",c+=e.map(function(a){return"_"+a.value}).join(", "),c+=") {\n",e.forEach(function(a){var b=a.value;c+="this."+b+" = _"+b+";\n"}),c+="}"+(a.isNamespaced()?";":"")+"\n\n",d&&(c+=a.className+".prototype = Object.create("+a.superClass+".prototype);\n",c+=a.className+".prototype.constructor = "+a.superClass+";\n\n"),this.context.pushClass(a.className.value,e.map(function(a){return a.value}));var f=a.getMethods();for(var g in f)f.hasOwnProperty(g)&&(c+=f[g].visit(b));var h=a.getClassMethods();for(var i in h)h.hasOwnProperty(i)&&(c+=h[i].visit(b));return this.context.pop(),c},this.visitMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+".prototype."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitClassMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+"."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitString=function(a){return'"'+a.value.replace(/"/g,'\\"')+'"'},this.visitMethod=function(a){var b=a.selector.visit(this)[1];this.context.pushMethod(b);var c="function("+b.join(", ")+") {\n";if("JsStatement"===a.sequence._type)return c+=a.sequence.visit(this),c+="\n}";c+="var self = this;\n";for(var d=!1,e=new BletherReturnOperatorVisitor,f=0;f<a.sequence.statements.length;f++){var g=a.sequence.statements[f];if("Return"!==g._type&&e.visit(g)){d=!0;break}}d&&(c+="try {\n");var h=this;return c+=a.sequence.visit(h),d&&(c+="}\n",c+="catch (e) {\n",c+="  if (e instanceof STReturnValue) {\n",c+="    return e.value;\n",c+="  }\n",c+="  else {\n",c+="    throw e;\n",c+="  }\n",c+="}\n"),c+="}",this.context.pop(),c},this.visitUnaryPattern=function(a){return[convertSelector(a.selector),[]]},this.visitBinaryPattern=function(a){return[convertSelector(a.selector),[a.arg]]},this.visitKeywordPattern=function(a){var b=this,c=a.pairs.map(function(a){return a.key}),d=a.pairs.map(function(a){return a.arg}),e={};return d.forEach(function(c){if(e[c]=(e[c]||0)+1,e[c]>1)throw Blether.ParseError({line:a.line,column:a.column,msg:"Argument name "+c+" repeats in method "+b.context.currentClass()+">>"+a.selector})}),[convertSelector(c.join("")),d]},this.visitSymbol=function(a){return this.visitString(a)},this.visitClassName=function(a){return a.value},this.visitStatement=function(a){var b=a.expression.visit(this);return b+=";"!==b[b.length-1]?";\n":"\n"},this.visitSequence=function(a){var b=this,c="";this.context.pushTemps(a.temps),a.temps.length>0&&(c+="var "+a.temps.join(", ")+";\n");var d=!0;return a.statements.forEach(function(a,e,f){e===f.length-1&&("method"!==b.context.returnContext()?"Return"!==a._type?c+="return ":d=!1:"Return"===a._type&&(d=!1)),c+=a.visit(b)+";\n"}),d&&"method"===b.context.returnContext()&&(c+="return self;\n"),this.context.pop(),c},this.visitSend=function(a){var b=this,c=a.receiver.visit(this);switch("Block"===a.receiver._type&&(c="("+c+")"),c){case"super":return this.convertSuper(convertSelector(a.selector),a);case"NodeJS":return this.convertNodeJS(a)}var d="";if("value"===a.selector||a.selector.match(/^(value:)+$/))return d=c+".__value$(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")";switch(a.selector){case"at:":d+=this.convertAt(c,a.args[0]);break;case"at:put:":d+=this.convertAtPut(c,a.args[0],a.args[1]);break;case"isNil":d+="(typeof ("+c+') === "undefined" || '+c+" === null)";break;case"notNil":d+="(typeof ("+c+') !== "undefined" && '+c+" !== null)";break;case"isEmpty":d+="("+c+".length === 0)";break;case"ifEmpty:":d+=this.convertIfEmpty(c,a);break;case"ifNotEmpty:":d+=this.convertIfNotEmpty(c,a);break;case"notEmpty":d+="("+c+".length > 0)";break;case"ifNil:":d=this.convertIfNil(c,a);break;case"ifNotNil:":d=this.convertIfNotNil(c,a);break;case"ifNil:ifNotNil:":d=this.convertIfNilIfNotNil(c,a);break;case"new":d=this.convertNew(c);break;case"whileTrue:":case"whileFalse:":d=this.convertWhile(a);break;case"ifTrue:":case"ifFalse:":d=this.convertSingleIf(a);break;case"ifTrue:ifFalse:":case"ifFalse:ifTrue:":d=this.convertIfTrueIfFalse(a);break;case"and:":case"or:":d=this.convertAndOr(c,a);break;case"==":d=c+" === "+a.args[0].visit(b);break;case"~~":d=c+" !== "+a.args[0].visit(b);break;case"~=":d="!("+c+".equals$("+a.args[0].visit(b)+"))";break;case"asJQuery":d="jQuery("+c+")";break;default:d=c+"."+convertSelector(a.selector)+"(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")"}return d},this.visitAssignment=function(a){return a.variable.visit(this)+" = "+a.expression.visit(this)},this.visitNumber=function(a){return"("+a.value.toString()+")"},this.visitVariable=function(a){var b;if("self"===a.value)return"self";if("STReturnValue"===a.value)throw Blether.ParseError({line:a.line,column:a.column,msg:"Do not refer directly to STReturnValue - use the caret operator instead"});var c=this.context.getTemps();for(b=0;b<c.length;b++)if(a.value===c[b])return a.value;var d=this.context.getInstanceVars();for(b=0;b<d.length;b++)if(a.value===d[b])return"self."+a.value;if(a.value.match(/^[A-Z]/))return a.value;throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown variable name ["+a.value+"]"})},this.visitUndefinedObject=function(){return"null"},this.visitBoolean=function(a){return a.value.toString()},this.invokeBlock=function(a){if(0===a.sequence.statements.length)return"null";var b=[];if(arguments.length>1)for(var c=1;c<arguments.length;c++)b.push(arguments[c]);if(a.params.length!==b.length)throw Blether.ParseError({line:a.line,column:a.column,msg:"Not enough parameters specified to block"});if(1===a.sequence.statements.length&&0===a.sequence.temps.length){var d={};b.forEach(function(b,c){d[a.params[c]]=b}),a.find(function(a){return"Variable"===a._type}).forEach(function(a){d.hasOwnProperty(a.value)&&(a.value=d[a])}),this.context.pushTemps(b);var e=a.sequence.statements[0].visit(this);return this.context.pop(),e}return"("+a.visit(this)+")("+b.join(", ")+")"},this.visitBlock=function(a){this.context.pushBlock(a.params);var b="function("+a.params.join(", ")+") {\n";return b+=a.sequence.visit(this),b+="}",this.context.pop(),b},this.visitCascade=function(a){var b,c=this,d=!1;switch(a.receiver._type){case"Variable":case"String":case"Symbol":case"Number":case"Boolean":case"UndefinedObject":case"ClassName":d=!0}var e,f,g;if(d)f=a.messages.map(function(b){return b.receiver=a.receiver,b}),e=new Blether.Sequence([],f),g=new Blether.Block([],e),b="("+g.visit(c)+")()";else{var h=this.context.pushReceiver();f=a.messages.map(function(a){return a.receiver=new Blether.Variable(h),a}),e=new Blether.Sequence([],f),g=new Blether.Block([h],e),b="("+g.visit(c)+")("+a.receiver.visit(c)+")",this.context.popReceiver()}return b},this.visitJsStatement=function(a){return a.javascript.trim()},this.visitVariableDeclaration=function(a){return this.context.pushTemps(a.variables),"var "+a.variables.join(", ")+";\n"},this.visitArray=function(a){var b=this;return"["+a.value.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicArray=function(a){var b=this;return"["+a.values.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicDictionary=function(a){if(0===a.values.length)return"Object.create(null)";var b="(function() {\n";b+="var _dict = Object.create(null);\n";for(var c=0,d=1;d<a.values.length;c+=2,d+=2)b+="String"===a.values[c]._type||"Symbol"===a.values[c]._type?"_dict."+a.values[c].value+" = "+a.values[d].visit(this)+";\n":"_dict["+a.values[c].visit(this)+"] = "+a.values[d].visit(this)+";\n";return b+="return _dict;\n",b+="})()"},this.visitReturn=function(a){return"method"===this.context.returnContext()?"return "+a.value.visit(this):"stReturn("+a.value.visit(this)+")"},this.convertIfEmpty=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return ("+e+".length === 0) ? "+d.invoke(this)+" : null;\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotEmpty=function(b,c){var d=c.args[0];a(d,1,"ifNotEmpty:");var e,f=this.context.pushReceiver();return e="(function("+f+") {\n",e+="return ("+f+".length > 0) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,f),e+=" : null;\n",e+="})("+b+")",this.context.popReceiver(),e},this.convertIfNil=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return (typeof "+e+' === "undefined" || '+e+" === null) ",c+="? "+d.invoke(this)+" : "+e+";\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotNil=function(b,c){var d=c.args[0];a(d,1,"ifNotNil:");var e,f=1===d.params.length,g=f?d.params[0]:this.context.pushReceiver();return e="(function("+g+") {\n",e+="return (typeof "+g+' !== "undefined" && '+g+" !== null) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,g),e+=" : null;\n",e+="})("+b+")",f||this.context.popReceiver(),e},this.convertIfNilIfNotNil=function(b,c){var d=c.args[0],e=c.args[1];a(d,0,"ifNil:"),a(e,1,"ifNotNil:");var f=1===e.params.length,g=f?e.params[0]:this.context.pushReceiver(),h="(function("+g+") {\n";return h+="return (typeof "+g+' === "undefined" || '+g+" === null)",h+=" ? "+d.invoke(this)+" : ",h+=0===e.params.length?e.invoke(this):e.invoke(this,g),h+=";\n",h+="})("+b+")",f||this.context.popReceiver(),h},this.convertNew=function(a){return"new "+a+"()"},this.convertSuper=function(a,b){var c=this;if("undefined"!=typeof this.context.currentClass()){var d=this.context.currentClass()+".__super__."+a+".call(self";return b.args.length>0&&b.args.forEach(function(a){d+=", "+a.visit(c)}),d+=")"}throw Blether.ParseError({line:b.line,column:b.column,msg:"Can't use [super] outside a method declaration"})},this.convertWhile=function(a){if("Block"!==a.receiver._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" can be sent to blocks only"});var b,c="whileFalse:"===a.selector?"!":"";b=c+a.receiver.invoke(this);var d="while ("+b+") {\n";return d+=a.args[0].invoke(this)+";\n",d+="}\n"},this.convertSingleIf=function(a){if("Block"!==a.args[0]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b="ifFalse:"===a.selector?"!":"";return b?a.receiver.visit(this)+" ? null : "+a.args[0].invoke(this):a.receiver.visit(this)+" ? "+a.args[0].invoke(this)+" : null"},this.convertIfTrueIfFalse=function(a){if("Block"!==a.args[0]._type||"Block"!==a.args[1]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b=0,c=1;return"ifFalse:ifTrue:"===a.selector&&(b=1,c=0),a.receiver.visit(this)+" ? "+a.args[b].invoke(this)+" : "+a.args[c].invoke(this)},this.convertAt=function(a,b){return"String"===b._type||"Symbol"===b._type?a+"."+b.value:a+"["+b.visit(this)+"]"},this.convertAtPut=function(a,b,c){return"String"===b._type||"Symbol"===b._type?a+"."+b.value+" = "+c.visit(this):a+"["+b.visit(this)+"] = "+c.visit(this)},this.convertAndOr=function(a,b){if("Block"!==b.args[0]._type)throw Blether.ParseError({line:b.line,column:b.column,msg:b.selector+" accepts literal blocks only"});var c="and:"===b.selector?" && ":" || ";return a+c+b.args[0].invoke(this)},this.convertNodeJS=function(a){var b=this;switch(a.selector){case"filename":return"__filename";case"dirname":return"__dirname";case"require:":return"require("+a.args[0].visit(b)+")";default:throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown selector ["+a.selector+"]"})}}};module.exports={translate:function(a){var b=BletherParser.parse(a),c=(new BletherTranslator).visit(b);return c},runtime:function(){var a=require("path"),b=require("fs"),c=a.join(a.dirname(b.realpathSync(__filename)),"runtime.js");return b.readFileSync(c).toString()},BletherTranslator:BletherTranslator};