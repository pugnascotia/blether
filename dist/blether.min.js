/*! blether 30-06-2016 */
function Module(){}function Process(){}function Smalltalk(){}function stReturn(a){throw new STReturnValue(a)}function BletherArray(a){this.values=a}function BletherDynamicArray(a){this.values=a}function BletherDynamicDictionary(a){this.values=a}function BletherNode(a,b,c){this.line=a,this.column=b,this.source=c}function BletherNumber(a){this.value=a}function BletherString(a){this.value=a}function BletherSymbol(a){this.value=a}function convertSelector(a){var b={"\\":"backslash","+":"plus","*":"multiply","/":"divide","=":"equals",">":"greater_than","<":"less_than","@":"at","%":"modulo","~":"tilde","|":"or","&":"and","-":"minus"},c={"do:":"forEach","doWithIndex:":"forEach","select:":"filter",",":"concat"};if(c.hasOwnProperty(a))return c[a];if(a.match(/[\\+*\/=><,@%~|&-]/))return"__"+a.split("").map(function(a){return b[a]}).join("_")+"$";if(a.match(/:/)){var d=a.split(":").filter(function(a){return a.length>0});a=d.length>1?d.join("_")+"$":d[0]}return a}Module.export_as$=function(a,b){exports[a]=b},Process.argv=function(){return process.argv},Smalltalk.document=function(){return document},Array.prototype.reduceRight_startingWith$=function(a,b){return this.reduceRight.call(a,b)},String.prototype.__equals$=function(a){return this===a},String.prototype.__concat$=function(){return Array.reduce(arguments,function(a,b){},this)},String.prototype.__value$=function(){return this},Number.prototype.__equals$=function(a){return this===a},Number.prototype.__plus$=function(a){return this+a},Number.prototype.__multiply$=function(a){return this*a},Number.prototype.__divide$=function(a){return this/a},Number.prototype.__minus$=function(a){return this-a},Number.prototype.__modulo$=function(a){return this%a},Number.prototype.__or$=function(a){return this|a},Number.prototype.__and$=function(a){return this&a},Number.prototype.__value$=function(){return this},Number.prototype.__greater_than$=function(a){return this>a},Number.prototype.__less_than$=function(a){return this<a},Number.prototype.to_do$=function(a,b){for(var c=this;this<a;c++)b(c)},Number.prototype.timesRepeat=function(a){for(var b=0;b<this;b++)a()},Function.prototype.__value$=function(){return this.apply(this,arguments)};var Transcript=function(){var a="",b={};return b.show=function(b){return a+=b,this},b.nl=b.cr=function(){return console.log(a),a="",this},b.tab=function(){return a+="\t",this},b}(),STReturnValue=function(a){var b=a;Object.defineProperty(this,"value",{value:b,writable:!1,enumerable:!0,configurable:!0})};BletherArray.prototype=Object.create(BletherNode.prototype),BletherArray.prototype.constructor=BletherNode,BletherArray.prototype.toString=function(){var a=this;return"[".concat(a.values.map(function(a){return'"'.concat(a).concat('"')}).join(", ")).concat("]")},BletherArray.prototype.visit=function(a){var b=this;return a.visitArray(b)},BletherDynamicArray.prototype=Object.create(BletherArray.prototype),BletherDynamicArray.prototype.constructor=BletherArray,BletherDynamicArray.prototype.visit=function(a){var b=this;return a.visitDynamicArray(b)},BletherDynamicDictionary.prototype=Object.create(BletherNode.prototype),BletherDynamicDictionary.prototype.constructor=BletherNode,BletherDynamicDictionary.prototype.visit=function(a){var b=this;return a.visitDynamicDictionary(b)},BletherNode.prototype.setLine_column_source$=function(a,b,c){var d=this;return d.line=a,d.column=b,d.source=c,d},BletherNode.prototype.invoke=function(){return this.visit.apply(this,arguments)},BletherNode.prototype.find=function(a){var b=this;return a.__value$(b)?[b]:[]},BletherNode.prototype.isMethod=function(){return!1},BletherNumber.prototype=Object.create(BletherNode.prototype),BletherNumber.prototype.constructor=BletherNode,BletherNumber.prototype.toString=function(){var a=this;return a.value},BletherNumber.prototype.visit=function(a){var b=this;return a.visitNumber(b)},BletherString.prototype=Object.create(BletherNode.prototype),BletherString.prototype.constructor=BletherNode,BletherString.prototype.toString=function(){var a=this;return a.value},BletherString.prototype.visit=function(a){var b=this;return a.visitString(b)},BletherSymbol.prototype=Object.create(BletherNode.prototype),BletherSymbol.prototype.constructor=BletherNode,BletherSymbol.prototype.toString=function(){var a=this;return a.value},BletherSymbol.prototype.visit=function(a){var b=this;return a.visitSymbol(b)};var Blether={classes:{Object:{classMethods:{},methods:{}}}};Blether.ParseError=function(a){return{name:"Blether Parse Error",message:a.msg,line:a.line,column:a.column}},Blether.ParseError.prototype=new Error,Blether.ParseError.prototype.toString=function(){return this.message+":"+this.line+":"+this.column},Blether.Context=function(){this.currentClass=null,this.instanceVars=[],this.temps=[],this.returnContext=null},Blether.ContextMgr=function(){var a=[new Blether.Context];a[0].returnContext="root",this.pushClass=function(a,b){var c=new Blether.Context;c.className=a,c.instanceVars=b,this.push(c)},this.pushMethod=function(a){var b=new Blether.Context;b.returnContext="method",b.temps=a,this.push(b)},this.pushTemps=function(a){var b=new Blether.Context;b.temps=a,this.push(b)},this.pushBlock=function(a){var b=new Blether.Context;b.returnContext="block",b.temps=a,this.push(b)},this.push=function(b){a.push(b)},this.pop=function(){if(1===a.length)throw"Cannot pop the context beyond the initial state!";a.pop()};var b=0;this.pushReceiver=function(){return b++,"_receiver"+b+"$"},this.popReceiver=function(){if(0===b)throw"receiverDepth is already zero and cannot be popped further";b--},this.getTemps=function(){return a.reduceRight(function(a,b){return a.concat(b.temps)},[])},this.getInstanceVars=function(){return a.reduceRight(function(a,b){return a.concat(b.instanceVars)},[])},this.currentClass=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].className)return a[b].className;return null},this.returnContext=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].returnContext)return a[b].returnContext;return null}},Blether.Node=function(){this.line=null,this.column=null,this.source=null},Blether.Node.prototype.at=function(a,b,c){return this.line=a,this.column=b,this.source=c,this},Blether.Node.prototype.invoke=function(){return this.visit.apply(this,arguments)},Blether.Node.prototype.find=function(a){return a(this)?[this]:[]},Blether.Node.prototype.isMethod=function(){return!1},Blether.String=function(a){this._type="String",this.value=a},Blether.String.prototype=new Blether.Node,Blether.String.prototype.toString=function(){return this.value},Blether.String.prototype.visit=function(a){return a.visitString(this)},Blether.Symbol=function(a){this._type="Symbol",this.value=a},Blether.Symbol.prototype=new Blether.Node,Blether.Symbol.prototype.toString=function(){return this.value},Blether.Symbol.prototype.visit=function(a){return a.visitSymbol(this)},Blether.ClassName=function(a){this._type="ClassName",this.value=a},Blether.ClassName.prototype=new Blether.Node,Blether.ClassName.prototype.toString=function(){return this.value},Blether.ClassName.prototype.visit=function(a){return a.visitClassName(this)},Blether.Number=function(a){this._type="Number",this.value=a},Blether.Number.prototype=new Blether.Node,Blether.Number.prototype.toString=function(){return this.value},Blether.Number.prototype.visit=function(a){return a.visitNumber(this)},Blether.Array=function(a){this._type="Array",this.value=a},Blether.Array.prototype=new Blether.Node,Blether.Array.prototype.toString=function(){return"["+this.value.map(function(a){return'"'+a+'"'}).join(", ")+"]"},Blether.Array.prototype.visit=function(a){return a.visitArray(this)},Blether.DynamicArray=function(a){this._type="DynamicArray",this.values=a||[]},Blether.DynamicArray.prototype=new Blether.Array,Blether.DynamicArray.prototype.visit=function(a){return a.visitDynamicArray(this)},Blether.DynamicDictionary=function(a){this._type="DynamicDictionary",this.values=a||[]},Blether.DynamicDictionary.prototype=new Blether.Node,Blether.DynamicDictionary.prototype.visit=function(a){return a.visitDynamicDictionary(this)},Blether.UndefinedObject=function(){this._type="UndefinedObject"},Blether.UndefinedObject.prototype=new Blether.Node,Blether.UndefinedObject.prototype.toString=function(){return"nil"},Blether.UndefinedObject.prototype.visit=function(a){return a.visitUndefinedObject(this)},Blether.Boolean=function(a){this._type="Boolean",this.value=a},Blether.Boolean.prototype=new Blether.Node,Blether.Boolean.prototype.toString=function(){return this.value.toString()},Blether.Boolean.prototype.visit=function(a){return a.visitBoolean(this)},Blether.Variable=function(a){this._type="Variable",this.value=a},Blether.Variable.prototype=new Blether.Node,Blether.Variable.prototype.toString=function(){return this.value},Blether.Variable.prototype.visit=function(a){return a.visitVariable(this)},Blether.UnaryPattern=function(a){this._type="UnaryPattern",this.selector=a},Blether.UnaryPattern.prototype=new Blether.Node,Blether.UnaryPattern.prototype.toString=function(){return this.selector},Blether.UnaryPattern.prototype.visit=function(a){return a.visitUnaryPattern(this)},Blether.BinaryPattern=function(a,b){this._type="BinaryPattern",this.selector=a,this.arg=b},Blether.BinaryPattern.prototype=new Blether.Node,Blether.BinaryPattern.prototype.toString=function(){return this.selector+" - "+this.arg},Blether.BinaryPattern.prototype.visit=function(a){return a.visitBinaryPattern(this)},Blether.KeywordPattern=function(a){this._type="KeywordPattern",this.pairs=a,this.selector="#";for(var b=0;b<this.pairs.length;b++)this.selector+=this.pairs[b].key},Blether.KeywordPattern.prototype=new Blether.Node,Blether.KeywordPattern.prototype.toString=function(){return this.selector},Blether.KeywordPattern.prototype.visit=function(a){return a.visitKeywordPattern(this)},Blether.Assignment=function(a,b){this._type="Assignment",this.variable=a,this.expression=b},Blether.Assignment.prototype=new Blether.Node,Blether.Assignment.prototype.visit=function(a){return a.visitAssignment(this)},Blether.Return=function(a){this._type="Return",this.value=a},Blether.Return.prototype=new Blether.Node,Blether.Return.prototype.visit=function(a){return a.visitReturn(this)},Blether.Sequence=function(a,b){this._type="Sequence",this.temps=a||[],this.statements=b||[]},Blether.Sequence.prototype=new Blether.Node,Blether.Sequence.prototype.visit=function(a){return a.visitSequence(this)},Blether.Sequence.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.statements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.Statement=function(a){this._type="Statement",this.expression=a},Blether.Statement.prototype=new Blether.Node,Blether.Statement.prototype.visit=function(a){return a.visitStatement(this)},Blether.Statement.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.expression.find(a))},Blether.Block=function(a,b){this._type="Block",this.params=a||[],this.sequence=b},Blether.Block.prototype=new Blether.Node,Blether.Block.prototype.visit=function(a){return a.visitBlock(this)},Blether.Block.prototype.invoke=function(a){for(var b=[this],c=1;c<arguments.length;c++)b.push(arguments[c]);return a.invokeBlock.apply(a,b)},Blether.Block.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Send=function(a,b){this._type="Send",this.receiver=null,this.args=b||[],this.selector=a},Blether.Send.prototype=new Blether.Node,Blether.Send.prototype.visit=function(a){return a.visitSend(this)},Blether.Send.prototype.toString=function(){var a="["+this.args.map(function(a){return'"'+a+'"'}).join(", ")+"]";return"Send(#"+this.selector+(this.received?" to "+this.receiver:"")+(this.args.length>0?" with args "+a:"")+")"},Blether.Send.prototype.setReceiver=function(a){return null===this.receiver?this.receiver=a:this.receiver.setReceiver(a),this},Blether.Send.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b=this.args.reduce(function(b,c){return b.concat(c.find(a))},b),b.concat(this.receiver.find(a))},Blether.Cascade=function(a,b){this._type="Cascade",this.receiver=a,this.messages=b||[]},Blether.Cascade.prototype=new Blether.Node,Blether.Cascade.prototype.visit=function(a){return a.visitCascade(this)},Blether.JsStatement=function(a){this._type="JsStatement",this.javascript=a},Blether.JsStatement.prototype=new Blether.Node,Blether.JsStatement.prototype.visit=function(a){return a.visitJsStatement(this)},Blether.Method=function(a,b){this._type="Method",this.selector=a,this.sequence=b},Blether.Method.prototype=new Blether.Node,Blether.Method.prototype.visit=function(a){return a.visitMethod(this)},Blether.Method.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Comment=function(a){this._type="Comment",this.comment=a},Blether.Comment.prototype=new Blether.Node,Blether.Comment.prototype.visit=function(a){return a.visitComment(this)},Blether.MethodDeclaration=function(a,b){this._type="MethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].methods[b.selector]=this},Blether.MethodDeclaration.prototype=new Blether.Node,Blether.MethodDeclaration.prototype.visit=function(a){return a.visitMethodDeclaration(this)},Blether.MethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.MethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.MethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassMethodDeclaration=function(a,b){this._type="ClassMethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].classMethods[b.selector]=this},Blether.ClassMethodDeclaration.prototype=new Blether.Node,Blether.ClassMethodDeclaration.prototype.visit=function(a){return a.visitClassMethodDeclaration(this)},Blether.ClassMethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.ClassMethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.ClassMethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassDeclaration=function(a,b,c){this._type="ClassDeclaration",this.className=a,this.superClass=b,this.varNames=c,this.classMethods={},this.methods={},this.context=Blether},Blether.ClassDeclaration.prototype=new Blether.Node,Blether.ClassDeclaration.prototype.visit=function(a){return a.visitClassDeclaration(this)},Blether.ClassDeclaration.prototype.getMethods=function(){return this.context.classes[this.className].methods},Blether.ClassDeclaration.prototype.getClassMethods=function(){return this.context.classes[this.className].classMethods},Blether.ClassDeclaration.prototype.isNamespaced=function(){return this.className.value.indexOf(".")!==-1},Blether.Program=function(a){this._type="Program",this.elements=a},Blether.Program.prototype=new Blether.Node,Blether.Program.prototype.visit=function(a){return a.visitProgram(this)},Blether.Program.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.elements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.VariableDeclaration=function(a){this._type="VariableDeclaration",this.variables=a},Blether.VariableDeclaration.prototype=new Blether.Node,Blether.VariableDeclaration.prototype.visit=function(a){return a.visitVariableDeclaration(this)};var BletherParser=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Od,Nd)}function d(){return f(Od).line}function e(){return f(Od).column}function f(b){function c(b,c,d){var e,f;for(e=c;e<d;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Pd!==b&&(Pd>b&&(Pd=0,Qd={line:1,column:1,seenCR:!1}),c(Qd,Pd,b),Pd=b),Qd}function g(a){Nd<Rd||(Nd>Rd&&(Rd=Nd,Sd=[]),Sd.push(a))}function h(c,d,e){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=f(e),j=e<a.length?a.charAt(e):null;return null!==d&&g(d),new b(null!==c?c:h(d,j),d,j,e,i.line,i.column)}function i(){var a;return a=za()}function j(){var b,c;if(b=[],Ga.test(a.charAt(Nd))?(c=a.charAt(Nd),Nd++):(c=Ca,0===Td&&g(Ha)),c!==Ca)for(;c!==Ca;)b.push(c),Ga.test(a.charAt(Nd))?(c=a.charAt(Nd),Nd++):(c=Ca,0===Td&&g(Ha));else b=Fa;return b}function k(){var b,c,d,e,f;if(b=Nd,34===a.charCodeAt(Nd)?(c=Ia,Nd++):(c=Ca,0===Td&&g(Ja)),c!==Ca){for(d=[],e=Nd,a.substr(Nd,2)===Ka?(f=Ka,Nd+=2):(f=Ca,0===Td&&g(La)),f!==Ca&&(Od=e,f=Ma()),e=f,e===Ca&&(Na.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Oa)));e!==Ca;)d.push(e),e=Nd,a.substr(Nd,2)===Ka?(f=Ka,Nd+=2):(f=Ca,0===Td&&g(La)),f!==Ca&&(Od=e,f=Ma()),e=f,e===Ca&&(Na.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Oa)));d!==Ca?(34===a.charCodeAt(Nd)?(e=Ia,Nd++):(e=Ca,0===Td&&g(Ja)),e!==Ca?(c=[c,d,e],b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function l(){var a,b;for(a=[],b=j(),b===Ca&&(b=k());b!==Ca;)a.push(b),b=j(),b===Ca&&(b=k());return a}function m(){var b,c,d,e;if(b=Nd,Pa.test(a.charAt(Nd))?(c=a.charAt(Nd),Nd++):(c=Ca,0===Td&&g(Qa)),c!==Ca){for(d=[],Ra.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Sa));e!==Ca;)d.push(e),Ra.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Sa));d!==Ca?(Od=b,c=Ta(c,d),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function n(){var b,c,d;return b=Nd,c=m(),c!==Ca?(58===a.charCodeAt(Nd)?(d=Ua,Nd++):(d=Ca,0===Td&&g(Va)),d!==Ca?(Od=b,c=Wa(c,d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function o(){var b,c,d,e;if(b=Nd,Pa.test(a.charAt(Nd))?(c=a.charAt(Nd),Nd++):(c=Ca,0===Td&&g(Qa)),c!==Ca){for(d=[],Xa.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ya));e!==Ca;)d.push(e),Xa.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ya));d!==Ca?(Od=b,c=Za(c,d),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function p(){var b,c,d,e;if(b=Nd,$a.test(a.charAt(Nd))?(c=a.charAt(Nd),Nd++):(c=Ca,0===Td&&g(_a)),c!==Ca){for(d=[],Ra.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Sa));e!==Ca;)d.push(e),Ra.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Sa));d!==Ca?(Od=b,c=Za(c,d),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function q(){var b,c,d;return b=Nd,46===a.charCodeAt(Nd)?(c=ab,Nd++):(c=Ca,0===Td&&g(bb)),c!==Ca?(d=p(),d!==Ca?(Od=b,c=cb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function r(){var a,b,c,d;if(a=Nd,b=p(),b!==Ca){for(c=[],d=q();d!==Ca;)c.push(d),d=q();c!==Ca?(Od=a,b=db(b,c),a=b):(Nd=a,a=Fa)}else Nd=a,a=Fa;return a}function s(){var b,c,d,e,f;if(b=Nd,39===a.charCodeAt(Nd)?(c=eb,Nd++):(c=Ca,0===Td&&g(fb)),c!==Ca){for(d=[],e=Nd,a.substr(Nd,2)===gb?(f=gb,Nd+=2):(f=Ca,0===Td&&g(hb)),f!==Ca&&(Od=e,f=ib()),e=f,e===Ca&&(jb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(kb)));e!==Ca;)d.push(e),e=Nd,a.substr(Nd,2)===gb?(f=gb,Nd+=2):(f=Ca,0===Td&&g(hb)),f!==Ca&&(Od=e,f=ib()),e=f,e===Ca&&(jb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(kb)));d!==Ca?(39===a.charCodeAt(Nd)?(e=eb,Nd++):(e=Ca,0===Td&&g(fb)),e!==Ca?(Od=b,c=lb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function t(){var b,c,d;return b=Nd,36===a.charCodeAt(Nd)?(c=mb,Nd++):(c=Ca,0===Td&&g(nb)),c!==Ca?(a.length>Nd?(d=a.charAt(Nd),Nd++):(d=Ca,0===Td&&g(ob)),d!==Ca?(Od=b,c=pb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function u(){var b,c,d;return b=Nd,35===a.charCodeAt(Nd)?(c=qb,Nd++):(c=Ca,0===Td&&g(rb)),c!==Ca?(d=v(),d!==Ca?(Od=b,c=sb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function v(){var a,b,c;return a=Nd,b=o(),b===Ca&&(b=P(),b===Ca&&(b=Nd,c=s(),c!==Ca&&(Od=b,c=tb(c)),b=c)),b!==Ca&&(Od=a,b=ub(b)),a=b}function w(){var a,b;return a=Nd,b=x(),b===Ca&&(b=y(),b===Ca&&(b=z(),b===Ca&&(b=A()))),b!==Ca&&(Od=a,b=vb(b)),a=b}function x(){var b,c,d,e,f;return b=Nd,c=Nd,d=z(),d===Ca&&(d=A()),d!==Ca?(101===a.charCodeAt(Nd)?(e=wb,Nd++):(e=Ca,0===Td&&g(xb)),e!==Ca?(f=A(),f!==Ca?(d=[d,e,f],c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa)):(Nd=c,c=Fa),c!==Ca&&(Od=b,c=yb(c)),b=c}function y(){var b,c,d,e,f;if(b=Nd,45===a.charCodeAt(Nd)?(c=Ab,Nd++):(c=Ca,0===Td&&g(Bb)),c===Ca&&(c=zb),c!==Ca)if(a.substr(Nd,3)===Cb?(d=Cb,Nd+=3):(d=Ca,0===Td&&g(Db)),d!==Ca){if(e=[],Eb.test(a.charAt(Nd))?(f=a.charAt(Nd),Nd++):(f=Ca,0===Td&&g(Fb)),f!==Ca)for(;f!==Ca;)e.push(f),Eb.test(a.charAt(Nd))?(f=a.charAt(Nd),Nd++):(f=Ca,0===Td&&g(Fb));else e=Fa;e!==Ca?(Od=b,c=Gb(c,e),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;else Nd=b,b=Fa;return b}function z(){var b,c,d,e,f,h;if(b=Nd,45===a.charCodeAt(Nd)?(c=Ab,Nd++):(c=Ca,0===Td&&g(Bb)),c===Ca&&(c=zb),c!==Ca){if(d=[],Hb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ib)),e!==Ca)for(;e!==Ca;)d.push(e),Hb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ib));else d=Fa;if(d!==Ca)if(46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb)),e!==Ca){if(f=[],Hb.test(a.charAt(Nd))?(h=a.charAt(Nd),Nd++):(h=Ca,0===Td&&g(Ib)),h!==Ca)for(;h!==Ca;)f.push(h),Hb.test(a.charAt(Nd))?(h=a.charAt(Nd),Nd++):(h=Ca,0===Td&&g(Ib));else f=Fa;f!==Ca?(Od=b,c=Jb(c,d,f),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;else Nd=b,b=Fa}else Nd=b,b=Fa;return b}function A(){var b,c,d,e;if(b=Nd,45===a.charCodeAt(Nd)?(c=Ab,Nd++):(c=Ca,0===Td&&g(Bb)),c===Ca&&(c=zb),c!==Ca){if(d=[],Hb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ib)),e!==Ca)for(;e!==Ca;)d.push(e),Hb.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(Ib));else d=Fa;d!==Ca?(Od=b,c=Kb(c,d),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function B(){var b,c,d;return b=Nd,a.substr(Nd,2)===Lb?(c=Lb,Nd+=2):(c=Ca,0===Td&&g(Mb)),c!==Ca?(d=D(),d!==Ca?(Od=b,c=sb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function C(){var b,c,d;return b=Nd,40===a.charCodeAt(Nd)?(c=Nb,Nd++):(c=Ca,0===Td&&g(Ob)),c!==Ca?(d=D(),d!==Ca?(Od=b,c=sb(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function D(){var b,c,d,e,f;for(b=Nd,c=[],d=Nd,e=l(),e!==Ca?(f=K(),f===Ca&&(f=C(),f===Ca&&(f=v())),f!==Ca?(Od=d,e=Pb(f),d=e):(Nd=d,d=Fa)):(Nd=d,d=Fa);d!==Ca;)c.push(d),d=Nd,e=l(),e!==Ca?(f=K(),f===Ca&&(f=C(),f===Ca&&(f=v())),f!==Ca?(Od=d,e=Pb(f),d=e):(Nd=d,d=Fa)):(Nd=d,d=Fa);return c!==Ca?(d=l(),d!==Ca?(41===a.charCodeAt(Nd)?(e=Qb,Nd++):(e=Ca,0===Td&&g(Rb)),e!==Ca?(Od=b,c=Sb(c),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function E(){var b,c,d,e,f,h;if(b=Nd,a.substr(Nd,2)===Lb?(c=Lb,Nd+=2):(c=Ca,0===Td&&g(Mb)),c!==Ca){for(d=[],e=Nd,f=l(),f!==Ca?(h=u(),h===Ca&&(h=v()),h!==Ca?(Od=e,f=Tb(h),e=f):(Nd=e,e=Fa)):(Nd=e,e=Fa);e!==Ca;)d.push(e),e=Nd,f=l(),f!==Ca?(h=u(),h===Ca&&(h=v()),h!==Ca?(Od=e,f=Tb(h),e=f):(Nd=e,e=Fa)):(Nd=e,e=Fa);d!==Ca?(e=l(),e!==Ca?(41===a.charCodeAt(Nd)?(f=Qb,Nd++):(f=Ca,0===Td&&g(Rb)),f!==Ca?(Od=b,c=Ub(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function F(){var b,c,d,e,f,h,i;return b=Nd,123===a.charCodeAt(Nd)?(c=Vb,Nd++):(c=Ca,0===Td&&g(Wb)),c!==Ca?(d=l(),d!==Ca?(e=X(),e===Ca&&(e=zb),e!==Ca?(f=l(),f!==Ca?(46===a.charCodeAt(Nd)?(h=ab,Nd++):(h=Ca,0===Td&&g(bb)),h===Ca&&(h=zb),h!==Ca?(125===a.charCodeAt(Nd)?(i=Xb,Nd++):(i=Ca,0===Td&&g(Yb)),i!==Ca?(Od=b,c=Zb(e),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function G(){var b,c,d,e,f,h;return b=Nd,a.substr(Nd,2)===$b?(c=$b,Nd+=2):(c=Ca,0===Td&&g(_b)),c!==Ca?(d=l(),d!==Ca?(e=va(),e===Ca&&(e=zb),e!==Ca?(f=l(),f!==Ca?(125===a.charCodeAt(Nd)?(h=Xb,Nd++):(h=Ca,0===Td&&g(Yb)),h!==Ca?(Od=b,c=ac(e),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function H(){var b,c,d;return b=Nd,c=Nd,a.substr(Nd,4)===bc?(d=bc,Nd+=4):(d=Ca,0===Td&&g(cc)),d!==Ca&&(Od=c,d=dc()),c=d,c===Ca&&(c=Nd,a.substr(Nd,5)===ec?(d=ec,Nd+=5):(d=Ca,0===Td&&g(fc)),d!==Ca&&(Od=c,d=gc()),c=d),c!==Ca&&(Od=b,c=hc(c)),b=c}function I(){var b,c;return b=Nd,a.substr(Nd,3)===ic?(c=ic,Nd+=3):(c=Ca,0===Td&&g(jc)),c!==Ca&&(Od=b,c=kc(c)),b=c}function J(){var a;return a=H(),a===Ca&&(a=I()),a}function K(){var a;return a=J(),a===Ca&&(a=w(),a===Ca&&(a=B(),a===Ca&&(a=s(),a===Ca&&(a=u(),a===Ca&&(a=t()))))),a}function L(){var a;return a=G(),a===Ca&&(a=F(),a===Ca&&(a=fa())),a}function M(){var a;return a=L(),a===Ca&&(a=K()),a}function N(){var a,b;return a=Nd,b=m(),b!==Ca&&(Od=a,b=lc(b)),a=b}function O(){var a,b,c,d,e;return a=Nd,b=l(),b!==Ca?(c=n(),c!==Ca?(d=l(),d!==Ca?(e=ma(),e!==Ca?(Od=a,b=mc(c,e),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function P(){var b,c,d;if(b=Nd,c=[],nc.test(a.charAt(Nd))?(d=a.charAt(Nd),Nd++):(d=Ca,0===Td&&g(oc)),d!==Ca)for(;d!==Ca;)c.push(d),nc.test(a.charAt(Nd))?(d=a.charAt(Nd),Nd++):(d=Ca,0===Td&&g(oc));else c=Fa;return c!==Ca&&(Od=b,c=pc(c)),b=c}function Q(){var a,b,c,d,e,f,g;if(a=Nd,b=[],c=Nd,d=l(),d!==Ca?(e=n(),e!==Ca?(f=l(),f!==Ca?(g=m(),g!==Ca?(Od=c,d=mc(e,g),c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa)):(Nd=c,c=Fa)):(Nd=c,c=Fa),c!==Ca)for(;c!==Ca;)b.push(c),c=Nd,d=l(),d!==Ca?(e=n(),e!==Ca?(f=l(),f!==Ca?(g=m(),g!==Ca?(Od=c,d=mc(e,g),c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa)):(Nd=c,c=Fa)):(Nd=c,c=Fa);else b=Fa;return b!==Ca&&(Od=a,b=qc(b)),a=b}function R(){var a,b,c,d,e;return a=Nd,b=l(),b!==Ca?(c=P(),c!==Ca?(d=l(),d!==Ca?(e=m(),e!==Ca?(Od=a,b=rc(c,e),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function S(){var a,b,c;return a=Nd,b=l(),b!==Ca?(c=m(),c!==Ca?(Od=a,b=sc(c),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function T(){var a,b,c,d,e;return a=Nd,b=pa(),b!==Ca?(c=Nd,d=l(),d!==Ca?(e=T(),e!==Ca?(Od=c,d=tc(e),c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa),c===Ca&&(c=zb),c!==Ca?(Od=a,b=uc(b),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function U(){var a,b,c,d,e;return a=Nd,b=oa(),b===Ca&&(b=ma()),b!==Ca?(c=Nd,d=l(),d!==Ca?(e=T(),e!==Ca?(Od=c,d=vc(e),c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa),c===Ca&&(c=zb),c!==Ca?(Od=a,b=wc(b,c),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function V(){var a;return a=Y(),a===Ca&&(a=qa(),a===Ca&&(a=U())),a}function W(){var b,c,d,e,f;return b=Nd,c=l(),c!==Ca?(46===a.charCodeAt(Nd)?(d=ab,Nd++):(d=Ca,0===Td&&g(bb)),d!==Ca?(e=l(),e!==Ca?(f=V(),f!==Ca?(Od=b,c=xc(f),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function X(){var a,b,c,d;if(a=Nd,b=V(),b!==Ca){for(c=[],d=W();d!==Ca;)c.push(d),d=W();c!==Ca?(Od=a,b=yc(b,c),a=b):(Nd=a,a=Fa)}else Nd=a,a=Fa;return a}function Y(){var b,c,d,e,f,h;return b=Nd,c=N(),c!==Ca?(d=l(),d!==Ca?(a.substr(Nd,2)===zc?(e=zc,Nd+=2):(e=Ca,0===Td&&g(Ac)),e!==Ca?(f=l(),f!==Ca?(h=V(),h!==Ca?(Od=b,c=Bc(c,h),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function Z(){var b,c,d,e,f,h;return b=Nd,94===a.charCodeAt(Nd)?(c=Cc,Nd++):(c=Ca,0===Td&&g(Dc)),c!==Ca?(d=l(),d!==Ca?(e=V(),e!==Ca?(f=l(),f!==Ca?(46===a.charCodeAt(Nd)?(h=ab,Nd++):(h=Ca,0===Td&&g(bb)),h===Ca&&(h=zb),h!==Ca?(Od=b,c=Ec(e),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function $(){var b,c,d,e,f,h;if(b=Nd,124===a.charCodeAt(Nd)?(c=Fc,Nd++):(c=Ca,0===Td&&g(Gc)),c!==Ca){for(d=[],e=Nd,f=l(),f!==Ca?(h=m(),h!==Ca?(Od=e,f=Hc(h),e=f):(Nd=e,e=Fa)):(Nd=e,e=Fa);e!==Ca;)d.push(e),e=Nd,f=l(),f!==Ca?(h=m(),h!==Ca?(Od=e,f=Hc(h),e=f):(Nd=e,e=Fa)):(Nd=e,e=Fa);d!==Ca?(e=l(),e!==Ca?(124===a.charCodeAt(Nd)?(f=Fc,Nd++):(f=Ca,0===Td&&g(Gc)),f!==Ca?(Od=b,c=Ic(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function _(){var b,c,d,e,f,h,i;if(b=Nd,c=[],d=Nd,e=l(),e!==Ca?(58===a.charCodeAt(Nd)?(f=Ua,Nd++):(f=Ca,0===Td&&g(Va)),f!==Ca?(h=l(),h!==Ca?(i=m(),i!==Ca?(Od=d,e=Jc(i),d=e):(Nd=d,d=Fa)):(Nd=d,d=Fa)):(Nd=d,d=Fa)):(Nd=d,d=Fa),d!==Ca)for(;d!==Ca;)c.push(d),d=Nd,e=l(),e!==Ca?(58===a.charCodeAt(Nd)?(f=Ua,Nd++):(f=Ca,0===Td&&g(Va)),f!==Ca?(h=l(),h!==Ca?(i=m(),i!==Ca?(Od=d,e=Jc(i),d=e):(Nd=d,d=Fa)):(Nd=d,d=Fa)):(Nd=d,d=Fa)):(Nd=d,d=Fa);else c=Fa;return c!==Ca?(d=l(),d!==Ca?(124===a.charCodeAt(Nd)?(e=Fc,Nd++):(e=Ca,0===Td&&g(Gc)),e!==Ca?(Od=b,c=Kc(c),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function aa(){var b,c,d,e,f,h;return b=Nd,40===a.charCodeAt(Nd)?(c=Nb,Nd++):(c=Ca,0===Td&&g(Ob)),c!==Ca?(d=l(),d!==Ca?(e=V(),e!==Ca?(f=l(),f!==Ca?(41===a.charCodeAt(Nd)?(h=Qb,Nd++):(h=Ca,0===Td&&g(Rb)),h!==Ca?(Od=b,c=xc(e),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function ba(){var b,c,d,e,f,h,i,j;if(b=Nd,c=Z(),c!==Ca){for(d=[],46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb));e!==Ca;)d.push(e),46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb));d!==Ca?(Od=b,c=Lc(c),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;if(b===Ca){if(b=Nd,c=X(),c!==Ca)if(d=l(),d!==Ca){if(e=[],46===a.charCodeAt(Nd)?(f=ab,Nd++):(f=Ca,0===Td&&g(bb)),f!==Ca)for(;f!==Ca;)e.push(f),46===a.charCodeAt(Nd)?(f=ab,Nd++):(f=Ca,0===Td&&g(bb));else e=Fa;if(e!==Ca)if(f=l(),f!==Ca)if(h=Z(),h!==Ca){for(i=[],46===a.charCodeAt(Nd)?(j=ab,Nd++):(j=Ca,0===Td&&g(bb));j!==Ca;)i.push(j),46===a.charCodeAt(Nd)?(j=ab,Nd++):(j=Ca,0===Td&&g(bb));i!==Ca?(Od=b,c=Mc(c,h),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;else Nd=b,b=Fa;else Nd=b,b=Fa}else Nd=b,b=Fa;else Nd=b,b=Fa;if(b===Ca)if(b=Nd,c=X(),c===Ca&&(c=zb),c!==Ca){for(d=[],46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb));e!==Ca;)d.push(e),46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb));d!==Ca?(Od=b,c=Nc(c),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa}return b}function ca(){var b,c,d,e;return b=Nd,c=Nd,d=V(),d!==Ca?(46===a.charCodeAt(Nd)?(e=ab,Nd++):(e=Ca,0===Td&&g(bb)),e!==Ca?(Od=c,d=Oc(d),c=d):(Nd=c,c=Fa)):(Nd=c,c=Fa),c===Ca&&(c=ra()),c!==Ca&&(Od=b,c=Pc(c)),b=c}function da(){var a;return a=ra(),a===Ca&&(a=ea()),a}function ea(){var a,b,c,d,e;return a=Nd,b=$(),b===Ca&&(b=zb),b!==Ca?(c=l(),c!==Ca?(d=ba(),d===Ca&&(d=zb),d!==Ca?(e=l(),e!==Ca?(Od=a,b=Qc(b,d),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function fa(){var b,c,d,e,f,h,i;return b=Nd,91===a.charCodeAt(Nd)?(c=Rc,Nd++):(c=Ca,0===Td&&g(Sc)),c!==Ca?(d=_(),d===Ca&&(d=zb),d!==Ca?(e=l(),e!==Ca?(f=da(),f===Ca&&(f=zb),f!==Ca?(h=l(),h!==Ca?(93===a.charCodeAt(Nd)?(i=Tc,Nd++):(i=Ca,0===Td&&g(Uc)),i!==Ca?(Od=b,c=Vc(d,f),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function ga(){var a,b;return a=M(),a===Ca&&(a=Nd,b=r(),b!==Ca&&(Od=a,b=Wc(b)),a=b,a===Ca&&(a=N(),a===Ca&&(a=aa()))),a}function ha(){var b,c,d,e,f;return b=Nd,c=l(),c!==Ca?(d=m(),d!==Ca?(e=Nd,Td++,58===a.charCodeAt(Nd)?(f=Ua,Nd++):(f=Ca,0===Td&&g(Va)),Td--,f===Ca?e=Xc:(Nd=e,e=Fa),e!==Ca?(Od=b,c=Yc(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function ia(){var a,b,c,d,e;return a=Nd,b=ha(),b!==Ca?(c=l(),c!==Ca?(d=ia(),d===Ca&&(d=zb),d!==Ca?(e=l(),e!==Ca?(Od=a,b=Zc(b,d),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function ja(){var a,b,c,d;return a=Nd,b=ga(),b!==Ca?(c=l(),c!==Ca?(d=ia(),d===Ca&&(d=zb),d!==Ca?(Od=a,b=$c(b,d),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function ka(){var a,b,c,d,e;return a=Nd,b=l(),b!==Ca?(c=P(),c!==Ca?(d=l(),d!==Ca?(e=ja(),e===Ca&&(e=ga()),e!==Ca?(Od=a,b=_c(c,e),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function la(){var a,b,c;return a=Nd,b=ka(),b!==Ca?(c=la(),c===Ca&&(c=zb),c!==Ca?(Od=a,b=Zc(b,c),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function ma(){var a,b,c;return a=Nd,b=ja(),b!==Ca?(c=la(),c===Ca&&(c=zb),c!==Ca?(Od=a,b=$c(b,c),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function na(){var a,b,c;if(a=Nd,b=[],c=O(),c!==Ca)for(;c!==Ca;)b.push(c),c=O();else b=Fa;return b!==Ca&&(Od=a,b=ad(b)),a=b}function oa(){var a,b,c;return a=Nd,b=ma(),b!==Ca?(c=na(),c!==Ca?(Od=a,b=bd(b,c),a=b):(Nd=a,a=Fa)):(Nd=a,
a=Fa),a}function pa(){var a;return a=ka(),a===Ca&&(a=ha(),a===Ca&&(a=na())),a}function qa(){var b,c,d,e,f,h,i,j,k;if(b=Nd,c=l(),c!==Ca)if(d=oa(),d===Ca&&(d=ma()),d!==Ca){if(e=[],f=Nd,h=l(),h!==Ca?(59===a.charCodeAt(Nd)?(i=cd,Nd++):(i=Ca,0===Td&&g(dd)),i!==Ca?(j=l(),j!==Ca?(k=pa(),k!==Ca?(Od=f,h=ed(k),f=h):(Nd=f,f=Fa)):(Nd=f,f=Fa)):(Nd=f,f=Fa)):(Nd=f,f=Fa),f!==Ca)for(;f!==Ca;)e.push(f),f=Nd,h=l(),h!==Ca?(59===a.charCodeAt(Nd)?(i=cd,Nd++):(i=Ca,0===Td&&g(dd)),i!==Ca?(j=l(),j!==Ca?(k=pa(),k!==Ca?(Od=f,h=ed(k),f=h):(Nd=f,f=Fa)):(Nd=f,f=Fa)):(Nd=f,f=Fa)):(Nd=f,f=Fa);else e=Fa;e!==Ca?(Od=b,c=fd(d,e),b=c):(Nd=b,b=Fa)}else Nd=b,b=Fa;else Nd=b,b=Fa;return b}function ra(){var b,c,d,e,f;if(b=Nd,60===a.charCodeAt(Nd)?(c=gd,Nd++):(c=Ca,0===Td&&g(hd)),c!==Ca){for(d=[],e=Nd,a.substr(Nd,2)===id?(f=id,Nd+=2):(f=Ca,0===Td&&g(jd)),f!==Ca&&(Od=e,f=kd()),e=f,e===Ca&&(ld.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(md)));e!==Ca;)d.push(e),e=Nd,a.substr(Nd,2)===id?(f=id,Nd+=2):(f=Ca,0===Td&&g(jd)),f!==Ca&&(Od=e,f=kd()),e=f,e===Ca&&(ld.test(a.charAt(Nd))?(e=a.charAt(Nd),Nd++):(e=Ca,0===Td&&g(md)));d!==Ca?(62===a.charCodeAt(Nd)?(e=nd,Nd++):(e=Ca,0===Td&&g(od)),e!==Ca?(Od=b,c=pd(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;return b}function sa(){var a,b,c,d,e;return a=Nd,b=Q(),b===Ca&&(b=R(),b===Ca&&(b=S())),b!==Ca?(c=l(),c!==Ca?(d=da(),d===Ca&&(d=zb),d!==Ca?(e=l(),e!==Ca?(Od=a,b=qd(b,d),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function ta(){var a,b,c;return a=Nd,b=ma(),b!==Ca?(Od=Nd,c=rd(b),c=c?Xc:Fa,c!==Ca?(Od=a,b=sd(b),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function ua(){var b,c,d,e,f;return b=Nd,c=l(),c!==Ca?(46===a.charCodeAt(Nd)?(d=ab,Nd++):(d=Ca,0===Td&&g(bb)),d!==Ca?(e=l(),e!==Ca?(f=ta(),f!==Ca?(Od=b,c=xc(f),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function va(){var a,b,c,d;if(a=Nd,b=ta(),b!==Ca){for(c=[],d=ua();d!==Ca;)c.push(d),d=ua();c!==Ca?(Od=a,b=td(b,c),a=b):(Nd=a,a=Fa)}else Nd=a,a=Fa;return a}function wa(){var b,c,d,e,f,h,i,j,k,m,n,p,q,r,s,t,v,w,x;return b=Nd,c=o(),c!==Ca?(d=l(),d!==Ca?(a.substr(Nd,9)===ud?(e=ud,Nd+=9):(e=Ca,0===Td&&g(vd)),e!==Ca?(f=l(),f!==Ca?(h=u(),h!==Ca?(i=l(),i!==Ca?(a.substr(Nd,10)===wd?(j=wd,Nd+=10):(j=Ca,0===Td&&g(xd)),j===Ca&&(a.substr(Nd,22)===yd?(j=yd,Nd+=22):(j=Ca,0===Td&&g(zd))),j!==Ca?(k=l(),k!==Ca?(m=E(),m!==Ca?(n=Nd,p=l(),p!==Ca?(a.substr(Nd,19)===Ad?(q=Ad,Nd+=19):(q=Ca,0===Td&&g(Bd)),q!==Ca?(r=l(),r!==Ca?(s=E(),s!==Ca?(t=l(),t!==Ca?(a.substr(Nd,17)===Cd?(v=Cd,Nd+=17):(v=Ca,0===Td&&g(Dd)),v!==Ca?(w=l(),w!==Ca?(x=E(),x!==Ca?(p=[p,q,r,s,t,v,w,x],n=p):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa)):(Nd=n,n=Fa),n===Ca&&(n=zb),n!==Ca?(p=l(),p!==Ca?(46===a.charCodeAt(Nd)?(q=ab,Nd++):(q=Ca,0===Td&&g(bb)),q!==Ca?(Od=b,c=Ed(c,h,m),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b}function xa(){var b,c,d,e,f,h,i,k,m;if(b=Nd,33===a.charCodeAt(Nd)?(c=Fd,Nd++):(c=Ca,0===Td&&g(Gd)),c!==Ca)if(d=r(),d!==Ca)if(e=l(),e!==Ca){if(f=Nd,a.substr(Nd,5)===Hd?(h=Hd,Nd+=5):(h=Ca,0===Td&&g(Id)),h!==Ca){if(i=[],k=j(),k!==Ca)for(;k!==Ca;)i.push(k),k=j();else i=Fa;i!==Ca?(h=[h,i],f=h):(Nd=f,f=Fa)}else Nd=f,f=Fa;f===Ca&&(f=zb),f!==Ca?(h=sa(),h!==Ca?(33===a.charCodeAt(Nd)?(i=Fd,Nd++):(i=Ca,0===Td&&g(Gd)),i!==Ca?(k=l(),k===Ca&&(k=zb),k!==Ca?(46===a.charCodeAt(Nd)?(m=ab,Nd++):(m=Ca,0===Td&&g(bb)),m!==Ca?(Od=b,c=Jd(d,f,h),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa)}else Nd=b,b=Fa;else Nd=b,b=Fa;else Nd=b,b=Fa;return b}function ya(){var a,b,c,d;return a=Nd,b=l(),b===Ca&&(b=zb),b!==Ca?(c=xa(),c===Ca&&(c=wa(),c===Ca&&(c=ca())),c!==Ca?(d=l(),d===Ca&&(d=zb),d!==Ca?(Od=a,b=Kd(c),a=b):(Nd=a,a=Fa)):(Nd=a,a=Fa)):(Nd=a,a=Fa),a}function za(){var a,b,c,d,e;if(a=Nd,b=Nd,c=l(),c===Ca&&(c=zb),c!==Ca?(d=$(),d!==Ca?(e=l(),e===Ca&&(e=zb),e!==Ca?(Od=b,c=Ld(d),b=c):(Nd=b,b=Fa)):(Nd=b,b=Fa)):(Nd=b,b=Fa),b===Ca&&(b=ya()),b!==Ca){for(c=[],d=ya();d!==Ca;)c.push(d),d=ya();c!==Ca?(Od=a,b=Md(b,c),a=b):(Nd=a,a=Fa)}else Nd=a,a=Fa;return a}var Aa,Ba=arguments.length>1?arguments[1]:{},Ca={},Da={start:i},Ea=i,Fa=Ca,Ga=/^[ \t\x0B\f\xA0\uFEFF\n\r\u2028\u2029]/,Ha={type:"class",value:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]",description:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]"},Ia='"',Ja={type:"literal",value:'"',description:'"\\""'},Ka='""',La={type:"literal",value:'""',description:'"\\"\\""'},Ma=function(){return'"'},Na=/^[^"]/,Oa={type:"class",value:'[^"]',description:'[^"]'},Pa=/^[a-zA-Z]/,Qa={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Ra=/^[a-zA-Z0-9]/,Sa={type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},Ta=function(a,b){return a+b.join("")},Ua=":",Va={type:"literal",value:":",description:'":"'},Wa=function(a,b){return a+b},Xa=/^[a-zA-Z0-9:]/,Ya={type:"class",value:"[a-zA-Z0-9:]",description:"[a-zA-Z0-9:]"},Za=function(a,b){return a+b.join("")},$a=/^[A-Z]/,_a={type:"class",value:"[A-Z]",description:"[A-Z]"},ab=".",bb={type:"literal",value:".",description:'"."'},cb=function(a){return a},db=function(a,b){return[a].concat(b).join(".")},eb="'",fb={type:"literal",value:"'",description:'"\'"'},gb="''",hb={type:"literal",value:"''",description:"\"''\""},ib=function(){return"'"},jb=/^[^']/,kb={type:"class",value:"[^']",description:"[^']"},lb=function(a){return new Blether.String(a.join("")).at(d(),e(),c())},mb="$",nb={type:"literal",value:"$",description:'"$"'},ob={type:"any",description:"any character"},pb=function(a){return new Blether.String(a).at(d(),e(),c())},qb="#",rb={type:"literal",value:"#",description:'"#"'},sb=function(a){return a},tb=function(a){return a.value},ub=function(a){return new Blether.Symbol(a).at(d(),e(),c())},vb=function(a){return new Blether.Number(a).at(d(),e(),c())},wb="e",xb={type:"literal",value:"e",description:'"e"'},yb=function(a){return parseFloat(a.join(""))},zb=null,Ab="-",Bb={type:"literal",value:"-",description:'"-"'},Cb="16r",Db={type:"literal",value:"16r",description:'"16r"'},Eb=/^[0-9a-fA-F]/,Fb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Gb=function(a,b){return parseInt((a||"")+b.join(""),16)},Hb=/^[0-9]/,Ib={type:"class",value:"[0-9]",description:"[0-9]"},Jb=function(a,b,c){return parseFloat((a||"")+b.join("")+"."+c.join(""),10)},Kb=function(a,b){return parseInt((a||"")+b.join(""),10)},Lb="#(",Mb={type:"literal",value:"#(",description:'"#("'},Nb="(",Ob={type:"literal",value:"(",description:'"("'},Pb=function(a){return a},Qb=")",Rb={type:"literal",value:")",description:'")"'},Sb=function(a){return new Blether.Array(a).at(d(),e(),c())},Tb=function(a){return a},Ub=function(a){return new Blether.Array(a).at(d(),e(),c())},Vb="{",Wb={type:"literal",value:"{",description:'"{"'},Xb="}",Yb={type:"literal",value:"}",description:'"}"'},Zb=function(a){return new Blether.DynamicArray(a).at(d(),e(),c())},$b="#{",_b={type:"literal",value:"#{",description:'"#{"'},ac=function(a){return new Blether.DynamicDictionary(a).at(d(),e(),c())},bc="true",cc={type:"literal",value:"true",description:'"true"'},dc=function(){return!0},ec="false",fc={type:"literal",value:"false",description:'"false"'},gc=function(){return!1},hc=function(a){return new Blether.Boolean(a).at(d(),e(),c())},ic="nil",jc={type:"literal",value:"nil",description:'"nil"'},kc=function(a){return(new Blether.UndefinedObject).at(d(),e(),c())},lc=function(a){if("this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Use [self] instead of [this]"});return new Blether.Variable(a).at(d(),e(),c())},mc=function(a,b){return{key:a,arg:b}},nc=/^[\\+*\/=><,@%~|&\-]/,oc={type:"class",value:"[\\\\+*\\/=><,@%~|&\\-]",description:"[\\\\+*\\/=><,@%~|&\\-]"},pc=function(a){return a.join("")},qc=function(a){return new Blether.KeywordPattern(a).at(d(),e(),c())},rc=function(a,b){return new Blether.BinaryPattern(a,b).at(d(),e(),c())},sc=function(a){return new Blether.UnaryPattern(a).at(d(),e(),c())},tc=function(a){return a},uc=function(a){return chain?chain.setReceiver(a):new Blether.send(a).at(d(),e(),c())},vc=function(a){return a},wc=function(a,b){return b?b.setReceiver(a):a},xc=function(a){return a},yc=function(a,b){return[a].concat(b)},zc=":=",Ac={type:"literal",value:":=",description:'":="'},Bc=function(a,b){return new Blether.Assignment(a,b).at(d(),e(),c())},Cc="^",Dc={type:"literal",value:"^",description:'"^"'},Ec=function(a){return new Blether.Return(a).at(d(),e(),c())},Fc="|",Gc={type:"literal",value:"|",description:'"|"'},Hc=function(a){return a},Ic=function(a){return a.forEach(function(a){if("self"===a||"this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Cannot name a variable ["+a+"]"})}),a},Jc=function(a){return a},Kc=function(a){return a},Lc=function(a){return[a]},Mc=function(a,b){var c=a;return c.push(b),c},Nc=function(a){return a||[]},Oc=function(a){return a},Pc=function(a){return new Blether.Statement(a).at(d(),e(),c())},Qc=function(a,b){return new Blether.Sequence(a,b).at(d(),e(),c())},Rc="[",Sc={type:"literal",value:"[",description:'"["'},Tc="]",Uc={type:"literal",value:"]",description:'"]"'},Vc=function(a,b){return new Blether.Block(a,b).at(d(),e(),c())},Wc=function(a){return new Blether.ClassName(a).at(d(),e(),c())},Xc=void 0,Yc=function(a){return new Blether.Send(a).at(d(),e(),c())},Zc=function(a,b){return b?b.setReceiver(a):a},$c=function(a,b){return b?b.setReceiver(a):a},_c=function(a,b){return new Blether.Send(a,[b]).at(d(),e(),c())},ad=function(a){for(var b=[],f=[],g=0;g<a.length;g++)b.push(a[g].key),f.push(a[g].arg);return new Blether.Send(b.join(""),f).at(d(),e(),c())},bd=function(a,b){return b.setReceiver(a)},cd=";",dd={type:"literal",value:";",description:'";"'},ed=function(a){return a},fd=function(a,b){return new Blether.Cascade(a.receiver,[a].concat(b)).at(d(),e(),c())},gd="<",hd={type:"literal",value:"<",description:'"<"'},id=">>",jd={type:"literal",value:">>",description:'">>"'},kd=function(){return">"},ld=/^[^>]/,md={type:"class",value:"[^>]",description:"[^>]"},nd=">",od={type:"literal",value:">",description:'">"'},pd=function(a){return new Blether.JsStatement(a.join("")).at(d(),e(),c())},qd=function(a,b){return new Blether.Method(a,b).at(d(),e(),c())},rd=function(a){return"->"===a.selector},sd=function(a){return[a.receiver,a.args[0]]},td=function(a,b){return a.concat.apply(a,b)},ud="subclass:",vd={type:"literal",value:"subclass:",description:'"subclass:"'},wd="variables:",xd={type:"literal",value:"variables:",description:'"variables:"'},yd="instanceVariableNames:",zd={type:"literal",value:"instanceVariableNames:",description:'"instanceVariableNames:"'},Ad="classVariableNames:",Bd={type:"literal",value:"classVariableNames:",description:'"classVariableNames:"'},Cd="poolDictionaries:",Dd={type:"literal",value:"poolDictionaries:",description:'"poolDictionaries:"'},Ed=function(a,b,f){if(!b.value.match(/^[A-Z]/))throw Blether.ParseError({line:d(),column:e(),msg:"Class name "+b+" must start with a capital"});if(Blether.classes[b])throw Blether.ParseError({line:d(),column:e(),msg:"Class "+b+" already defined"});return Blether.classes[b]=new Blether.ClassDeclaration(b,a,f).at(d(),e(),c())},Fd="!",Gd={type:"literal",value:"!",description:'"!"'},Hd="class",Id={type:"literal",value:"class",description:'"class"'},Jd=function(a,b,f){if("Object"!==a&&!Blether.classes[a])throw Blether.ParseError({line:d(),column:e(),msg:"Unknown class "+a});if(b){if(Blether.classes[a].classMethods.hasOwnProperty(f.selector))throw Blether.ParseError({line:d(),column:e(),msg:"Class method "+f.selector+" already defined on class "+a});return Blether.classes[a].classMethods[f.selector]=new Blether.ClassMethodDeclaration(a,f).at(d(),e(),c())}if(Blether.classes[a].methods.hasOwnProperty(f.selector))throw Blether.ParseError({line:d(),column:e(),msg:"Method "+f.selector+" already defined on class "+a});return Blether.classes[a].methods[f.selector]=new Blether.MethodDeclaration(a,f).at(d(),e(),c())},Kd=function(a){return a},Ld=function(a){return new Blether.VariableDeclaration(a)},Md=function(a,b){return new Blether.Program([a].concat(b)).at(d(),e(),c())},Nd=0,Od=0,Pd=0,Qd={line:1,column:1,seenCR:!1},Rd=0,Sd=[],Td=0;if("startRule"in Ba){if(!(Ba.startRule in Da))throw new Error("Can't start parsing from rule \""+Ba.startRule+'".');Ea=Da[Ba.startRule]}if(Blether.classes={Object:{classMethods:{},methods:{}}},Aa=Ea(),Aa!==Ca&&Nd===a.length)return Aa;throw Aa!==Ca&&Nd<a.length&&g({type:"end",description:"end of input"}),h(null,Sd,Rd)}return a(b,Error),{SyntaxError:b,parse:c}}(),BletherReturnOperatorVisitor=function(){function a(){return!1}function b(){return!0}this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){for(var b=0;b<a.elements.length;b++)if(a.elements[b].visit(this))return!0;return!1},this.visitClassDeclaration=function(a){for(var b in a.methods)if(a.methods.hasOwnProperty(b)&&a.methods[b].visit(this))return!0;return!1},this.visitMethodDeclaration=function(a){return a.body.visit(this)},this.visitMethod=function(a){for(var b=0;b<a.sequences.length;b++)if(a.sequences[b].visit(this))return!0;return!1},this.visitStatement=function(a){return a.expression.visit(this)},this.visitSequence=function(a){for(var b=0;b<a.statements.length;b++)if(a.statements[b].visit(this))return!0;return!1},this.visitSend=function(a){if(null!==a.receiver&&a.receiver.visit(this))return!0;for(var b=0;b<a.args.length;b++)if(a.args[b].visit(this))return!0;return!1},this.visitAssignment=function(a){return a.expression.visit(this)},this.visitBlock=function(a){return a.sequence.visit(this)},this.visitCascade=function(a){if(a.receiver.visit(this))return!0;for(var b=0;b<a.messages.length;b++)if(a.messages[b].visit(this))return!0;return!1},this.visitDynamicArray=function(a){for(var b=0;b<a.values.length;b++)if(a.values[b].visit(this))return!0;return!1},this.visitDynamicDictionary=function(a){for(var b in a.values)if(a.values.hasOwnProperty(b)&&a.values[b].visit(this))return!0;return!1},this.visitReturn=b,this.visitBinaryPattern=a,this.visitKeywordPattern=a,this.visitString=a,this.visitSymbol=a,this.visitUnaryPattern=a,this.visitNumber=a,this.visitUndefinedObject=a,this.visitBoolean=a,this.visitArray=a,this.visitJsStatement=a,this.visitVariableDeclaration=a,this.visitVariable=a,this.visitClassName=a},BletherTranslator=function(){"use strict";function a(a,b,c){if(a.params.length>b)throw Blether.ParseError({line:a.line,column:a.column,msg:"Too many parameters specified in block argument to "+c})}var b={};this.ensureNamespace=function(a){var c=a.value.split(".");if(1===c.length)return"";if(b.hasOwnProperty(a))return"";var d=c[0],e="var "+d+" = "+d+" || {};\n";b[d]=!0;for(var f=c.length-1,g=1;g<f;g++)d=d+"."+c[g],e+=d+" = "+d+" || {};\n",b[d]=!0;return e},this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){var b=this;this.context=new Blether.ContextMgr;var c="";return a.elements.forEach(function(a){("ClassMethodDeclaration"!==a._type&&"MethodDeclaration"!==a._type||"undefined"==typeof a.getClass().superClass)&&(c+=a.visit(b))}),c},this.visitClassDeclaration=function(a){var b=this,c="",d="Object"!==a.superClass,e=a.varNames.value;a.isNamespaced()?(c+=this.ensureNamespace(a.className),c+=a.className+" = function("):c+="function "+a.className+"(",c+=e.map(function(a){return"_"+a.value}).join(", "),c+=") {\n",e.forEach(function(a){var b=a.value;c+="this."+b+" = _"+b+";\n"}),c+="}"+(a.isNamespaced()?";":"")+"\n\n",d&&(c+=a.className+".prototype = Object.create("+a.superClass+".prototype);\n",c+=a.className+".prototype.constructor = "+a.superClass+";\n\n"),this.context.pushClass(a.className.value,e.map(function(a){return a.value}));var f=a.getMethods();for(var g in f)f.hasOwnProperty(g)&&(c+=f[g].visit(b));var h=a.getClassMethods();for(var i in h)h.hasOwnProperty(i)&&(c+=h[i].visit(b));return this.context.pop(),c},this.visitMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+".prototype."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitClassMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+"."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitString=function(a){return'"'+a.value.replace(/"/g,'\\"')+'"'},this.visitMethod=function(a){var b=a.selector.visit(this)[1];this.context.pushMethod(b);var c="function("+b.join(", ")+") {\n";if("JsStatement"===a.sequence._type)return c+=a.sequence.visit(this),c+="\n}";c+="var self = this;\n";for(var d=!1,e=new BletherReturnOperatorVisitor,f=0;f<a.sequence.statements.length;f++){var g=a.sequence.statements[f];if("Return"!==g._type&&e.visit(g)){d=!0;break}}d&&(c+="try {\n");var h=this;return c+=a.sequence.visit(h),d&&(c+="}\n",c+="catch (e) {\n",c+="  if (e instanceof STReturnValue) {\n",c+="    return e.value;\n",c+="  }\n",c+="  else {\n",c+="    throw e;\n",c+="  }\n",c+="}\n"),c+="}",this.context.pop(),c},this.visitUnaryPattern=function(a){return[convertSelector(a.selector),[]]},this.visitBinaryPattern=function(a){return[convertSelector(a.selector),[a.arg]]},this.visitKeywordPattern=function(a){var b=this,c=a.pairs.map(function(a){return a.key}),d=a.pairs.map(function(a){return a.arg}),e={};return d.forEach(function(c){if(e[c]=(e[c]||0)+1,e[c]>1)throw Blether.ParseError({line:a.line,column:a.column,msg:"Argument name "+c+" repeats in method "+b.context.currentClass()+">>"+a.selector})}),[convertSelector(c.join("")),d]},this.visitSymbol=function(a){return this.visitString(a)},this.visitClassName=function(a){return a.value},this.visitStatement=function(a){var b=a.expression.visit(this);return b+=";"!==b[b.length-1]?";\n":"\n"},this.visitSequence=function(a){var b=this,c="";this.context.pushTemps(a.temps),a.temps.length>0&&(c+="var "+a.temps.join(", ")+";\n");var d=!0;return a.statements.forEach(function(a,e,f){e===f.length-1&&("method"!==b.context.returnContext()?"Return"!==a._type?c+="return ":d=!1:"Return"===a._type&&(d=!1)),c+=a.visit(b)+";\n"}),d&&"method"===b.context.returnContext()&&(c+="return self;\n"),this.context.pop(),c},this.visitSend=function(a){var b=this,c=a.receiver.visit(this);switch("Block"===a.receiver._type&&(c="("+c+")"),c){case"super":return this.convertSuper(convertSelector(a.selector),a);case"NodeJS":return this.convertNodeJS(a)}var d="";if("value"===a.selector||a.selector.match(/^(value:)+$/))return d=c+".__value$(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")";switch(a.selector){case"at:":d+=this.convertAt(c,a.args[0]);break;case"at:put:":d+=this.convertAtPut(c,a.args[0],a.args[1]);break;case"isNil":d+="(typeof ("+c+') === "undefined" || '+c+" === null)";break;case"notNil":d+="(typeof ("+c+') !== "undefined" && '+c+" !== null)";break;case"isEmpty":d+="("+c+".length === 0)";break;case"ifEmpty:":d+=this.convertIfEmpty(c,a);break;case"ifNotEmpty:":d+=this.convertIfNotEmpty(c,a);break;case"notEmpty":d+="("+c+".length > 0)";break;case"ifNil:":d=this.convertIfNil(c,a);break;case"ifNotNil:":d=this.convertIfNotNil(c,a);break;case"ifNil:ifNotNil:":d=this.convertIfNilIfNotNil(c,a);break;case"new":d=this.convertNew(c);break;case"whileTrue:":case"whileFalse:":d=this.convertWhile(a);break;case"ifTrue:":case"ifFalse:":d=this.convertSingleIf(a);break;case"ifTrue:ifFalse:":case"ifFalse:ifTrue:":d=this.convertIfTrueIfFalse(a);break;case"and:":case"or:":d=this.convertAndOr(c,a);break;case"==":d=c+" === "+a.args[0].visit(b);break;case"~~":d=c+" !== "+a.args[0].visit(b);break;case"~=":d="!("+c+".equals$("+a.args[0].visit(b)+"))";break;case"asJQuery":d="jQuery("+c+")";break;default:d=c+"."+convertSelector(a.selector)+"(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")"}return d},this.visitAssignment=function(a){return a.variable.visit(this)+" = "+a.expression.visit(this)},this.visitNumber=function(a){return"("+a.value.toString()+")"},this.visitVariable=function(a){var b;if("self"===a.value)return"self";if("STReturnValue"===a.value)throw Blether.ParseError({line:a.line,column:a.column,msg:"Do not refer directly to STReturnValue - use the caret operator instead"});var c=this.context.getTemps();for(b=0;b<c.length;b++)if(a.value===c[b])return a.value;var d=this.context.getInstanceVars();for(b=0;b<d.length;b++)if(a.value===d[b])return"self."+a.value;if(a.value.match(/^[A-Z]/))return a.value;throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown variable name ["+a.value+"]"})},this.visitUndefinedObject=function(){return"null"},this.visitBoolean=function(a){return a.value.toString()},this.invokeBlock=function(a){if(0===a.sequence.statements.length)return"null";var b=[];if(arguments.length>1)for(var c=1;c<arguments.length;c++)b.push(arguments[c]);if(a.params.length!==b.length)throw Blether.ParseError({line:a.line,column:a.column,msg:"Not enough parameters specified to block"});if(1===a.sequence.statements.length&&0===a.sequence.temps.length){var d={};b.forEach(function(b,c){d[a.params[c]]=b}),a.find(function(a){return"Variable"===a._type}).forEach(function(a){d.hasOwnProperty(a.value)&&(a.value=d[a])}),this.context.pushTemps(b);var e=a.sequence.statements[0].visit(this);return this.context.pop(),e}return"("+a.visit(this)+")("+b.join(", ")+")"},this.visitBlock=function(a){this.context.pushBlock(a.params);var b="function("+a.params.join(", ")+") {\n";return b+=a.sequence.visit(this),b+="}",this.context.pop(),b},this.visitCascade=function(a){var b,c=this,d=!1;switch(a.receiver._type){case"Variable":case"String":case"Symbol":case"Number":case"Boolean":case"UndefinedObject":case"ClassName":d=!0}var e,f,g;if(d)f=a.messages.map(function(b){return b.receiver=a.receiver,b}),e=new Blether.Sequence([],f),g=new Blether.Block([],e),b="("+g.visit(c)+")()";else{var h=this.context.pushReceiver();f=a.messages.map(function(a){return a.receiver=new Blether.Variable(h),a}),e=new Blether.Sequence([],f),g=new Blether.Block([h],e),b="("+g.visit(c)+")("+a.receiver.visit(c)+")",this.context.popReceiver()}return b},this.visitJsStatement=function(a){return a.javascript.trim()},this.visitVariableDeclaration=function(a){return this.context.pushTemps(a.variables),"var "+a.variables.join(", ")+";\n"},this.visitArray=function(a){var b=this;return"["+a.value.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicArray=function(a){var b=this;return"["+a.values.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicDictionary=function(a){if(0===a.values.length)return"Object.create(null)";var b="(function() {\n";b+="var _dict = Object.create(null);\n";for(var c=0,d=1;d<a.values.length;c+=2,d+=2)b+="String"===a.values[c]._type||"Symbol"===a.values[c]._type?"_dict."+a.values[c].value+" = "+a.values[d].visit(this)+";\n":"_dict["+a.values[c].visit(this)+"] = "+a.values[d].visit(this)+";\n";return b+="return _dict;\n",b+="})()"},this.visitReturn=function(a){return"method"===this.context.returnContext()?"return "+a.value.visit(this):"stReturn("+a.value.visit(this)+")"},this.convertIfEmpty=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return ("+e+".length === 0) ? "+d.invoke(this)+" : null;\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotEmpty=function(b,c){var d=c.args[0];a(d,1,"ifNotEmpty:");var e,f=this.context.pushReceiver();return e="(function("+f+") {\n",e+="return ("+f+".length > 0) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,f),e+=" : null;\n",e+="})("+b+")",this.context.popReceiver(),e},this.convertIfNil=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return (typeof "+e+' === "undefined" || '+e+" === null) ",c+="? "+d.invoke(this)+" : "+e+";\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotNil=function(b,c){var d=c.args[0];a(d,1,"ifNotNil:");var e,f=1===d.params.length,g=f?d.params[0]:this.context.pushReceiver();return e="(function("+g+") {\n",e+="return (typeof "+g+' !== "undefined" && '+g+" !== null) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,g),e+=" : null;\n",e+="})("+b+")",f||this.context.popReceiver(),e},this.convertIfNilIfNotNil=function(b,c){var d=c.args[0],e=c.args[1];a(d,0,"ifNil:"),a(e,1,"ifNotNil:");var f=1===e.params.length,g=f?e.params[0]:this.context.pushReceiver(),h="(function("+g+") {\n";return h+="return (typeof "+g+' === "undefined" || '+g+" === null)",h+=" ? "+d.invoke(this)+" : ",h+=0===e.params.length?e.invoke(this):e.invoke(this,g),h+=";\n",h+="})("+b+")",f||this.context.popReceiver(),h},this.convertNew=function(a){return"new "+a+"()"},this.convertSuper=function(a,b){var c=this;if("undefined"!=typeof this.context.currentClass()){var d=this.context.currentClass()+".__super__."+a+".call(self";return b.args.length>0&&b.args.forEach(function(a){d+=", "+a.visit(c)}),d+=")"}throw Blether.ParseError({line:b.line,column:b.column,msg:"Can't use [super] outside a method declaration"})},this.convertWhile=function(a){if("Block"!==a.receiver._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" can be sent to blocks only"});var b,c="whileFalse:"===a.selector?"!":"";b=c+a.receiver.invoke(this);var d="while ("+b+") {\n";return d+=a.args[0].invoke(this)+";\n",d+="}\n"},this.convertSingleIf=function(a){if("Block"!==a.args[0]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b="ifFalse:"===a.selector?"!":"";return b?a.receiver.visit(this)+" ? null : "+a.args[0].invoke(this):a.receiver.visit(this)+" ? "+a.args[0].invoke(this)+" : null"},this.convertIfTrueIfFalse=function(a){if("Block"!==a.args[0]._type||"Block"!==a.args[1]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b=0,c=1;return"ifFalse:ifTrue:"===a.selector&&(b=1,c=0),a.receiver.visit(this)+" ? "+a.args[b].invoke(this)+" : "+a.args[c].invoke(this)},this.convertAt=function(a,b){return"String"===b._type||"Symbol"===b._type?a+"."+b.value:a+"["+b.visit(this)+"]"},this.convertAtPut=function(a,b,c){return"String"===b._type||"Symbol"===b._type?a+"."+b.value+" = "+c.visit(this):a+"["+b.visit(this)+"] = "+c.visit(this)},this.convertAndOr=function(a,b){if("Block"!==b.args[0]._type)throw Blether.ParseError({line:b.line,column:b.column,msg:b.selector+" accepts literal blocks only"});var c="and:"===b.selector?" && ":" || ";return a+c+b.args[0].invoke(this)},this.convertNodeJS=function(a){var b=this;switch(a.selector){case"filename":return"__filename";case"dirname":return"__dirname";case"require:":return"require("+a.args[0].visit(b)+")";default:throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown selector ["+a.selector+"]"})}}};module.exports={translate:function(a){var b=BletherParser.parse(a),c=(new BletherTranslator).visit(b);return c},runtime:function(){var a=require("path"),b=require("fs"),c=a.join(a.dirname(b.realpathSync(__filename)),"runtime.js");return b.readFileSync(c).toString()},BletherTranslator:BletherTranslator};