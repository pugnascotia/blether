/*! blether 12-06-2015 */
function convertSelector(a){var b={"\\":"backslash","+":"plus","*":"multiply","/":"divide","=":"equals",">":"greater_than","<":"less_than","@":"at","%":"modulo","~":"tilde","|":"or","&":"and","-":"minus"},c={"do:":"forEach","doWithIndex:":"forEach","select:":"filter",",":"concat"};if(c.hasOwnProperty(a))return c[a];if(a.match(/[\\+*/=><,@%~|&-]/))return"__"+a.split("").map(function(a){return b[a]}).join("_")+"$";if(a.match(/:/)){var d=a.split(":").filter(function(a){return a.length>0});a=d.length>1?d.join("_")+"$":d[0]}return a}function truthy(a){return"boolean"==typeof a&&a||"string"==typeof a&&"true"===a}var Blether={classes:{Object:{classMethods:{},methods:{}}}};Blether.ParseError=function(a){return{name:"Blether Parse Error",message:a.msg,line:a.line,column:a.column}},Blether.ParseError.prototype=new Error,Blether.ParseError.prototype.toString=function(){return this.message+":"+this.line+":"+this.column},Blether.Context=function(){this.currentClass=null,this.instanceVars=[],this.temps=[],this.returnContext=null},Blether.ContextMgr=function(){var a=[new Blether.Context];a[0].returnContext="root",this.pushClass=function(a,b){var c=new Blether.Context;c.className=a,c.instanceVars=b,this.push(c)},this.pushMethod=function(a){var b=new Blether.Context;b.returnContext="method",b.temps=a,this.push(b)},this.pushTemps=function(a){var b=new Blether.Context;b.temps=a,this.push(b)},this.pushBlock=function(a){var b=new Blether.Context;b.returnContext="block",b.temps=a,this.push(b)},this.push=function(b){a.push(b)},this.pop=function(){if(1===a.length)throw"Cannot pop the context beyond the initial state!";a.pop()};var b=0;this.pushReceiver=function(){return b++,"_receiver"+b+"$"},this.popReceiver=function(){if(0===b)throw"receiverDepth is already zero and cannot be popped further";b--},this.getTemps=function(){return a.reduceRight(function(a,b){return a.concat(b.temps)},[])},this.getInstanceVars=function(){return a.reduceRight(function(a,b){return a.concat(b.instanceVars)},[])},this.currentClass=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].className)return a[b].className;return null},this.returnContext=function(){for(var b=a.length-1;b>=0;b--)if(null!==a[b].returnContext)return a[b].returnContext;return null}},Blether.Node=function(){this.line=null,this.column=null,this.text=null},Blether.Node.prototype.at=function(a,b,c){return this.line=a,this.column=b,this.source=c,this},Blether.Node.prototype.invoke=function(){return this.visit.apply(this,arguments)},Blether.Node.prototype.find=function(a){return a(this)?[this]:[]},Blether.Node.prototype.isMethod=function(){return!1},Blether.String=function(a){this._type="String",this.value=a},Blether.String.prototype=new Blether.Node,Blether.String.prototype.toString=function(){return this.value},Blether.String.prototype.visit=function(a){return a.visitString(this)},Blether.Symbol=function(a){this._type="Symbol",this.value=a},Blether.Symbol.prototype=new Blether.Node,Blether.Symbol.prototype.toString=function(){return this.value},Blether.Symbol.prototype.visit=function(a){return a.visitSymbol(this)},Blether.Number=function(a){this._type="Number",this.value=a},Blether.Number.prototype=new Blether.Node,Blether.Number.prototype.toString=function(){return this.value},Blether.Number.prototype.visit=function(a){return a.visitNumber(this)},Blether.Array=function(a){this._type="Array",this.value=a},Blether.Array.prototype=new Blether.Node,Blether.Array.prototype.toString=function(){return"["+this.value.map(function(a){return'"'+a+'"'}).join(", ")+"]"},Blether.Array.prototype.visit=function(a){return a.visitArray(this)},Blether.DynamicArray=function(a){this._type="DynamicArray",this.values=a||[]},Blether.DynamicArray.prototype=new Blether.Array,Blether.DynamicArray.prototype.visit=function(a){return a.visitDynamicArray(this)},Blether.DynamicDictionary=function(a){this._type="DynamicDictionary",this.values=a||[]},Blether.DynamicDictionary.prototype=new Blether.Node,Blether.DynamicDictionary.prototype.visit=function(a){return a.visitDynamicDictionary(this)},Blether.UndefinedObject=function(){this._type="UndefinedObject"},Blether.UndefinedObject.prototype=new Blether.Node,Blether.UndefinedObject.prototype.toString=function(){return"nil"},Blether.UndefinedObject.prototype.visit=function(a){return a.visitUndefinedObject(this)},Blether.Boolean=function(a){this._type="Boolean",this.value=a},Blether.Boolean.prototype=new Blether.Node,Blether.Boolean.prototype.toString=function(){return this.value.toString()},Blether.Boolean.prototype.visit=function(a){return a.visitBoolean(this)},Blether.Variable=function(a){this._type="Variable",this.value=a},Blether.Variable.prototype=new Blether.Node,Blether.Variable.prototype.toString=function(){return this.value},Blether.Variable.prototype.visit=function(a){return a.visitVariable(this)},Blether.UnaryPattern=function(a){this._type="UnaryPattern",this.selector=a},Blether.UnaryPattern.prototype=new Blether.Node,Blether.UnaryPattern.prototype.toString=function(){return this.selector},Blether.UnaryPattern.prototype.visit=function(a){return a.visitUnaryPattern(this)},Blether.BinaryPattern=function(a,b){this._type="BinaryPattern",this.selector=a,this.arg=b},Blether.BinaryPattern.prototype=new Blether.Node,Blether.BinaryPattern.prototype.toString=function(){return this.selector+" - "+this.arg},Blether.BinaryPattern.prototype.visit=function(a){return a.visitBinaryPattern(this)},Blether.KeywordPattern=function(a){this._type="KeywordPattern",this.pairs=a,this.selector="#";for(var b=0;b<this.pairs.length;b++)this.selector+=this.pairs[b].key},Blether.KeywordPattern.prototype=new Blether.Node,Blether.KeywordPattern.prototype.toString=function(){return this.selector},Blether.KeywordPattern.prototype.visit=function(a){return a.visitKeywordPattern(this)},Blether.Assignment=function(a,b){this._type="Assignment",this.variable=a,this.expression=b},Blether.Assignment.prototype=new Blether.Node,Blether.Assignment.prototype.visit=function(a){return a.visitAssignment(this)},Blether.Return=function(a){this._type="Return",this.value=a},Blether.Return.prototype=new Blether.Node,Blether.Return.prototype.visit=function(a){return a.visitReturn(this)},Blether.Sequence=function(a,b){this._type="Sequence",this.temps=a||[],this.statements=b||[]},Blether.Sequence.prototype=new Blether.Node,Blether.Sequence.prototype.visit=function(a){return a.visitSequence(this)},Blether.Sequence.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.statements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.Statement=function(a){this._type="Statement",this.expression=a},Blether.Statement.prototype=new Blether.Node,Blether.Statement.prototype.visit=function(a){return a.visitStatement(this)},Blether.Statement.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.expression.find(a))},Blether.Block=function(a,b){this._type="Block",this.params=a||[],this.sequence=b},Blether.Block.prototype=new Blether.Node,Blether.Block.prototype.visit=function(a){return a.visitBlock(this)},Blether.Block.prototype.invoke=function(a){for(var b=[this],c=1;c<arguments.length;c++)b.push(arguments[c]);return a.invokeBlock.apply(a,b)},Blether.Block.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Send=function(a,b){this._type="Send",this.receiver=null,this.args=b||[],this.selector=a},Blether.Send.prototype=new Blether.Node,Blether.Send.prototype.visit=function(a){return a.visitSend(this)},Blether.Send.prototype.toString=function(){var a="["+this.args.map(function(a){return'"'+a+'"'}).join(", ")+"]";return"Send(#"+this.selector+(this.received?" to "+this.receiver:"")+(this.args.length>0?" with args "+a:"")+")"},Blether.Send.prototype.setReceiver=function(a){return null===this.receiver?this.receiver=a:this.receiver.setReceiver(a),this},Blether.Send.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b=this.args.reduce(function(b,c){return b.concat(c.find(a))},b),b.concat(this.receiver.find(a))},Blether.Cascade=function(a,b){this._type="Cascade",this.receiver=a,this.messages=b||[]},Blether.Cascade.prototype=new Blether.Node,Blether.Cascade.prototype.visit=function(a){return a.visitCascade(this)},Blether.JsStatement=function(a){this._type="JsStatement",this.javascript=a},Blether.JsStatement.prototype=new Blether.Node,Blether.JsStatement.prototype.visit=function(a){return a.visitJsStatement(this)},Blether.Method=function(a,b){this._type="Method",this.selector=a,this.sequence=b},Blether.Method.prototype=new Blether.Node,Blether.Method.prototype.visit=function(a){return a.visitMethod(this)},Blether.Method.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.sequence.find(a))},Blether.Comment=function(a){this._type="Comment",this.comment=a},Blether.Comment.prototype=new Blether.Node,Blether.Comment.prototype.visit=function(a){return a.visitComment(this)},Blether.MethodDeclaration=function(a,b){this._type="MethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].methods[b.selector]=this},Blether.MethodDeclaration.prototype=new Blether.Node,Blether.MethodDeclaration.prototype.visit=function(a){return a.visitMethodDeclaration(this)},Blether.MethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.MethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.MethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassMethodDeclaration=function(a,b){this._type="ClassMethodDeclaration",this.className=a,this.body=b,this.context=Blether,this.context.classes[a].classMethods[b.selector]=this},Blether.ClassMethodDeclaration.prototype=new Blether.Node,Blether.ClassMethodDeclaration.prototype.visit=function(a){return a.visitClassMethodDeclaration(this)},Blether.ClassMethodDeclaration.prototype.getClass=function(){return this.context.classes[this.className]},Blether.ClassMethodDeclaration.prototype.find=function(a){var b=[];return a(this)&&b.push(this),b.concat(this.body.find(a))},Blether.ClassMethodDeclaration.prototype.isMethod=function(){return!0},Blether.ClassDeclaration=function(a,b,c){this._type="ClassDeclaration",this.className=a,this.superClass=b,this.varNames=c,this.classMethods={},this.methods={},this.context=Blether},Blether.ClassDeclaration.prototype=new Blether.Node,Blether.ClassDeclaration.prototype.visit=function(a){return a.visitClassDeclaration(this)},Blether.ClassDeclaration.prototype.getMethods=function(){return this.context.classes[this.className].methods},Blether.ClassDeclaration.prototype.getClassMethods=function(){return this.context.classes[this.className].classMethods},Blether.Program=function(a){this._type="Program",this.elements=a},Blether.Program.prototype=new Blether.Node,Blether.Program.prototype.visit=function(a){return a.visitProgram(this)},Blether.Program.prototype.find=function(a){var b=[];return a(this)&&b.push(this),this.elements.reduce(function(b,c){return b.concat(c.find(a))},b)},Blether.VariableDeclaration=function(a){this._type="VariableDeclaration",this.variables=a},Blether.VariableDeclaration.prototype=new Blether.Node,Blether.VariableDeclaration.prototype.visit=function(a){return a.visitVariableDeclaration(this)};var BletherParser=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Je,Ie)}function d(){return f(Je).line}function e(){return f(Je).column}function f(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Ke!==b&&(Ke>b&&(Ke=0,Le={line:1,column:1,seenCR:!1}),c(Le,Ke,b),Ke=b),Le}function g(a){Me>Ie||(Ie>Me&&(Me=Ie,Ne=[]),Ne.push(a))}function h(c,d,e){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=f(e),j=e<a.length?a.charAt(e):null;return null!==d&&g(d),new b(null!==c?c:h(d,j),d,j,e,i.line,i.column)}function i(){var a;return a=xb()}function j(){var b,c;if(b=[],Eb.test(a.charAt(Ie))?(c=a.charAt(Ie),Ie++):(c=Ab,0===Oe&&g(Fb)),c!==Ab)for(;c!==Ab;)b.push(c),Eb.test(a.charAt(Ie))?(c=a.charAt(Ie),Ie++):(c=Ab,0===Oe&&g(Fb));else b=Db;return b}function k(){var b,c,d,e,f;if(b=Ie,34===a.charCodeAt(Ie)?(c=Gb,Ie++):(c=Ab,0===Oe&&g(Hb)),c!==Ab){for(d=[],e=Ie,a.substr(Ie,2)===Ib?(f=Ib,Ie+=2):(f=Ab,0===Oe&&g(Jb)),f!==Ab&&(Je=e,f=Kb()),e=f,e===Ab&&(Lb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Mb)));e!==Ab;)d.push(e),e=Ie,a.substr(Ie,2)===Ib?(f=Ib,Ie+=2):(f=Ab,0===Oe&&g(Jb)),f!==Ab&&(Je=e,f=Kb()),e=f,e===Ab&&(Lb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Mb)));d!==Ab?(34===a.charCodeAt(Ie)?(e=Gb,Ie++):(e=Ab,0===Oe&&g(Hb)),e!==Ab?(c=[c,d,e],b=c):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function l(){var a,b;for(a=[],b=j(),b===Ab&&(b=k());b!==Ab;)a.push(b),b=j(),b===Ab&&(b=k());return a}function m(){var b,c,d,e;if(b=Ie,Nb.test(a.charAt(Ie))?(c=a.charAt(Ie),Ie++):(c=Ab,0===Oe&&g(Ob)),c!==Ab){for(d=[],Pb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Qb));e!==Ab;)d.push(e),Pb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Qb));d!==Ab?(Je=b,c=Rb(c,d),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function n(){var b,c,d;return b=Ie,c=m(),c!==Ab?(58===a.charCodeAt(Ie)?(d=Sb,Ie++):(d=Ab,0===Oe&&g(Tb)),d!==Ab?(Je=b,c=Ub(c,d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db),b}function o(){var b,c,d,e;if(b=Ie,Nb.test(a.charAt(Ie))?(c=a.charAt(Ie),Ie++):(c=Ab,0===Oe&&g(Ob)),c!==Ab){for(d=[],Vb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Wb));e!==Ab;)d.push(e),Vb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Wb));d!==Ab?(Je=b,c=Xb(c,d),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function p(){var b,c,d,e;if(b=Ie,Yb.test(a.charAt(Ie))?(c=a.charAt(Ie),Ie++):(c=Ab,0===Oe&&g(Zb)),c!==Ab){for(d=[],Pb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Qb));e!==Ab;)d.push(e),Pb.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Qb));d!==Ab?(Je=b,c=Xb(c,d),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function q(){var b,c,d,e,f;if(b=Ie,39===a.charCodeAt(Ie)?(c=$b,Ie++):(c=Ab,0===Oe&&g(_b)),c!==Ab){for(d=[],e=Ie,a.substr(Ie,2)===ac?(f=ac,Ie+=2):(f=Ab,0===Oe&&g(bc)),f!==Ab&&(Je=e,f=cc()),e=f,e===Ab&&(dc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(ec)));e!==Ab;)d.push(e),e=Ie,a.substr(Ie,2)===ac?(f=ac,Ie+=2):(f=Ab,0===Oe&&g(bc)),f!==Ab&&(Je=e,f=cc()),e=f,e===Ab&&(dc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(ec)));d!==Ab?(39===a.charCodeAt(Ie)?(e=$b,Ie++):(e=Ab,0===Oe&&g(_b)),e!==Ab?(Je=b,c=fc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function r(){var b,c,d;return b=Ie,36===a.charCodeAt(Ie)?(c=gc,Ie++):(c=Ab,0===Oe&&g(hc)),c!==Ab?(a.length>Ie?(d=a.charAt(Ie),Ie++):(d=Ab,0===Oe&&g(ic)),d!==Ab?(Je=b,c=jc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db),b}function s(){var b,c,d;return b=Ie,35===a.charCodeAt(Ie)?(c=kc,Ie++):(c=Ab,0===Oe&&g(lc)),c!==Ab?(d=t(),d!==Ab?(Je=b,c=mc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db),b}function t(){var a,b,c;return a=Ie,b=o(),b===Ab&&(b=N(),b===Ab&&(b=Ie,c=q(),c!==Ab&&(Je=b,c=nc(c)),b=c)),b!==Ab&&(Je=a,b=oc(b)),a=b}function u(){var a,b;return a=Ie,b=v(),b===Ab&&(b=w(),b===Ab&&(b=x(),b===Ab&&(b=y()))),b!==Ab&&(Je=a,b=pc(b)),a=b}function v(){var b,c,d,e,f;return b=Ie,c=Ie,d=x(),d===Ab&&(d=y()),d!==Ab?(101===a.charCodeAt(Ie)?(e=qc,Ie++):(e=Ab,0===Oe&&g(rc)),e!==Ab?(f=y(),f!==Ab?(d=[d,e,f],c=d):(Ie=c,c=Db)):(Ie=c,c=Db)):(Ie=c,c=Db),c!==Ab&&(Je=b,c=sc(c)),b=c}function w(){var b,c,d,e,f;if(b=Ie,45===a.charCodeAt(Ie)?(c=uc,Ie++):(c=Ab,0===Oe&&g(vc)),c===Ab&&(c=tc),c!==Ab)if(a.substr(Ie,3)===wc?(d=wc,Ie+=3):(d=Ab,0===Oe&&g(xc)),d!==Ab){if(e=[],yc.test(a.charAt(Ie))?(f=a.charAt(Ie),Ie++):(f=Ab,0===Oe&&g(zc)),f!==Ab)for(;f!==Ab;)e.push(f),yc.test(a.charAt(Ie))?(f=a.charAt(Ie),Ie++):(f=Ab,0===Oe&&g(zc));else e=Db;e!==Ab?(Je=b,c=Ac(c,e),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;else Ie=b,b=Db;return b}function x(){var b,c,d,e,f,h;if(b=Ie,45===a.charCodeAt(Ie)?(c=uc,Ie++):(c=Ab,0===Oe&&g(vc)),c===Ab&&(c=tc),c!==Ab){if(d=[],Bc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Cc)),e!==Ab)for(;e!==Ab;)d.push(e),Bc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Cc));else d=Db;if(d!==Ab)if(46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec)),e!==Ab){if(f=[],Bc.test(a.charAt(Ie))?(h=a.charAt(Ie),Ie++):(h=Ab,0===Oe&&g(Cc)),h!==Ab)for(;h!==Ab;)f.push(h),Bc.test(a.charAt(Ie))?(h=a.charAt(Ie),Ie++):(h=Ab,0===Oe&&g(Cc));else f=Db;f!==Ab?(Je=b,c=Fc(c,d,f),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;else Ie=b,b=Db}else Ie=b,b=Db;return b}function y(){var b,c,d,e;if(b=Ie,45===a.charCodeAt(Ie)?(c=uc,Ie++):(c=Ab,0===Oe&&g(vc)),c===Ab&&(c=tc),c!==Ab){if(d=[],Bc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Cc)),e!==Ab)for(;e!==Ab;)d.push(e),Bc.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(Cc));else d=Db;d!==Ab?(Je=b,c=Gc(c,d),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function z(){var b,c,d;return b=Ie,a.substr(Ie,2)===Hc?(c=Hc,Ie+=2):(c=Ab,0===Oe&&g(Ic)),c!==Ab?(d=B(),d!==Ab?(Je=b,c=mc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db),b}function A(){var b,c,d;return b=Ie,40===a.charCodeAt(Ie)?(c=Jc,Ie++):(c=Ab,0===Oe&&g(Kc)),c!==Ab?(d=B(),d!==Ab?(Je=b,c=mc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db),b}function B(){var b,c,d,e,f;for(b=Ie,c=[],d=Ie,e=l(),e!==Ab?(f=I(),f===Ab&&(f=A(),f===Ab&&(f=t())),f!==Ab?(Je=d,e=Lc(f),d=e):(Ie=d,d=Db)):(Ie=d,d=Db);d!==Ab;)c.push(d),d=Ie,e=l(),e!==Ab?(f=I(),f===Ab&&(f=A(),f===Ab&&(f=t())),f!==Ab?(Je=d,e=Lc(f),d=e):(Ie=d,d=Db)):(Ie=d,d=Db);return c!==Ab?(d=l(),d!==Ab?(41===a.charCodeAt(Ie)?(e=Mc,Ie++):(e=Ab,0===Oe&&g(Nc)),e!==Ab?(Je=b,c=Oc(c),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function C(){var b,c,d,e,f,h;if(b=Ie,a.substr(Ie,2)===Hc?(c=Hc,Ie+=2):(c=Ab,0===Oe&&g(Ic)),c!==Ab){for(d=[],e=Ie,f=l(),f!==Ab?(h=s(),h===Ab&&(h=t()),h!==Ab?(Je=e,f=Pc(h),e=f):(Ie=e,e=Db)):(Ie=e,e=Db);e!==Ab;)d.push(e),e=Ie,f=l(),f!==Ab?(h=s(),h===Ab&&(h=t()),h!==Ab?(Je=e,f=Pc(h),e=f):(Ie=e,e=Db)):(Ie=e,e=Db);d!==Ab?(e=l(),e!==Ab?(41===a.charCodeAt(Ie)?(f=Mc,Ie++):(f=Ab,0===Oe&&g(Nc)),f!==Ab?(Je=b,c=Qc(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function D(){var b,c,d,e,f,h,i;return b=Ie,123===a.charCodeAt(Ie)?(c=Rc,Ie++):(c=Ab,0===Oe&&g(Sc)),c!==Ab?(d=l(),d!==Ab?(e=V(),e===Ab&&(e=tc),e!==Ab?(f=l(),f!==Ab?(46===a.charCodeAt(Ie)?(h=Dc,Ie++):(h=Ab,0===Oe&&g(Ec)),h===Ab&&(h=tc),h!==Ab?(125===a.charCodeAt(Ie)?(i=Tc,Ie++):(i=Ab,0===Oe&&g(Uc)),i!==Ab?(Je=b,c=Vc(e),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function E(){var b,c,d,e,f,h;return b=Ie,a.substr(Ie,2)===Wc?(c=Wc,Ie+=2):(c=Ab,0===Oe&&g(Xc)),c!==Ab?(d=l(),d!==Ab?(e=tb(),e===Ab&&(e=tc),e!==Ab?(f=l(),f!==Ab?(125===a.charCodeAt(Ie)?(h=Tc,Ie++):(h=Ab,0===Oe&&g(Uc)),h!==Ab?(Je=b,c=Yc(e),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function F(){var b,c,d;return b=Ie,c=Ie,a.substr(Ie,4)===Zc?(d=Zc,Ie+=4):(d=Ab,0===Oe&&g($c)),d!==Ab&&(Je=c,d=_c()),c=d,c===Ab&&(c=Ie,a.substr(Ie,5)===ad?(d=ad,Ie+=5):(d=Ab,0===Oe&&g(bd)),d!==Ab&&(Je=c,d=cd()),c=d),c!==Ab&&(Je=b,c=dd(c)),b=c}function G(){var b,c;return b=Ie,a.substr(Ie,3)===ed?(c=ed,Ie+=3):(c=Ab,0===Oe&&g(fd)),c!==Ab&&(Je=b,c=gd(c)),b=c}function H(){var a;return a=F(),a===Ab&&(a=G()),a}function I(){var a;return a=H(),a===Ab&&(a=u(),a===Ab&&(a=z(),a===Ab&&(a=q(),a===Ab&&(a=s(),a===Ab&&(a=r()))))),a}function J(){var a;return a=E(),a===Ab&&(a=D(),a===Ab&&(a=db())),a}function K(){var a;return a=J(),a===Ab&&(a=I()),a}function L(){var a,b;return a=Ie,b=m(),b!==Ab&&(Je=a,b=hd(b)),a=b}function M(){var a,b,c,d,e;return a=Ie,b=l(),b!==Ab?(c=n(),c!==Ab?(d=l(),d!==Ab?(e=kb(),e!==Ab?(Je=a,b=id(c,e),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function N(){var b,c,d;if(b=Ie,c=[],jd.test(a.charAt(Ie))?(d=a.charAt(Ie),Ie++):(d=Ab,0===Oe&&g(kd)),d!==Ab)for(;d!==Ab;)c.push(d),jd.test(a.charAt(Ie))?(d=a.charAt(Ie),Ie++):(d=Ab,0===Oe&&g(kd));else c=Db;return c!==Ab&&(Je=b,c=ld(c)),b=c}function O(){var a,b,c,d,e,f,g;if(a=Ie,b=[],c=Ie,d=l(),d!==Ab?(e=n(),e!==Ab?(f=l(),f!==Ab?(g=m(),g!==Ab?(Je=c,d=id(e,g),c=d):(Ie=c,c=Db)):(Ie=c,c=Db)):(Ie=c,c=Db)):(Ie=c,c=Db),c!==Ab)for(;c!==Ab;)b.push(c),c=Ie,d=l(),d!==Ab?(e=n(),e!==Ab?(f=l(),f!==Ab?(g=m(),g!==Ab?(Je=c,d=id(e,g),c=d):(Ie=c,c=Db)):(Ie=c,c=Db)):(Ie=c,c=Db)):(Ie=c,c=Db);else b=Db;return b!==Ab&&(Je=a,b=md(b)),a=b}function P(){var a,b,c,d,e;return a=Ie,b=l(),b!==Ab?(c=N(),c!==Ab?(d=l(),d!==Ab?(e=m(),e!==Ab?(Je=a,b=nd(c,e),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function Q(){var a,b,c;return a=Ie,b=l(),b!==Ab?(c=m(),c!==Ab?(Je=a,b=od(c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function R(){var a,b,c,d,e;return a=Ie,b=nb(),b!==Ab?(c=Ie,d=l(),d!==Ab?(e=R(),e!==Ab?(Je=c,d=pd(e),c=d):(Ie=c,c=Db)):(Ie=c,c=Db),c===Ab&&(c=tc),c!==Ab?(Je=a,b=qd(b),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function S(){var a,b,c,d,e;return a=Ie,b=mb(),b===Ab&&(b=kb()),b!==Ab?(c=Ie,d=l(),d!==Ab?(e=R(),e!==Ab?(Je=c,d=rd(e),c=d):(Ie=c,c=Db)):(Ie=c,c=Db),c===Ab&&(c=tc),c!==Ab?(Je=a,b=sd(b,c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function T(){var a;return a=W(),a===Ab&&(a=ob(),a===Ab&&(a=S())),a}function U(){var b,c,d,e,f;return b=Ie,c=l(),c!==Ab?(46===a.charCodeAt(Ie)?(d=Dc,Ie++):(d=Ab,0===Oe&&g(Ec)),d!==Ab?(e=l(),e!==Ab?(f=T(),f!==Ab?(Je=b,c=td(f),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function V(){var a,b,c,d;if(a=Ie,b=T(),b!==Ab){for(c=[],d=U();d!==Ab;)c.push(d),d=U();c!==Ab?(Je=a,b=ud(b,c),a=b):(Ie=a,a=Db)}else Ie=a,a=Db;return a}function W(){var b,c,d,e,f,h;return b=Ie,c=L(),c!==Ab?(d=l(),d!==Ab?(a.substr(Ie,2)===vd?(e=vd,Ie+=2):(e=Ab,0===Oe&&g(wd)),e!==Ab?(f=l(),f!==Ab?(h=T(),h!==Ab?(Je=b,c=xd(c,h),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function X(){var b,c,d,e,f,h;return b=Ie,94===a.charCodeAt(Ie)?(c=yd,Ie++):(c=Ab,0===Oe&&g(zd)),c!==Ab?(d=l(),d!==Ab?(e=T(),e!==Ab?(f=l(),f!==Ab?(46===a.charCodeAt(Ie)?(h=Dc,Ie++):(h=Ab,0===Oe&&g(Ec)),h===Ab&&(h=tc),h!==Ab?(Je=b,c=Ad(e),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function Y(){var b,c,d,e,f,h;if(b=Ie,124===a.charCodeAt(Ie)?(c=Bd,Ie++):(c=Ab,0===Oe&&g(Cd)),c!==Ab){for(d=[],e=Ie,f=l(),f!==Ab?(h=m(),h!==Ab?(Je=e,f=Dd(h),e=f):(Ie=e,e=Db)):(Ie=e,e=Db);e!==Ab;)d.push(e),e=Ie,f=l(),f!==Ab?(h=m(),h!==Ab?(Je=e,f=Dd(h),e=f):(Ie=e,e=Db)):(Ie=e,e=Db);d!==Ab?(e=l(),e!==Ab?(124===a.charCodeAt(Ie)?(f=Bd,Ie++):(f=Ab,0===Oe&&g(Cd)),f!==Ab?(Je=b,c=Ed(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function Z(){var b,c,d,e,f,h,i;if(b=Ie,c=[],d=Ie,e=l(),e!==Ab?(58===a.charCodeAt(Ie)?(f=Sb,Ie++):(f=Ab,0===Oe&&g(Tb)),f!==Ab?(h=l(),h!==Ab?(i=m(),i!==Ab?(Je=d,e=Fd(i),d=e):(Ie=d,d=Db)):(Ie=d,d=Db)):(Ie=d,d=Db)):(Ie=d,d=Db),d!==Ab)for(;d!==Ab;)c.push(d),d=Ie,e=l(),e!==Ab?(58===a.charCodeAt(Ie)?(f=Sb,Ie++):(f=Ab,0===Oe&&g(Tb)),f!==Ab?(h=l(),h!==Ab?(i=m(),i!==Ab?(Je=d,e=Fd(i),d=e):(Ie=d,d=Db)):(Ie=d,d=Db)):(Ie=d,d=Db)):(Ie=d,d=Db);else c=Db;return c!==Ab?(d=l(),d!==Ab?(124===a.charCodeAt(Ie)?(e=Bd,Ie++):(e=Ab,0===Oe&&g(Cd)),e!==Ab?(Je=b,c=Gd(c),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function $(){var b,c,d,e,f,h;return b=Ie,40===a.charCodeAt(Ie)?(c=Jc,Ie++):(c=Ab,0===Oe&&g(Kc)),c!==Ab?(d=l(),d!==Ab?(e=T(),e!==Ab?(f=l(),f!==Ab?(41===a.charCodeAt(Ie)?(h=Mc,Ie++):(h=Ab,0===Oe&&g(Nc)),h!==Ab?(Je=b,c=td(e),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function _(){var b,c,d,e,f,h,i,j;if(b=Ie,c=X(),c!==Ab){for(d=[],46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec));e!==Ab;)d.push(e),46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec));d!==Ab?(Je=b,c=Hd(c),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;if(b===Ab){if(b=Ie,c=V(),c!==Ab)if(d=l(),d!==Ab){if(e=[],46===a.charCodeAt(Ie)?(f=Dc,Ie++):(f=Ab,0===Oe&&g(Ec)),f!==Ab)for(;f!==Ab;)e.push(f),46===a.charCodeAt(Ie)?(f=Dc,Ie++):(f=Ab,0===Oe&&g(Ec));else e=Db;if(e!==Ab)if(f=l(),f!==Ab)if(h=X(),h!==Ab){for(i=[],46===a.charCodeAt(Ie)?(j=Dc,Ie++):(j=Ab,0===Oe&&g(Ec));j!==Ab;)i.push(j),46===a.charCodeAt(Ie)?(j=Dc,Ie++):(j=Ab,0===Oe&&g(Ec));i!==Ab?(Je=b,c=Id(c,h),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;else Ie=b,b=Db;else Ie=b,b=Db}else Ie=b,b=Db;else Ie=b,b=Db;if(b===Ab)if(b=Ie,c=V(),c===Ab&&(c=tc),c!==Ab){for(d=[],46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec));e!==Ab;)d.push(e),46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec));d!==Ab?(Je=b,c=Jd(c),b=c):(Ie=b,b=Db)}else Ie=b,b=Db}return b}function ab(){var b,c,d,e;return b=Ie,c=Ie,d=T(),d!==Ab?(46===a.charCodeAt(Ie)?(e=Dc,Ie++):(e=Ab,0===Oe&&g(Ec)),e!==Ab?(Je=c,d=Kd(d),c=d):(Ie=c,c=Db)):(Ie=c,c=Db),c===Ab&&(c=pb()),c!==Ab&&(Je=b,c=Ld(c)),b=c}function bb(){var a;return a=pb(),a===Ab&&(a=cb()),a}function cb(){var a,b,c,d,e;return a=Ie,b=Y(),b===Ab&&(b=tc),b!==Ab?(c=l(),c!==Ab?(d=_(),d===Ab&&(d=tc),d!==Ab?(e=l(),e!==Ab?(Je=a,b=Md(b,d),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function db(){var b,c,d,e,f,h,i;return b=Ie,91===a.charCodeAt(Ie)?(c=Nd,Ie++):(c=Ab,0===Oe&&g(Od)),c!==Ab?(d=Z(),d===Ab&&(d=tc),d!==Ab?(e=l(),e!==Ab?(f=bb(),f===Ab&&(f=tc),f!==Ab?(h=l(),h!==Ab?(93===a.charCodeAt(Ie)?(i=Pd,Ie++):(i=Ab,0===Oe&&g(Qd)),i!==Ab?(Je=b,c=Rd(d,f),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function eb(){var a;return a=K(),a===Ab&&(a=L(),a===Ab&&(a=$())),a}function fb(){var b,c,d,e,f;return b=Ie,c=l(),c!==Ab?(d=m(),d!==Ab?(e=Ie,Oe++,58===a.charCodeAt(Ie)?(f=Sb,Ie++):(f=Ab,0===Oe&&g(Tb)),Oe--,f===Ab?e=Sd:(Ie=e,e=Db),e!==Ab?(Je=b,c=Td(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function gb(){var a,b,c,d,e;return a=Ie,b=fb(),b!==Ab?(c=l(),c!==Ab?(d=gb(),d===Ab&&(d=tc),d!==Ab?(e=l(),e!==Ab?(Je=a,b=Ud(b,d),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function hb(){var a,b,c,d;return a=Ie,b=eb(),b!==Ab?(c=l(),c!==Ab?(d=gb(),d===Ab&&(d=tc),d!==Ab?(Je=a,b=Vd(b,d),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function ib(){var a,b,c,d,e;return a=Ie,b=l(),b!==Ab?(c=N(),c!==Ab?(d=l(),d!==Ab?(e=hb(),e===Ab&&(e=eb()),e!==Ab?(Je=a,b=Wd(c,e),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function jb(){var a,b,c;return a=Ie,b=ib(),b!==Ab?(c=jb(),c===Ab&&(c=tc),c!==Ab?(Je=a,b=Ud(b,c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function kb(){var a,b,c;return a=Ie,b=hb(),b!==Ab?(c=jb(),c===Ab&&(c=tc),c!==Ab?(Je=a,b=Vd(b,c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function lb(){var a,b,c;if(a=Ie,b=[],c=M(),c!==Ab)for(;c!==Ab;)b.push(c),c=M();else b=Db;return b!==Ab&&(Je=a,b=Xd(b)),a=b}function mb(){var a,b,c;return a=Ie,b=kb(),b!==Ab?(c=lb(),c!==Ab?(Je=a,b=Yd(b,c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function nb(){var a;return a=ib(),a===Ab&&(a=fb(),a===Ab&&(a=lb())),a}function ob(){var b,c,d,e,f,h,i,j,k;if(b=Ie,c=l(),c!==Ab)if(d=mb(),d===Ab&&(d=kb()),d!==Ab){if(e=[],f=Ie,h=l(),h!==Ab?(59===a.charCodeAt(Ie)?(i=Zd,Ie++):(i=Ab,0===Oe&&g($d)),i!==Ab?(j=l(),j!==Ab?(k=nb(),k!==Ab?(Je=f,h=_d(k),f=h):(Ie=f,f=Db)):(Ie=f,f=Db)):(Ie=f,f=Db)):(Ie=f,f=Db),f!==Ab)for(;f!==Ab;)e.push(f),f=Ie,h=l(),h!==Ab?(59===a.charCodeAt(Ie)?(i=Zd,Ie++):(i=Ab,0===Oe&&g($d)),i!==Ab?(j=l(),j!==Ab?(k=nb(),k!==Ab?(Je=f,h=_d(k),f=h):(Ie=f,f=Db)):(Ie=f,f=Db)):(Ie=f,f=Db)):(Ie=f,f=Db);else e=Db;e!==Ab?(Je=b,c=ae(d,e),b=c):(Ie=b,b=Db)}else Ie=b,b=Db;else Ie=b,b=Db;return b}function pb(){var b,c,d,e,f;if(b=Ie,60===a.charCodeAt(Ie)?(c=be,Ie++):(c=Ab,0===Oe&&g(ce)),c!==Ab){for(d=[],e=Ie,a.substr(Ie,2)===de?(f=de,Ie+=2):(f=Ab,0===Oe&&g(ee)),f!==Ab&&(Je=e,f=fe()),e=f,e===Ab&&(ge.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(he)));e!==Ab;)d.push(e),e=Ie,a.substr(Ie,2)===de?(f=de,Ie+=2):(f=Ab,0===Oe&&g(ee)),f!==Ab&&(Je=e,f=fe()),e=f,e===Ab&&(ge.test(a.charAt(Ie))?(e=a.charAt(Ie),Ie++):(e=Ab,0===Oe&&g(he)));d!==Ab?(62===a.charCodeAt(Ie)?(e=ie,Ie++):(e=Ab,0===Oe&&g(je)),e!==Ab?(Je=b,c=ke(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;return b}function qb(){var a,b,c,d,e;return a=Ie,b=O(),b===Ab&&(b=P(),b===Ab&&(b=Q())),b!==Ab?(c=l(),c!==Ab?(d=bb(),d===Ab&&(d=tc),d!==Ab?(e=l(),e!==Ab?(Je=a,b=le(b,d),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function rb(){var a,b,c;return a=Ie,b=kb(),b!==Ab?(Je=Ie,c=me(b),c=c?Sd:Db,c!==Ab?(Je=a,b=ne(b),a=b):(Ie=a,a=Db)):(Ie=a,a=Db),a}function sb(){var b,c,d,e,f;return b=Ie,c=l(),c!==Ab?(46===a.charCodeAt(Ie)?(d=Dc,Ie++):(d=Ab,0===Oe&&g(Ec)),d!==Ab?(e=l(),e!==Ab?(f=rb(),f!==Ab?(Je=b,c=td(f),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function tb(){var a,b,c,d;if(a=Ie,b=rb(),b!==Ab){for(c=[],d=sb();d!==Ab;)c.push(d),d=sb();c!==Ab?(Je=a,b=oe(b,c),a=b):(Ie=a,a=Db)}else Ie=a,a=Db;return a}function ub(){var b,c,d,e,f,h,i,j,k,m,n,p,q,r,t,u,v,w,x;return b=Ie,c=o(),c!==Ab?(d=l(),d!==Ab?(a.substr(Ie,9)===pe?(e=pe,Ie+=9):(e=Ab,0===Oe&&g(qe)),e!==Ab?(f=l(),f!==Ab?(h=s(),h!==Ab?(i=l(),i!==Ab?(a.substr(Ie,10)===re?(j=re,Ie+=10):(j=Ab,0===Oe&&g(se)),j===Ab&&(a.substr(Ie,22)===te?(j=te,Ie+=22):(j=Ab,0===Oe&&g(ue))),j!==Ab?(k=l(),k!==Ab?(m=C(),m!==Ab?(n=Ie,p=l(),p!==Ab?(a.substr(Ie,19)===ve?(q=ve,Ie+=19):(q=Ab,0===Oe&&g(we)),q!==Ab?(r=l(),r!==Ab?(t=C(),t!==Ab?(u=l(),u!==Ab?(a.substr(Ie,17)===xe?(v=xe,Ie+=17):(v=Ab,0===Oe&&g(ye)),v!==Ab?(w=l(),w!==Ab?(x=C(),x!==Ab?(p=[p,q,r,t,u,v,w,x],n=p):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db)):(Ie=n,n=Db),n===Ab&&(n=tc),n!==Ab?(p=l(),p!==Ab?(46===a.charCodeAt(Ie)?(q=Dc,Ie++):(q=Ab,0===Oe&&g(Ec)),q!==Ab?(Je=b,c=ze(c,h,m),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b}function vb(){var b,c,d,e,f,h,i,k,m;if(b=Ie,33===a.charCodeAt(Ie)?(c=Ae,Ie++):(c=Ab,0===Oe&&g(Be)),c!==Ab)if(d=p(),d!==Ab)if(e=l(),e!==Ab){if(f=Ie,a.substr(Ie,5)===Ce?(h=Ce,Ie+=5):(h=Ab,0===Oe&&g(De)),h!==Ab){if(i=[],k=j(),k!==Ab)for(;k!==Ab;)i.push(k),k=j();else i=Db;i!==Ab?(h=[h,i],f=h):(Ie=f,f=Db)}else Ie=f,f=Db;f===Ab&&(f=tc),f!==Ab?(h=qb(),h!==Ab?(33===a.charCodeAt(Ie)?(i=Ae,Ie++):(i=Ab,0===Oe&&g(Be)),i!==Ab?(k=l(),k===Ab&&(k=tc),k!==Ab?(46===a.charCodeAt(Ie)?(m=Dc,Ie++):(m=Ab,0===Oe&&g(Ec)),m!==Ab?(Je=b,c=Ee(d,f,h),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db)}else Ie=b,b=Db;else Ie=b,b=Db;else Ie=b,b=Db;return b}function wb(){var a,b,c,d;return a=Ie,b=l(),b===Ab&&(b=tc),b!==Ab?(c=vb(),c===Ab&&(c=ub(),c===Ab&&(c=ab())),c!==Ab?(d=l(),d===Ab&&(d=tc),d!==Ab?(Je=a,b=Fe(c),a=b):(Ie=a,a=Db)):(Ie=a,a=Db)):(Ie=a,a=Db),a}function xb(){var a,b,c,d,e;if(a=Ie,b=Ie,c=l(),c===Ab&&(c=tc),c!==Ab?(d=Y(),d!==Ab?(e=l(),e===Ab&&(e=tc),e!==Ab?(Je=b,c=Ge(d),b=c):(Ie=b,b=Db)):(Ie=b,b=Db)):(Ie=b,b=Db),b===Ab&&(b=wb()),b!==Ab){for(c=[],d=wb();d!==Ab;)c.push(d),d=wb();c!==Ab?(Je=a,b=He(b,c),a=b):(Ie=a,a=Db)}else Ie=a,a=Db;return a}var yb,zb=arguments.length>1?arguments[1]:{},Ab={},Bb={start:i},Cb=i,Db=Ab,Eb=/^[ \t\x0B\f\xA0\uFEFF\n\r\u2028\u2029]/,Fb={type:"class",value:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]",description:"[ \\t\\x0B\\f\\xA0\\uFEFF\\n\\r\\u2028\\u2029]"},Gb='"',Hb={type:"literal",value:'"',description:'"\\""'},Ib='""',Jb={type:"literal",value:'""',description:'"\\"\\""'},Kb=function(){return'"'},Lb=/^[^"]/,Mb={type:"class",value:'[^"]',description:'[^"]'},Nb=/^[a-zA-Z]/,Ob={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Pb=/^[a-zA-Z0-9]/,Qb={type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},Rb=function(a,b){return a+b.join("")
},Sb=":",Tb={type:"literal",value:":",description:'":"'},Ub=function(a,b){return a+b},Vb=/^[a-zA-Z0-9:]/,Wb={type:"class",value:"[a-zA-Z0-9:]",description:"[a-zA-Z0-9:]"},Xb=function(a,b){return a+b.join("")},Yb=/^[A-Z]/,Zb={type:"class",value:"[A-Z]",description:"[A-Z]"},$b="'",_b={type:"literal",value:"'",description:'"\'"'},ac="''",bc={type:"literal",value:"''",description:"\"''\""},cc=function(){return"'"},dc=/^[^']/,ec={type:"class",value:"[^']",description:"[^']"},fc=function(a){return new Blether.String(a.join("")).at(d(),e(),c())},gc="$",hc={type:"literal",value:"$",description:'"$"'},ic={type:"any",description:"any character"},jc=function(a){return new Blether.String(a).at(d(),e(),c())},kc="#",lc={type:"literal",value:"#",description:'"#"'},mc=function(a){return a},nc=function(a){return a.value},oc=function(a){return new Blether.Symbol(a).at(d(),e(),c())},pc=function(a){return new Blether.Number(a).at(d(),e(),c())},qc="e",rc={type:"literal",value:"e",description:'"e"'},sc=function(a){return parseFloat(a.join(""))},tc=null,uc="-",vc={type:"literal",value:"-",description:'"-"'},wc="16r",xc={type:"literal",value:"16r",description:'"16r"'},yc=/^[0-9a-fA-F]/,zc={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Ac=function(a,b){return parseInt((a||"")+b.join(""),16)},Bc=/^[0-9]/,Cc={type:"class",value:"[0-9]",description:"[0-9]"},Dc=".",Ec={type:"literal",value:".",description:'"."'},Fc=function(a,b,c){return parseFloat((a||"")+b.join("")+"."+c.join(""),10)},Gc=function(a,b){return parseInt((a||"")+b.join(""),10)},Hc="#(",Ic={type:"literal",value:"#(",description:'"#("'},Jc="(",Kc={type:"literal",value:"(",description:'"("'},Lc=function(a){return a},Mc=")",Nc={type:"literal",value:")",description:'")"'},Oc=function(a){return new Blether.Array(a).at(d(),e(),c())},Pc=function(a){return a},Qc=function(a){return new Blether.Array(a).at(d(),e(),c())},Rc="{",Sc={type:"literal",value:"{",description:'"{"'},Tc="}",Uc={type:"literal",value:"}",description:'"}"'},Vc=function(a){return new Blether.DynamicArray(a).at(d(),e(),c())},Wc="#{",Xc={type:"literal",value:"#{",description:'"#{"'},Yc=function(a){return new Blether.DynamicDictionary(a).at(d(),e(),c())},Zc="true",$c={type:"literal",value:"true",description:'"true"'},_c=function(){return!0},ad="false",bd={type:"literal",value:"false",description:'"false"'},cd=function(){return!1},dd=function(a){return new Blether.Boolean(a).at(d(),e(),c())},ed="nil",fd={type:"literal",value:"nil",description:'"nil"'},gd=function(){return(new Blether.UndefinedObject).at(d(),e(),c())},hd=function(a){if("this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Use [self] instead of [this]"});return new Blether.Variable(a).at(d(),e(),c())},id=function(a,b){return{key:a,arg:b}},jd=/^[\\+*\/=><,@%~|&\-]/,kd={type:"class",value:"[\\\\+*\\/=><,@%~|&\\-]",description:"[\\\\+*\\/=><,@%~|&\\-]"},ld=function(a){return a.join("")},md=function(a){return new Blether.KeywordPattern(a).at(d(),e(),c())},nd=function(a,b){return new Blether.BinaryPattern(a,b).at(d(),e(),c())},od=function(a){return new Blether.UnaryPattern(a).at(d(),e(),c())},pd=function(a){return a},qd=function(a){return chain?chain.setReceiver(a):new Blether.send(a).at(d(),e(),c())},rd=function(a){return a},sd=function(a,b){return b?b.setReceiver(a):a},td=function(a){return a},ud=function(a,b){return[a].concat(b)},vd=":=",wd={type:"literal",value:":=",description:'":="'},xd=function(a,b){return new Blether.Assignment(a,b).at(d(),e(),c())},yd="^",zd={type:"literal",value:"^",description:'"^"'},Ad=function(a){return new Blether.Return(a).at(d(),e(),c())},Bd="|",Cd={type:"literal",value:"|",description:'"|"'},Dd=function(a){return a},Ed=function(a){return a.forEach(function(a){if("self"===a||"this"===a)throw Blether.ParseError({line:d(),column:e(),msg:"Cannot name a variable ["+a+"]"})}),a},Fd=function(a){return a},Gd=function(a){return a},Hd=function(a){return[a]},Id=function(a,b){var c=a;return c.push(b),c},Jd=function(a){return a||[]},Kd=function(a){return a},Ld=function(a){return new Blether.Statement(a).at(d(),e(),c())},Md=function(a,b){return new Blether.Sequence(a,b).at(d(),e(),c())},Nd="[",Od={type:"literal",value:"[",description:'"["'},Pd="]",Qd={type:"literal",value:"]",description:'"]"'},Rd=function(a,b){return new Blether.Block(a,b).at(d(),e(),c())},Sd=void 0,Td=function(a){return new Blether.Send(a).at(d(),e(),c())},Ud=function(a,b){return b?b.setReceiver(a):a},Vd=function(a,b){return b?b.setReceiver(a):a},Wd=function(a,b){return new Blether.Send(a,[b]).at(d(),e(),c())},Xd=function(a){for(var b=[],f=[],g=0;g<a.length;g++)b.push(a[g].key),f.push(a[g].arg);return new Blether.Send(b.join(""),f).at(d(),e(),c())},Yd=function(a,b){return b.setReceiver(a)},Zd=";",$d={type:"literal",value:";",description:'";"'},_d=function(a){return a},ae=function(a,b){return new Blether.Cascade(a.receiver,[a].concat(b)).at(d(),e(),c())},be="<",ce={type:"literal",value:"<",description:'"<"'},de=">>",ee={type:"literal",value:">>",description:'">>"'},fe=function(){return">"},ge=/^[^>]/,he={type:"class",value:"[^>]",description:"[^>]"},ie=">",je={type:"literal",value:">",description:'">"'},ke=function(a){return new Blether.JsStatement(a.join("")).at(d(),e(),c())},le=function(a,b){return new Blether.Method(a,b).at(d(),e(),c())},me=function(a){return"->"===a.selector},ne=function(a){return[a.receiver,a.args[0]]},oe=function(a,b){return a.concat.apply(a,b)},pe="subclass:",qe={type:"literal",value:"subclass:",description:'"subclass:"'},re="variables:",se={type:"literal",value:"variables:",description:'"variables:"'},te="instanceVariableNames:",ue={type:"literal",value:"instanceVariableNames:",description:'"instanceVariableNames:"'},ve="classVariableNames:",we={type:"literal",value:"classVariableNames:",description:'"classVariableNames:"'},xe="poolDictionaries:",ye={type:"literal",value:"poolDictionaries:",description:'"poolDictionaries:"'},ze=function(a,b,f){if(!b.value.match(/^[A-Z]/))throw Blether.ParseError({line:d(),column:e(),msg:"Class name "+b+" must start with a capital"});if(!Blether.classes[a])throw Blether.ParseError({line:d(),column:e(),msg:"Super-class "+a+" not defined"});if(Blether.classes[b])throw Blether.ParseError({line:d(),column:e(),msg:"Class "+b+" already defined"});return Blether.classes[b]=new Blether.ClassDeclaration(b,a,f).at(d(),e(),c())},Ae="!",Be={type:"literal",value:"!",description:'"!"'},Ce="class",De={type:"literal",value:"class",description:'"class"'},Ee=function(a,b,f){if("Object"!==a&&!Blether.classes[a])throw Blether.ParseError({line:d(),column:e(),msg:"Unknown class "+a});if(b){if(Blether.classes[a].classMethods[f.selector])throw Blether.ParseError({line:d(),column:e(),msg:"Class method "+f.selector+" already defined on class "+a});return Blether.classes[a].classMethods[f.selector]=new Blether.ClassMethodDeclaration(a,f).at(d(),e(),c())}if(Blether.classes[a].methods[f.selector])throw Blether.ParseError({line:d(),column:e(),msg:"Method "+f.selector+" already defined on class "+a});return Blether.classes[a].methods[f.selector]=new Blether.MethodDeclaration(a,f).at(d(),e(),c())},Fe=function(a){return a},Ge=function(a){return new Blether.VariableDeclaration(a)},He=function(a,b){return new Blether.Program([a].concat(b)).at(d(),e(),c())},Ie=0,Je=0,Ke=0,Le={line:1,column:1,seenCR:!1},Me=0,Ne=[],Oe=0;if("startRule"in zb){if(!(zb.startRule in Bb))throw new Error("Can't start parsing from rule \""+zb.startRule+'".');Cb=Bb[zb.startRule]}if(Blether.classes={Object:{classMethods:{},methods:{}}},yb=Cb(),yb!==Ab&&Ie===a.length)return yb;throw yb!==Ab&&Ie<a.length&&g({type:"end",description:"end of input"}),h(null,Ne,Me)}return a(b,Error),{SyntaxError:b,parse:c}}(),BletherReturnOperatorVisitor=function(){function a(){return!1}function b(){return!0}this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){for(var b=0;b<a.elements.length;b++)if(a.elements[b].visit(this))return!0;return!1},this.visitClassDeclaration=function(a){for(var b in a.methods)if(a.methods.hasOwnProperty(b)&&a.methods[b].visit(this))return!0;return!1},this.visitMethodDeclaration=function(a){return a.body.visit(this)},this.visitMethod=function(a){for(var b=0;b<a.sequences.length;b++)if(a.sequences[b].visit(this))return!0;return!1},this.visitStatement=function(a){return a.expression.visit(this)},this.visitSequence=function(a){for(var b=0;b<a.statements.length;b++)if(a.statements[b].visit(this))return!0;return!1},this.visitSend=function(a){if(null!==a.receiver&&a.receiver.visit(this))return!0;for(var b=0;b<a.args.length;b++)if(a.args[b].visit(this))return!0;return!1},this.visitAssignment=function(a){return a.expression.visit(this)},this.visitBlock=function(a){return a.sequence.visit(this)},this.visitCascade=function(a){if(a.receiver.visit(this))return!0;for(var b=0;b<a.messages.length;b++)if(a.messages[b].visit(this))return!0;return!1},this.visitDynamicArray=function(a){for(var b=0;b<a.values.length;b++)if(a.values[b].visit(this))return!0;return!1},this.visitDynamicDictionary=function(a){for(var b in a.values)if(a.values.hasOwnProperty(b)&&a.values[b].visit(this))return!0;return!1},this.visitReturn=b,this.visitBinaryPattern=a,this.visitKeywordPattern=a,this.visitString=a,this.visitSymbol=a,this.visitUnaryPattern=a,this.visitNumber=a,this.visitUndefinedObject=a,this.visitBoolean=a,this.visitArray=a,this.visitJsStatement=a,this.visitVariableDeclaration=a,this.visitVariable=a},BletherTranslator=function(){"use strict";function a(a,b,c){if(a.params.length>b)throw Blether.ParseError({line:a.line,column:a.column,msg:"Too many parameters specified in block argument to "+c})}this.printedClassPrerequisites=!1;var b="var _extends = function(child, parent) {\n	for (var key in parent) {\n		if (_hasProp.call(parent, key)) child[key] = parent[key];\n	}\n\n	function ctor() {\n		this.constructor = child;\n	}\n	ctor.prototype = parent.prototype;\n	child.prototype = new ctor();\n	child.__super__ = parent.prototype;\n	return child;\n};\n\nvar _hasProp = {}.hasOwnProperty;\n\n";this.visit=function(a){return a.visit(this)},this.visitProgram=function(a){var b=this;this.context=new Blether.ContextMgr;var c="";return a.elements.forEach(function(a){("ClassMethodDeclaration"!==a._type&&"MethodDeclaration"!==a._type||"undefined"==typeof a.getClass().superClass)&&(c+=a.visit(b))}),c},this.visitClassDeclaration=function(a){var c=this,d="",e="Object"!==a.superClass;!this.printedClassPrerequisites&&e&&(d+=b,this.printedClassPrerequisites=!0),d+="var "+a.className.value+" = (function(",e&&(d+="_super"),d+=") {\n",e&&(d+="_extends("+a.className+", _super);\n\n");var f=a.varNames.value;d+="function "+a.className+"(",d+=f.map(function(a){return"_"+a.value}).join(", "),d+=") {\n",e&&(d+="    return "+a.className+".__super__.constructor.apply(this, arguments);\n"),f.forEach(function(a){var b=a.value;d+="this."+b+" = _"+b+";\n"}),d+="};\n\n",this.context.pushClass(a.className.value,f.map(function(a){return a.value}));var g=a.getMethods();for(var h in g)g.hasOwnProperty(h)&&(d+=g[h].visit(c));var i=a.getClassMethods();for(var j in i)i.hasOwnProperty(j)&&(d+=i[j].visit(c));return this.context.pop(),d+="\nreturn "+a.className+";\n\n",d+="})(",e&&(d+=a.superClass),d+=");\n\n"},this.visitMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+".prototype."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitClassMethodDeclaration=function(a){var b=a.body.selector.visit(this)[0],c=a.className+"."+b+" = ";return c+=a.body.visit(this),c+=";\n\n"},this.visitString=function(a){return'"'+a.value.replace(/"/g,'\\"')+'"'},this.visitMethod=function(a){var b=a.selector.visit(this)[1];this.context.pushMethod(b);var c="function("+b.join(", ")+") {\n";if("JsStatement"===a.sequence._type)return c+=a.sequence.visit(this),c+="\n}";c+="var self = this;\n";for(var d=!1,e=new BletherReturnOperatorVisitor,f=0;f<a.sequence.statements.length;f++){var g=a.sequence.statements[f];if("Return"!==g._type&&e.visit(g)){d=!0;break}}d&&(c+="try {\n");var h=this;return c+=a.sequence.visit(h),d&&(c+="}\n",c+="catch (e) {\n",c+="  if (e instanceof STReturnValue) {\n",c+="    return e.value;\n",c+="  }\n",c+="  else {\n",c+="    throw e;\n",c+="  }\n",c+="}\n"),c+="}",this.context.pop(),c},this.visitUnaryPattern=function(a){return[convertSelector(a.selector),[]]},this.visitBinaryPattern=function(a){return[convertSelector(a.selector),[a.arg]]},this.visitKeywordPattern=function(a){var b=this,c=a.pairs.map(function(a){return a.key}),d=a.pairs.map(function(a){return a.arg}),e={};return d.forEach(function(c){if(e[c]=(e[c]||0)+1,e[c]>1)throw Blether.ParseError({line:a.line,column:a.column,msg:"Argument name "+c+" repeats in method "+b.context.currentClass()+">>"+a.selector})}),[convertSelector(c.join("")),d]},this.visitSymbol=function(a){return this.visitString(a)},this.visitStatement=function(a){var b=a.expression.visit(this);return b+=";"!==b[b.length-1]?";\n":"\n"},this.visitSequence=function(a){var b=this,c="";this.context.pushTemps(a.temps),a.temps.length>0&&(c+="var "+a.temps.join(", ")+";\n");var d=!0;return a.statements.forEach(function(a,e,f){e===f.length-1&&("method"!==b.context.returnContext()?"Return"!==a._type?c+="return ":d=!1:"Return"===a._type&&(d=!1)),c+=a.visit(b)+";\n"}),d&&"method"===b.context.returnContext()&&(c+="return self;\n"),this.context.pop(),c},this.visitSend=function(a){var b=this,c=a.receiver.visit(this);switch("Block"===a.receiver._type&&(c="("+c+")"),c){case"super":return this.convertSuper(convertSelector(a.selector),a);case"NodeJS":return this.convertNodeJS(a)}var d="";if("value"===a.selector||a.selector.match(/^(value:)+$/))return d=c+".__value$(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")";switch(a.selector){case"at:":d+=this.convertAt(c,a.args[0]);break;case"at:put:":d+=this.convertAtPut(c,a.args[0],a.args[1]);break;case"isNil":d+="(typeof ("+c+') === "undefined" || '+c+" === null)";break;case"notNil":d+="(typeof ("+c+') !== "undefined" && '+c+" !== null)";break;case"isEmpty":d+="("+c+".length === 0)";break;case"ifEmpty:":d+=this.convertIfEmpty(c,a);break;case"ifNotEmpty:":d+=this.convertIfNotEmpty(c,a);break;case"notEmpty":d+="("+c+".length > 0)";break;case"ifNil:":d=this.convertIfNil(c,a);break;case"ifNotNil:":d=this.convertIfNotNil(c,a);break;case"ifNil:ifNotNil:":d=this.convertIfNilIfNotNil(c,a);break;case"new":d=this.convertNew(c);break;case"whileTrue:":case"whileFalse:":d=this.convertWhile(a);break;case"ifTrue:":case"ifFalse:":d=this.convertSingleIf(a);break;case"ifTrue:ifFalse:":case"ifFalse:ifTrue:":d=this.convertIfTrueIfFalse(a);break;case"and:":case"or:":d=this.convertAndOr(c,a);break;case"==":d=c+" === "+a.args[0].visit(b);break;case"~~":d=c+" !== "+a.args[0].visit(b);break;case"~=":d="!("+c+".equals$("+a.args[0].visit(b)+"))";break;case"asJQuery":d="jQuery("+c+")";break;default:d=c+"."+convertSelector(a.selector)+"(",d+=a.args.map(function(a){return a.visit(b)}).join(", "),d+=")"}return d},this.visitAssignment=function(a){return a.variable.visit(this)+" = "+a.expression.visit(this)},this.visitNumber=function(a){return"("+a.value.toString()+")"},this.visitVariable=function(a){var b;if("self"===a.value)return"self";if("STReturnValue"===a.value)throw Blether.ParseError({line:a.line,column:a.column,msg:"Do not refer directly to STReturnValue - use the caret operator instead"});var c=this.context.getTemps();for(b=0;b<c.length;b++)if(a.value===c[b])return a.value;var d=this.context.getInstanceVars();for(b=0;b<d.length;b++)if(a.value===d[b])return"self."+a.value;if(a.value.match(/^[A-Z]/))return a.value;throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown variable name ["+a.value+"]"})},this.visitUndefinedObject=function(){return"null"},this.visitBoolean=function(a){return a.value.toString()},this.invokeBlock=function(a){if(0===a.sequence.statements.length)return"null";var b=[];if(arguments.length>1)for(var c=1;c<arguments.length;c++)b.push(arguments[c]);if(a.params.length!==b.length)throw Blether.ParseError({line:a.line,column:a.column,msg:"Not enough parameters specified to block"});if(1===a.sequence.statements.length&&0===a.sequence.temps.length){var d={};b.forEach(function(b,c){d[a.params[c]]=b}),a.find(function(a){return"Variable"===a._type}).forEach(function(a){d.hasOwnProperty(a.value)&&(a.value=d[a])}),this.context.pushTemps(b);var e=a.sequence.statements[0].visit(this);return this.context.pop(),e}return"("+a.visit(this)+")("+b.join(", ")+")"},this.visitBlock=function(a){this.context.pushBlock(a.params);var b="function("+a.params.join(", ")+") {\n";return b+=a.sequence.visit(this),b+="}",this.context.pop(),b},this.visitCascade=function(a){var b,c=this,d=!1;switch(a.receiver._type){case"Variable":case"String":case"Symbol":case"Number":case"Boolean":case"UndefinedObject":d=!0}var e,f,g;if(d)f=a.messages.map(function(b){return b.receiver=a.receiver,b}),e=new Blether.Sequence([],f),g=new Blether.Block([],e),b="("+g.visit(c)+")()";else{var h=this.context.pushReceiver();f=a.messages.map(function(a){return a.receiver=new Blether.Variable(h),a}),e=new Blether.Sequence([],f),g=new Blether.Block([h],e),b="("+g.visit(c)+")("+a.receiver.visit(c)+")",this.context.popReceiver()}return b},this.visitJsStatement=function(a){return a.javascript.trim()},this.visitVariableDeclaration=function(a){return this.context.pushTemps(a.variables),"var "+a.variables.join(", ")+";\n"},this.visitArray=function(a){var b=this;return"["+a.value.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicArray=function(a){var b=this;return"["+a.values.map(function(a){return a.visit(b)}).join(", ")+"]"},this.visitDynamicDictionary=function(a){if(0===a.values.length)return"Object.create(null)";var b="(function() {\n";b+="var _dict = Object.create(null);\n";for(var c=0,d=1;d<a.values.length;c+=2,d+=2)b+="String"===a.values[c]._type||"Symbol"===a.values[c]._type?"_dict."+a.values[c].value+" = "+a.values[d].visit(this)+";\n":"_dict["+a.values[c].visit(this)+"] = "+a.values[d].visit(this)+";\n";return b+="return _dict;\n",b+="})()"},this.visitReturn=function(a){return"method"===this.context.returnContext()?"return "+a.value.visit(this):"stReturn("+a.value.visit(this)+")"},this.convertIfEmpty=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return ("+e+".length === 0) ? "+d.invoke(this)+" : null;\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotEmpty=function(b,c){var d=c.args[0];a(d,1,"ifNotEmpty:");var e,f=this.context.pushReceiver();return e="(function("+f+") {\n",e+="return ("+f+".length > 0) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,f),e+=" : null;\n",e+="})("+b+")",this.context.popReceiver(),e},this.convertIfNil=function(a,b){var c,d=b.args[0],e=this.context.pushReceiver();return c="(function("+e+") {\n",c+="return (typeof "+e+' === "undefined" || '+e+" === null) ",c+="? "+d.invoke(this)+" : "+e+";\n",c+="})("+a+")",this.context.popReceiver(),c},this.convertIfNotNil=function(b,c){var d=c.args[0];a(d,1,"ifNotNil:");var e,f=1===d.params.length,g=f?d.params[0]:this.context.pushReceiver();return e="(function("+g+") {\n",e+="return (typeof "+g+' !== "undefined" && '+g+" !== null) ? ",e+=0===d.params.length?d.invoke(this):d.invoke(this,g),e+=" : null;\n",e+="})("+b+")",f||this.context.popReceiver(),e},this.convertIfNilIfNotNil=function(b,c){var d=c.args[0],e=c.args[1];a(d,0,"ifNil:"),a(e,1,"ifNotNil:");var f=1===e.params.length,g=f?e.params[0]:this.context.pushReceiver(),h="(function("+g+") {\n";return h+="return (typeof "+g+' === "undefined" || '+g+" === null)",h+=" ? "+d.invoke(this)+" : ",h+=0===e.params.length?e.invoke(this):e.invoke(this,g),h+=";\n",h+="})("+b+")",f||this.context.popReceiver(),h},this.convertNew=function(a){return"new "+a+"()"},this.convertSuper=function(a,b){var c=this;if("undefined"!=typeof this.context.currentClass()){var d=this.context.currentClass()+".__super__."+a+".call(self";return b.args.length>0&&b.args.forEach(function(a){d+=", "+a.visit(c)}),d+=")"}throw Blether.ParseError({line:b.line,column:b.column,msg:"Can't use [super] outside a method declaration"})},this.convertWhile=function(a){if("Block"!==a.receiver._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" can be sent to blocks only"});var b,c="whileFalse:"===a.selector?"!":"";b=c+a.receiver.invoke(this);var d="while ("+b+") {\n";return d+=a.args[0].invoke(this)+";\n",d+="}\n"},this.convertSingleIf=function(a){if("Block"!==a.args[0]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b="ifFalse:"===a.selector?"!":"";return b?a.receiver.visit(this)+" ? null : "+a.args[0].invoke(this):a.receiver.visit(this)+" ? "+a.args[0].invoke(this)+" : null"},this.convertIfTrueIfFalse=function(a){if("Block"!==a.args[0]._type||"Block"!==a.args[1]._type)throw Blether.ParseError({line:a.line,column:a.column,msg:a.selector+" accepts literal blocks only"});var b=0,c=1;return"ifFalse:ifTrue:"===a.selector&&(b=1,c=0),a.receiver.visit(this)+" ? "+a.args[b].invoke(this)+" : "+a.args[c].invoke(this)},this.convertAt=function(a,b){return"String"===b._type||"Symbol"===b._type?a+"."+b.value:a+"["+b.visit(this)+"]"},this.convertAtPut=function(a,b,c){return"String"===b._type||"Symbol"===b._type?a+"."+b.value+" = "+c.visit(this):a+"["+b.visit(this)+"] = "+c.visit(this)},this.convertAndOr=function(a,b){if("Block"!==b.args[0]._type)throw Blether.ParseError({line:b.line,column:b.column,msg:b.selector+" accepts literal blocks only"});var c="and:"===b.selector?" && ":" || ";return a+c+b.args[0].invoke(this)},this.convertNodeJS=function(a){var b=this;switch(a.selector){case"filename":return"__filename";case"dirname":return"__dirname";case"require:":return"require("+a.args[0].visit(b)+")";default:throw Blether.ParseError({line:a.line,column:a.column,msg:"Unknown selector ["+a.selector+"]"})}}};module.exports={translate:function(a,b){var c=b||{runtime:!0},d=BletherParser.parse(a),e="";if(truthy(c.runtime)){var f=require("path"),g=require("fs"),h=f.join(f.dirname(g.realpathSync(__filename)),"runtime.js");e=g.readFileSync(h).toString()}var i=(new BletherTranslator).visit(d);return e+i}};